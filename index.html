<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nene's Kitchen</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Nene's Kitchen">
    <meta name="theme-color" content="#FAF7F2">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        coral: { 50: '#FEF3F0', 100: '#FDE8E2', 400: '#F09A7F', 500: '#E07A5F', 600: '#C96A52' },
                        sage: { 50: '#F0F7F4', 100: '#E0EFE7', 400: '#9DC4AF', 500: '#81B29A', 600: '#6A9A82' },
                        sand: { 50: '#FAF6F0', 100: '#F5EDE0', 400: '#E0B78A', 500: '#D4A373', 600: '#C49362' },
                        cream: { 50: '#FFFDFB', 100: '#FAF7F2', 200: '#F5F0E8', 300: '#EBE4D9' },
                        warm: { 600: '#6B5D52', 700: '#4A4039', 800: '#3D3229', 900: '#2C241E' }
                    },
                    fontFamily: { sans: ['DM Sans', 'system-ui', 'sans-serif'] },
                    boxShadow: {
                        'soft': '0 2px 15px rgba(60, 50, 40, 0.06)',
                        'soft-lg': '0 4px 20px rgba(60, 50, 40, 0.1)',
                        'glow-coral': '0 4px 15px rgba(224, 122, 95, 0.2)',
                        'glow-sage': '0 4px 15px rgba(129, 178, 154, 0.2)',
                    }
                }
            }
        }
    </script>
    <style>
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        body { overscroll-behavior: none; font-family: 'DM Sans', system-ui, sans-serif; background: #FAF7F2; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #E0D9CF; border-radius: 4px; }
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade-in { animation: fade-in 0.2s ease-out; }
        @keyframes slide-up { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slide-up 0.2s ease-out; }
        @keyframes bounce-in { 0% { transform: scale(0.9); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .animate-bounce-in { animation: bounce-in 0.25s ease-out; }
        @keyframes float-up { 0% { transform: translateY(100vh) rotate(0deg); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 0.8; } 100% { transform: translateY(-50px) rotate(180deg); opacity: 0; } }
        .animate-float-up { animation: float-up 4s ease-out forwards; }
        @keyframes heartbeat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        .animate-heartbeat { animation: heartbeat 1.2s ease-in-out infinite; }
        @keyframes pulse-soft { 0%, 100% { opacity: 0.5; } 50% { opacity: 0.8; } }
        .animate-pulse-soft { animation: pulse-soft 3s ease-in-out infinite; }
        .card { background: white; box-shadow: 0 2px 15px rgba(60, 50, 40, 0.06); }
        .press:active { transform: scale(0.97); }
        .modal-overlay { background: rgba(44, 36, 30, 0.4); }
        .chip-selected { background: linear-gradient(135deg, #E07A5F 0%, #D4A373 100%); box-shadow: 0 3px 10px rgba(224, 122, 95, 0.25); color: white; }
        .chip-unselected { background: white; border: 1.5px solid #EBE4D9; color: #4A4039; }
        .chip-unselected:hover { border-color: #D4A373; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo, useRef } = React;

        // ==================== BASE DATA ====================
        const proteins = [
            { id: 'chicken', name: 'Chicken', emoji: 'üçó', proteinPer100g: 25, shopping: 'Chicken breast/thighs (1.5kg)' },
            { id: 'beef', name: 'Beef', emoji: 'ü•©', proteinPer100g: 26, shopping: 'Beef steak (1kg)' },
            { id: 'ground', name: 'Ground Beef', emoji: 'üçî', proteinPer100g: 26, shopping: 'Ground beef (1kg)' },
            { id: 'eggs', name: 'Eggs', emoji: 'ü•ö', proteinPer100g: 13, shopping: 'Eggs (2 dozen)' },
            { id: 'salmon', name: 'Salmon', emoji: 'üêü', proteinPer100g: 22, shopping: 'Salmon fillet (800g)' },
            { id: 'fish', name: 'White Fish', emoji: 'üê†', proteinPer100g: 20, shopping: 'White fish fillet (800g)' },
            { id: 'shrimp', name: 'Shrimp', emoji: 'ü¶ê', proteinPer100g: 20, shopping: 'Shrimp (500g)' },
            { id: 'lamb', name: 'Lamb', emoji: 'üçñ', proteinPer100g: 25, shopping: 'Lamb chops (1kg)' },
            { id: 'pork', name: 'Pork', emoji: 'üê∑', proteinPer100g: 25, shopping: 'Pork chops/loin (1kg)' },
        ];

        const vegetables = [
            { id: 'broccoli', name: 'Broccoli', emoji: 'ü•¶', salad: false, shopping: 'Broccoli (2 heads)' },
            { id: 'spinach', name: 'Spinach', emoji: 'ü•¨', salad: true, warning: 'Max 2-3x/week', shopping: 'Fresh spinach (200g)' },
            { id: 'peppers', name: 'Peppers', emoji: 'ü´ë', salad: true, shopping: 'Bell peppers (4-5)' },
            { id: 'zucchini', name: 'Zucchini', emoji: 'ü•í', salad: false, shopping: 'Zucchini (4)' },
            { id: 'mushrooms', name: 'Mushrooms', emoji: 'üçÑ', salad: false, shopping: 'Mushrooms (400g)' },
            { id: 'asparagus', name: 'Asparagus', emoji: 'üåø', salad: false, shopping: 'Asparagus (2 bunches)' },
            { id: 'avocado', name: 'Avocado', emoji: 'ü•ë', salad: true, shopping: 'Avocados (6)' },
            { id: 'tomatoes', name: 'Tomatoes', emoji: 'üçÖ', salad: true, shopping: 'Tomatoes (6)' },
            { id: 'onions', name: 'Onions', emoji: 'üßÖ', salad: true, shopping: 'Onions (bag)' },
            { id: 'cucumber', name: 'Cucumber', emoji: 'ü•í', salad: true, shopping: 'Cucumbers (3)' },
            { id: 'lettuce', name: 'Lettuce', emoji: 'ü•ó', salad: true, shopping: 'Lettuce (2 heads)' },
            { id: 'arugula', name: 'Arugula', emoji: 'üå±', salad: true, shopping: 'Arugula (150g)' },
            { id: 'cabbage', name: 'Cabbage', emoji: 'ü•¨', salad: true, shopping: 'Cabbage (1 head)' },
            { id: 'cauliflower', name: 'Cauliflower', emoji: 'ü•¨', salad: false, shopping: 'Cauliflower (1 head)' },
        ];

        const cheeses = [
            { id: 'feta', name: 'Feta', emoji: 'üßÄ', shopping: 'Feta cheese (200g)' },
            { id: 'parmesan', name: 'Parmesan', emoji: 'üßÄ', shopping: 'Parmesan (150g)' },
            { id: 'halloumi', name: 'Halloumi', emoji: 'üßÄ', shopping: 'Halloumi (250g)' },
        ];

        const flavorProfiles = {
            any: { id: 'any', name: 'Any', emoji: '‚ú®' },
            latin: { id: 'latin', name: 'Latin', emoji: 'üå∂Ô∏è', seasonings: '1 tsp cumin, 1 tsp paprika, ¬Ω tsp garlic powder, salt', finisher: 'Fresh lime + cilantro' },
            mediterranean: { id: 'mediterranean', name: 'Med', emoji: 'üåø', seasonings: '1 tsp oregano, 2 cloves garlic, lemon zest, salt', finisher: 'Lemon juice + olive oil drizzle' },
            asian: { id: 'asian', name: 'Asian', emoji: 'ü•¢', seasonings: '1 tbsp ginger, 2 cloves garlic, 1 tsp sesame oil', finisher: 'Sesame oil + sesame seeds' },
            spicy: { id: 'spicy', name: 'Spicy', emoji: 'üî•', seasonings: '¬Ω tsp cayenne, 1 tsp chili flakes, garlic, salt', finisher: 'Extra chili flakes' },
            classic: { id: 'classic', name: 'Classic', emoji: 'üßà', seasonings: '2 cloves garlic, 2 tbsp butter, salt, pepper, herbs', finisher: 'Butter baste + fresh herbs' }
        };

        const timeCategories = {
            any: { id: 'any', name: 'Any', emoji: '‚è±Ô∏è', min: 0, max: 999 },
            quick: { id: 'quick', name: 'Quick', emoji: '‚ö°', min: 0, max: 20 },
            normal: { id: 'normal', name: 'Medium', emoji: 'üç≥', min: 20, max: 35 },
            slow: { id: 'slow', name: 'Worth It', emoji: 'ü•ò', min: 35, max: 999 }
        };

        const mealCategories = {
            any: { id: 'any', name: 'All', emoji: 'üçΩÔ∏è' },
            breakfast: { id: 'breakfast', name: 'Breakfast', emoji: 'üåÖ' },
            main: { id: 'main', name: 'Main', emoji: 'üçñ' },
            soup: { id: 'soup', name: 'Soup', emoji: 'üç≤' },
            cold: { id: 'cold', name: 'Cold', emoji: 'ü•∂' },
            snack: { id: 'snack', name: 'Snack', emoji: 'ü•ú' },
        };

        const dressings = [
            { name: 'Olive Oil & Lemon', recipe: '3 tbsp olive oil + juice of 1 lemon + salt', flavor: 'mediterranean' },
            { name: 'Creamy Tahini', recipe: '2 tbsp tahini + lemon + water + garlic', flavor: 'mediterranean' },
            { name: 'Greek Yogurt Ranch', recipe: '3 tbsp Greek yogurt 0% + herbs + garlic', flavor: 'classic' },
            { name: 'Avocado Lime', recipe: '¬Ω avocado + lime juice + cilantro + salt', flavor: 'latin' },
            { name: 'Guasacaca üáªüá™', recipe: 'Avocado + cilantro + garlic + vinegar + oil', flavor: 'latin' },
            { name: 'Ginger Sesame', recipe: '2 tbsp sesame oil + coconut aminos + ginger', flavor: 'asian' },
            { name: 'Spicy Lime', recipe: '3 tbsp olive oil + lime juice + chili flakes', flavor: 'spicy' },
        ];

        const achievements = [
            { id: 'first_meal', name: 'First Steps', emoji: 'üë∂', desc: 'Logged first meal', threshold: 1, type: 'meals' },
            { id: 'five_meals', name: 'Getting Started', emoji: 'üå±', desc: 'Logged 5 meals', threshold: 5, type: 'meals' },
            { id: 'ten_meals', name: 'On a Roll', emoji: 'üî•', desc: 'Logged 10 meals', threshold: 10, type: 'meals' },
            { id: 'twentyfive_meals', name: 'Protein Pro', emoji: 'üí™', desc: 'Logged 25 meals', threshold: 25, type: 'meals' },
            { id: 'fifty_meals', name: 'Kitchen Queen', emoji: 'üëë', desc: 'Logged 50 meals', threshold: 50, type: 'meals' },
            { id: 'first_fav', name: 'Picky Eater', emoji: '‚ù§Ô∏è', desc: 'Saved first favorite', threshold: 1, type: 'favorites' },
            { id: 'week_streak', name: 'Week Warrior', emoji: 'üìÖ', desc: '7-day streak', threshold: 7, type: 'streak' },
        ];

        const loveMessages = [
            "Nene, if I get abs, you get the credit üòè",
            "Cooking for a man on a diet? Straight to heaven üëº",
            "You're basically my protein dealer now üí™",
            "Te prometo que cuando est√© flaco te cargo por toda la casa üèãÔ∏è",
            "Less carbs, more Nene. That's the real diet üòò",
            "Si me queda el six pack, te lo dedico a ti üéÅ",
            "My nutritionist could never. But Nene could üíÖ",
            "When I'm hot again, remember: you did this üî•",
            "Nene 1, Insulin Resistance 0 ‚öîÔ∏è",
            "Future Diego says thanks. Current Diego says m√°s pollo üçó",
            "Not all heroes wear capes. Some measure 300g of chicken ü¶∏‚Äç‚ôÄÔ∏è",
            "This app runs on code. I run on your food üì±",
            "Low carb, high Nene. The winning formula üß™",
            "Behind every fit man is a woman tired of hearing about macros üòÖ",
            "Te amo m√°s que a los carbohidratos. Y eso es mucho üçû‚ùå",
        ];

        const dayNames = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];

        // ==================== RECIPES: CHICKEN ====================
        const chickenRecipes = [
            { id: 'chicken_plate', name: 'Pan-Seared Chicken', proteins: ['chicken'], category: 'main', requiresVeggies: true, time: 25, baseProtein: 95, servingSize: '400g chicken', flavors: ['any', 'classic', 'mediterranean', 'latin', 'spicy'], netCarbs: 0,
              ingredients: [
                { item: 'Chicken breast or thighs', amount: '400g' },
                { item: 'Olive oil', amount: '2 tbsp' },
                { item: 'Salt', amount: '1 tsp' },
                { item: 'Black pepper', amount: '¬Ω tsp' },
                { item: 'Garlic powder', amount: '¬Ω tsp' },
              ],
              steps: ['Pat chicken dry with paper towels', 'Season both sides generously', 'Heat pan medium-high with olive oil', 'Cook 6-7 min per side until golden', 'Rest 3 minutes before slicing'],
              tips: ['Don\'t flip too early ‚Äî let crust form', '165¬∞F internal temp'], doneness: 'Golden crust, juices run clear' },
            
            { id: 'chicken_salad', name: 'Power Chicken Salad', proteins: ['chicken'], category: 'cold', requiresVeggies: true, saladOnly: true, time: 20, baseProtein: 88, servingSize: '350g chicken', flavors: ['any', 'mediterranean', 'latin', 'asian'], netCarbs: 4,
              ingredients: [
                { item: 'Chicken breast', amount: '350g' },
                { item: 'Mixed greens', amount: '100g' },
                { item: 'Cherry tomatoes', amount: '80g' },
                { item: 'Cucumber', amount: '100g' },
                { item: 'Olive oil', amount: '2 tbsp' },
                { item: 'Lemon juice', amount: '1 tbsp' },
              ],
              steps: ['Season and grill chicken until done', 'Rest 5 min, slice against grain', 'Build salad base with greens', 'Top with warm chicken slices', 'Drizzle dressing'],
              tips: ['Warm chicken on cold greens = perfect contrast'], suggestDressing: true },
            
            { id: 'chicken_shawarma', name: 'Chicken Shawarma Bowl', proteins: ['chicken'], category: 'main', requiresVeggies: true, time: 25, baseProtein: 95, servingSize: '400g chicken thighs', flavors: ['mediterranean', 'spicy'], netCarbs: 5,
              ingredients: [
                { item: 'Chicken thighs', amount: '400g' },
                { item: 'Cumin', amount: '1 tsp' },
                { item: 'Coriander', amount: '1 tsp' },
                { item: 'Turmeric', amount: '¬Ω tsp' },
                { item: 'Paprika', amount: '1 tsp' },
                { item: 'Garlic, minced', amount: '3 cloves' },
                { item: 'Lemon juice', amount: '2 tbsp' },
                { item: 'Olive oil', amount: '2 tbsp' },
                { item: 'Tahini', amount: '2 tbsp' },
              ],
              steps: ['Marinate chicken in spices, garlic, lemon', 'Sear until charred 6-7 min per side', 'Rest and slice thin', 'Serve over greens with tahini', 'Add pickled onions and cucumber'],
              tips: ['Thighs are juicier than breast', 'Marinate 30 min to overnight'] },
            
            { id: 'chicken_tikka', name: 'Chicken Tikka Masala', proteins: ['chicken'], category: 'main', requiresVeggies: true, time: 35, baseProtein: 95, servingSize: '400g chicken', flavors: ['spicy', 'asian'], netCarbs: 8,
              ingredients: [
                { item: 'Chicken breast, cubed', amount: '400g' },
                { item: 'Greek yogurt', amount: '100g' },
                { item: 'Garam masala', amount: '2 tsp' },
                { item: 'Turmeric', amount: '1 tsp' },
                { item: 'Heavy cream', amount: '200ml' },
                { item: 'Tomato paste', amount: '2 tbsp' },
                { item: 'Ginger, minced', amount: '1 tbsp' },
                { item: 'Garlic, minced', amount: '3 cloves' },
                { item: 'Butter', amount: '2 tbsp' },
              ],
              steps: ['Marinate chicken in yogurt, garam masala, turmeric', 'Grill or pan-sear until charred', 'Make sauce: saut√© onion, garlic, ginger, tomato paste', 'Add cream and spices, simmer', 'Add chicken, cook 10 min'],
              tips: ['Use full-fat cream or coconut cream', 'Serve with cauliflower rice'] },
            
            { id: 'chicken_greek', name: 'Greek Lemon Chicken', proteins: ['chicken'], category: 'main', requiresVeggies: true, time: 30, baseProtein: 95, servingSize: '400g chicken', flavors: ['mediterranean'], netCarbs: 3,
              ingredients: [
                { item: 'Chicken thighs or breast', amount: '400g' },
                { item: 'Lemon juice', amount: '3 tbsp' },
                { item: 'Lemon zest', amount: '1 lemon' },
                { item: 'Dried oregano', amount: '1 tbsp' },
                { item: 'Garlic, minced', amount: '4 cloves' },
                { item: 'Olive oil', amount: '3 tbsp' },
                { item: 'Feta cheese', amount: '50g' },
                { item: 'Kalamata olives', amount: '30g' },
              ],
              steps: ['Marinate chicken in lemon, oregano, garlic, olive oil', 'Roast at 425¬∞F for 25 min', 'Baste with pan juices halfway', 'Serve with feta, olives, cucumber'],
              tips: ['Score chicken for deeper flavor', 'Diet Doctor inspired'] },
            
            { id: 'chicken_butter', name: 'Butter Chicken', proteins: ['chicken'], category: 'main', requiresVeggies: true, time: 40, baseProtein: 95, servingSize: '400g chicken', flavors: ['spicy', 'asian'], netCarbs: 7,
              ingredients: [
                { item: 'Chicken thighs, cubed', amount: '400g' },
                { item: 'Greek yogurt', amount: '100g' },
                { item: 'Butter', amount: '4 tbsp' },
                { item: 'Heavy cream', amount: '200ml' },
                { item: 'Tomato puree', amount: '200g' },
                { item: 'Garam masala', amount: '2 tsp' },
                { item: 'Kashmiri chili', amount: '1 tsp' },
                { item: 'Ginger-garlic paste', amount: '2 tbsp' },
              ],
              steps: ['Marinate chicken in yogurt and spices 30 min', 'Pan-sear until golden', 'Make sauce with butter, tomatoes, cream', 'Simmer chicken in sauce 15 min', 'Finish with butter and cream'],
              tips: ['Gordon Ramsay recipe ‚Äî only 7g carbs', 'Use ghee for extra richness'] },
            
            { id: 'pollo_guasacaca', name: 'Pollo con Guasacaca üáªüá™', proteins: ['chicken'], category: 'main', requiresVeggies: true, time: 30, baseProtein: 95, servingSize: '400g chicken', flavors: ['latin'], isVenezuelan: true, netCarbs: 4,
              ingredients: [
                { item: 'Chicken breast or thighs', amount: '400g' },
                { item: 'Cumin', amount: '1 tsp' },
                { item: 'Paprika', amount: '1 tsp' },
                { item: 'Garlic powder', amount: '1 tsp' },
                { item: 'Avocado', amount: '1 large' },
                { item: 'Fresh cilantro', amount: '1 cup' },
                { item: 'White vinegar', amount: '2 tbsp' },
                { item: 'Olive oil', amount: '3 tbsp' },
                { item: 'Garlic cloves', amount: '2' },
              ],
              steps: ['Season chicken with cumin, garlic, paprika', 'Grill until charred and cooked', 'Blend guasacaca: avocado, cilantro, vinegar, oil, garlic', 'Slice chicken, serve with sauce'],
              tips: ['Make extra guasacaca ‚Äî good on everything', 'Keeps 2 days in fridge'] },
            
            { id: 'chicken_omelette', name: 'Loaded Chicken Omelette', proteins: ['chicken', 'eggs'], category: 'breakfast', requiresVeggies: false, time: 15, baseProtein: 82, servingSize: '200g chicken + 4 eggs', flavors: ['any', 'classic', 'mediterranean', 'spicy'], netCarbs: 1,
              ingredients: [
                { item: 'Cooked chicken, shredded', amount: '200g' },
                { item: 'Eggs', amount: '4' },
                { item: 'Butter', amount: '2 tbsp' },
                { item: 'Salt', amount: '¬Ω tsp' },
                { item: 'Black pepper', amount: '¬º tsp' },
                { item: 'Cheese (optional)', amount: '30g' },
              ],
              steps: ['Shred or dice cooked chicken', 'Beat 4 eggs with salt and pepper', 'Melt butter in non-stick over medium-low', 'Pour eggs, let set 30 seconds', 'Add fillings to one half, fold'],
              tips: ['Medium-low heat = creamy eggs', 'Remove while still slightly wet'] },
        ];

        // ==================== RECIPES: BEEF ====================
        const beefRecipes = [
            { id: 'steak_plate', name: 'Perfect Steak', proteins: ['beef'], category: 'main', requiresVeggies: true, time: 20, baseProtein: 90, servingSize: '350g steak', flavors: ['any', 'classic', 'spicy', 'latin'], netCarbs: 0,
              ingredients: [
                { item: 'Ribeye or striploin steak', amount: '350g' },
                { item: 'Coarse salt', amount: '1 tsp' },
                { item: 'Black pepper', amount: '¬Ω tsp' },
                { item: 'Olive oil', amount: '2 tbsp' },
                { item: 'Butter', amount: '2 tbsp' },
                { item: 'Garlic cloves', amount: '2' },
                { item: 'Fresh thyme', amount: '2 sprigs' },
              ],
              steps: ['Bring steak to room temp (30 min)', 'Pat dry, season with salt', 'Smoking hot pan, add oil', 'Cook 3-4 min per side for medium', 'Rest 5 minutes, slice against grain'],
              tips: ['Dry surface = better crust', 'Only flip once'], doneness: 'Dark brown crust, pink center' },
            
            { id: 'beef_lebanese', name: 'Lebanese Beef Kebab', proteins: ['beef'], category: 'main', requiresVeggies: true, time: 25, baseProtein: 90, servingSize: '350g beef', flavors: ['mediterranean', 'spicy'], netCarbs: 4,
              ingredients: [
                { item: 'Beef sirloin, cubed', amount: '350g' },
                { item: 'Olive oil', amount: '3 tbsp' },
                { item: 'Lemon juice', amount: '2 tbsp' },
                { item: 'Garlic, minced', amount: '3 cloves' },
                { item: 'Seven spice (baharat)', amount: '1 tsp' },
                { item: 'Onion, chunked', amount: '1 medium' },
                { item: 'Bell pepper', amount: '1' },
                { item: 'Tahini', amount: '2 tbsp' },
              ],
              steps: ['Cube beef into 1-inch pieces', 'Marinate in olive oil, lemon, garlic, seven spice', 'Thread onto skewers with onion, peppers', 'Grill 3-4 min per side', 'Serve with tahini'],
              tips: ['Seven spice = allspice, pepper, cinnamon, nutmeg, cloves, ginger, coriander'] },
            
            { id: 'beef_stirfry', name: 'Ginger Beef Stir-Fry', proteins: ['beef'], category: 'main', requiresVeggies: true, time: 15, baseProtein: 90, servingSize: '350g flank steak', flavors: ['asian', 'spicy'], netCarbs: 5,
              ingredients: [
                { item: 'Flank steak, thinly sliced', amount: '350g' },
                { item: 'Coconut aminos', amount: '3 tbsp' },
                { item: 'Fresh ginger, minced', amount: '2 tbsp' },
                { item: 'Garlic, minced', amount: '3 cloves' },
                { item: 'Sesame oil', amount: '2 tbsp' },
                { item: 'Mixed stir-fry veggies', amount: '200g' },
                { item: 'Green onions', amount: '3 stalks' },
              ],
              steps: ['Slice beef very thin against grain', 'Marinate in coconut aminos, ginger, garlic', 'Hot wok with sesame oil', 'Sear beef 2 min, set aside', 'Stir-fry veggies, return beef, toss'],
              tips: ['Freeze beef 20 min for easier slicing', 'High heat essential for wok hei'] },
            
            { id: 'beef_kofta', name: 'Middle Eastern Kofta', proteins: ['beef'], category: 'main', requiresVeggies: true, time: 25, baseProtein: 90, servingSize: '350g ground beef', flavors: ['mediterranean', 'spicy'], netCarbs: 3,
              ingredients: [
                { item: 'Ground beef (80/20)', amount: '350g' },
                { item: 'Onion, finely minced', amount: '¬º cup' },
                { item: 'Fresh parsley', amount: '¬º cup' },
                { item: 'Cumin', amount: '1 tsp' },
                { item: 'Coriander', amount: '1 tsp' },
                { item: 'Cinnamon', amount: '¬º tsp' },
                { item: 'Salt', amount: '1 tsp' },
                { item: 'Tahini', amount: '2 tbsp' },
              ],
              steps: ['Mix beef with onion, parsley, spices', 'Form into oval shapes', 'Grill or pan-sear until cooked', 'Serve with tahini and salad'],
              tips: ['Use 80/20 beef for juicy kofta', 'Don\'t overwork the meat'] },
            
            { id: 'beef_chimichurri', name: 'Chimichurri Steak üáªüá™', proteins: ['beef'], category: 'main', requiresVeggies: true, time: 25, baseProtein: 90, servingSize: '350g steak', flavors: ['latin'], isVenezuelan: true, netCarbs: 2,
              ingredients: [
                { item: 'Flank or skirt steak', amount: '350g' },
                { item: 'Fresh parsley', amount: '1 cup' },
                { item: 'Fresh oregano', amount: '2 tbsp' },
                { item: 'Garlic cloves', amount: '4' },
                { item: 'Red wine vinegar', amount: '3 tbsp' },
                { item: 'Olive oil', amount: '¬Ω cup' },
                { item: 'Red pepper flakes', amount: '1 tsp' },
              ],
              steps: ['Season steak with salt and pepper', 'Grill to desired doneness', 'Blend chimichurri: parsley, oregano, garlic, vinegar, oil', 'Rest steak, slice thin', 'Drizzle chimichurri generously'],
              tips: ['Venezuelan/Argentine staple', 'Extra keeps 1 week in fridge'] },
            
            { id: 'asado_negro', name: 'Asado Negro üáªüá™', proteins: ['beef'], category: 'main', requiresVeggies: true, time: 90, baseProtein: 90, servingSize: '350g beef roast', flavors: ['latin'], isVenezuelan: true, netCarbs: 6,
              ingredients: [
                { item: 'Beef roast (eye round)', amount: '350g' },
                { item: 'Garlic, minced', amount: '6 cloves' },
                { item: 'Cumin', amount: '1 tsp' },
                { item: 'Coconut aminos', amount: '2 tbsp' },
                { item: 'Erythritol', amount: '2 tbsp' },
                { item: 'Onion, sliced', amount: '1 large' },
                { item: 'Bell pepper', amount: '1' },
                { item: 'Beef broth', amount: '1 cup' },
              ],
              steps: ['Season beef with garlic, cumin', 'Caramelize erythritol until dark', 'Sear beef in caramel', 'Add onions, peppers, broth', 'Slow cook 2 hours until tender'],
              tips: ['Keto-adapted with erythritol', 'Classic Venezuelan Sunday dish'] },
            
            { id: 'steak_eggs', name: 'Steak & Eggs', proteins: ['beef', 'eggs'], category: 'breakfast', requiresVeggies: true, time: 25, baseProtein: 95, servingSize: '250g steak + 3 eggs', flavors: ['any', 'classic', 'spicy', 'latin'], netCarbs: 1,
              ingredients: [
                { item: 'Sirloin or ribeye', amount: '250g' },
                { item: 'Eggs', amount: '3' },
                { item: 'Butter', amount: '2 tbsp' },
                { item: 'Salt', amount: '1 tsp' },
                { item: 'Black pepper', amount: '¬Ω tsp' },
              ],
              steps: ['Cook steak to desired doneness', 'While resting, cook eggs in same pan', 'Runny yolks are your sauce', 'Slice steak, plate with eggs'],
              tips: ['The steak pan fond flavors the eggs'] },
            
            { id: 'pabellon', name: 'Pabell√≥n Sin Arroz üáªüá™', proteins: ['beef', 'eggs'], category: 'main', requiresVeggies: true, time: 45, baseProtein: 92, servingSize: '300g carne mechada + 2 eggs', flavors: ['latin'], isVenezuelan: true, netCarbs: 6,
              ingredients: [
                { item: 'Flank steak', amount: '300g' },
                { item: 'Eggs', amount: '2' },
                { item: 'Onion, diced', amount: '1 medium' },
                { item: 'Bell pepper', amount: '1' },
                { item: 'Garlic, minced', amount: '4 cloves' },
                { item: 'Cumin', amount: '1 tsp' },
                { item: 'Paprika', amount: '1 tsp' },
                { item: 'Tomato sauce', amount: '¬º cup' },
              ],
              steps: ['Simmer flank steak until shreddable (1.5hr)', 'Shred with two forks while warm', 'Saut√© onion, peppers, garlic', 'Add beef, cumin, paprika, tomato', 'Fry eggs with crispy edges'],
              tips: ['Make big batch ‚Äî freezes perfectly', 'Eggs must have crispy edges üáªüá™'] },
        ];

        // ==================== RECIPES: GROUND BEEF ====================
        const groundBeefRecipes = [
            { id: 'lettuce_wraps', name: 'Asian Lettuce Wraps', proteins: ['ground'], category: 'main', requiresVeggies: true, time: 15, baseProtein: 88, servingSize: '350g ground beef', flavors: ['asian', 'spicy'], netCarbs: 4,
              ingredients: [
                { item: 'Ground beef', amount: '350g' },
                { item: 'Fresh ginger, minced', amount: '1 tbsp' },
                { item: 'Garlic, minced', amount: '3 cloves' },
                { item: 'Coconut aminos', amount: '3 tbsp' },
                { item: 'Sesame oil', amount: '1 tbsp' },
                { item: 'Butter lettuce', amount: '1 head' },
                { item: 'Green onions', amount: '3 stalks' },
                { item: 'Sesame seeds', amount: '1 tbsp' },
              ],
              steps: ['Brown ground beef over high heat', 'Add ginger, garlic, coconut aminos', 'Cook until caramelized', 'Spoon into butter lettuce cups', 'Top with green onions, sesame seeds'],
              tips: ['Butter lettuce makes best cups', 'PF Chang\'s inspired ‚Äî keto style'] },
            
            { id: 'ground_kofta', name: 'Lebanese Kofta Plate', proteins: ['ground'], category: 'main', requiresVeggies: true, time: 20, baseProtein: 88, servingSize: '350g ground beef', flavors: ['mediterranean'], netCarbs: 3,
              ingredients: [
                { item: 'Ground beef', amount: '350g' },
                { item: 'Onion, finely minced', amount: '¬º cup' },
                { item: 'Fresh parsley', amount: '¬º cup' },
                { item: 'Allspice', amount: '1 tsp' },
                { item: 'Cinnamon', amount: '¬º tsp' },
                { item: 'Salt', amount: '1 tsp' },
                { item: 'Tahini', amount: '3 tbsp' },
              ],
              steps: ['Mix beef with onion, parsley, spices', 'Form into flat patties or logs', 'Grill or pan-fry until cooked', 'Serve with fattoush-style salad', 'Drizzle with tahini'],
              tips: ['Don\'t skip the cinnamon', 'Great for meal prep'] },
            
            { id: 'ground_taco_bowl', name: 'Taco Bowl', proteins: ['ground'], category: 'main', requiresVeggies: true, time: 15, baseProtein: 88, servingSize: '350g ground beef', flavors: ['latin', 'spicy'], netCarbs: 5,
              ingredients: [
                { item: 'Ground beef', amount: '350g' },
                { item: 'Cumin', amount: '1 tsp' },
                { item: 'Chili powder', amount: '1 tsp' },
                { item: 'Paprika', amount: '¬Ω tsp' },
                { item: 'Tomato paste', amount: '1 tbsp' },
                { item: 'Shredded lettuce', amount: '2 cups' },
                { item: 'Avocado', amount: '¬Ω' },
                { item: 'Sour cream', amount: '2 tbsp' },
                { item: 'Cheddar cheese', amount: '30g' },
              ],
              steps: ['Brown beef with cumin, chili, paprika', 'Add tomato paste, splash of water', 'Simmer 5 min until thick', 'Serve over shredded lettuce', 'Top with guac, cheese, sour cream'],
              tips: ['All the flavor, no tortilla', 'Add jalape√±os for heat'] },
            
            { id: 'ground_stuffed_peppers', name: 'Stuffed Bell Peppers', proteins: ['ground'], category: 'main', requiresVeggies: true, requiresSpecific: ['peppers'], time: 35, baseProtein: 88, servingSize: '350g ground beef', flavors: ['any', 'mediterranean', 'latin'], netCarbs: 8,
              ingredients: [
                { item: 'Ground beef', amount: '350g' },
                { item: 'Bell peppers', amount: '2 large' },
                { item: 'Onion, diced', amount: '¬Ω cup' },
                { item: 'Garlic, minced', amount: '2 cloves' },
                { item: 'Diced tomatoes', amount: '¬Ω cup' },
                { item: 'Cheese', amount: '50g' },
                { item: 'Italian herbs', amount: '1 tsp' },
              ],
              steps: ['Cut tops off peppers, remove seeds', 'Brown beef with onions and garlic', 'Season and add diced tomatoes', 'Stuff peppers with mixture', 'Bake 25 min at 375¬∞F, cheese last 5 min'],
              tips: ['Med version: feta + oregano', 'Latin version: cumin + cilantro'] },
            
            { id: 'ground_zucchini_boats', name: 'Beef Zucchini Boats', proteins: ['ground'], category: 'main', requiresVeggies: true, requiresSpecific: ['zucchini'], time: 30, baseProtein: 88, servingSize: '350g ground beef', flavors: ['any', 'mediterranean', 'classic'], netCarbs: 6,
              ingredients: [
                { item: 'Ground beef', amount: '350g' },
                { item: 'Large zucchini', amount: '2' },
                { item: 'Garlic, minced', amount: '3 cloves' },
                { item: 'Tomato sauce', amount: '¬Ω cup' },
                { item: 'Italian herbs', amount: '1 tsp' },
                { item: 'Mozzarella', amount: '50g' },
                { item: 'Parmesan', amount: '2 tbsp' },
              ],
              steps: ['Halve zucchini, scoop out center', 'Brown beef with garlic and herbs', 'Add tomato sauce and seasonings', 'Fill zucchini boats', 'Top with cheese, bake 20 min at 400¬∞F'],
              tips: ['Salt zucchini first to remove moisture', 'Low-carb lasagna alternative'] },
            
            { id: 'ground_shakshuka', name: 'Meaty Shakshuka', proteins: ['ground', 'eggs'], category: 'breakfast', requiresVeggies: true, time: 25, baseProtein: 85, servingSize: '250g beef + 3 eggs', flavors: ['mediterranean', 'spicy'], netCarbs: 7,
              ingredients: [
                { item: 'Ground beef', amount: '250g' },
                { item: 'Eggs', amount: '3' },
                { item: 'Onion, diced', amount: '1 medium' },
                { item: 'Crushed tomatoes', amount: '1 cup' },
                { item: 'Bell pepper', amount: '1' },
                { item: 'Cumin', amount: '1 tsp' },
                { item: 'Paprika', amount: '1 tsp' },
                { item: 'Feta cheese', amount: '30g' },
              ],
              steps: ['Brown ground beef with onions', 'Add tomatoes, peppers, spices', 'Simmer 10 min', 'Make wells, crack in eggs', 'Cover until eggs set'],
              tips: ['Runny yolks are traditional', 'Middle Eastern comfort food'] },
        ];

        // ==================== RECIPES: SALMON ====================
        const salmonRecipes = [
            { id: 'salmon_crispy', name: 'Crispy Skin Salmon', proteins: ['salmon'], category: 'main', requiresVeggies: true, time: 15, baseProtein: 77, servingSize: '350g salmon', flavors: ['any', 'classic', 'mediterranean', 'asian'], netCarbs: 0,
              ingredients: [
                { item: 'Salmon fillet, skin-on', amount: '350g' },
                { item: 'Salt', amount: '1 tsp' },
                { item: 'Olive oil', amount: '2 tbsp' },
                { item: 'Lemon wedges', amount: '2' },
                { item: 'Fresh dill or parsley', amount: '2 tbsp' },
              ],
              steps: ['Pat salmon skin completely dry', 'Season flesh side only with salt', 'Hot pan, skin side DOWN first', 'Cook 5 min skin side, 2-3 min flesh', 'Remove when center slightly pink'],
              tips: ['80% cooking time skin-side down', 'Press flat first 30 seconds'], doneness: 'Skin crackling, flesh flakes' },
            
            { id: 'salmon_greek', name: 'Greek Salmon', proteins: ['salmon'], category: 'main', requiresVeggies: true, time: 25, baseProtein: 77, servingSize: '350g salmon', flavors: ['mediterranean'], netCarbs: 4,
              ingredients: [
                { item: 'Salmon fillet', amount: '350g' },
                { item: 'Dried oregano', amount: '1 tsp' },
                { item: 'Lemon zest', amount: '1 lemon' },
                { item: 'Garlic, minced', amount: '2 cloves' },
                { item: 'Cherry tomatoes', amount: '100g' },
                { item: 'Kalamata olives', amount: '30g' },
                { item: 'Capers', amount: '1 tbsp' },
                { item: 'Feta cheese', amount: '50g' },
              ],
              steps: ['Season salmon with oregano, lemon zest, garlic', 'Bake at 400¬∞F for 15 min', 'Top with tomatoes, olives, capers, feta', 'Return to oven 5 min', 'Finish with olive oil drizzle'],
              tips: ['Diet Doctor inspired', 'Feta melts beautifully on top'] },
            
            { id: 'salmon_teriyaki', name: 'Teriyaki Salmon (Keto)', proteins: ['salmon'], category: 'main', requiresVeggies: true, time: 20, baseProtein: 77, servingSize: '350g salmon', flavors: ['asian'], netCarbs: 3,
              ingredients: [
                { item: 'Salmon fillet', amount: '350g' },
                { item: 'Coconut aminos', amount: '3 tbsp' },
                { item: 'Fresh ginger, minced', amount: '1 tbsp' },
                { item: 'Garlic, minced', amount: '2 cloves' },
                { item: 'Erythritol', amount: '1 tbsp' },
                { item: 'Sesame oil', amount: '1 tsp' },
                { item: 'Sesame seeds', amount: '1 tbsp' },
              ],
              steps: ['Make keto teriyaki: coconut aminos, ginger, garlic, erythritol', 'Marinate salmon 20 min', 'Pan-sear salmon, flesh side first', 'Add marinade, reduce to glaze', 'Spoon glaze over salmon'],
              tips: ['Gordon Ramsay method', 'Coconut aminos = no-sugar soy'] },
            
            { id: 'salmon_lemon_garlic', name: 'Creamy Lemon Garlic Salmon', proteins: ['salmon'], category: 'main', requiresVeggies: true, time: 25, baseProtein: 77, servingSize: '350g salmon', flavors: ['classic', 'mediterranean'], netCarbs: 3,
              ingredients: [
                { item: 'Salmon fillet', amount: '350g' },
                { item: 'Heavy cream', amount: '150ml' },
                { item: 'Garlic, minced', amount: '4 cloves' },
                { item: 'Lemon juice', amount: '2 tbsp' },
                { item: 'Butter', amount: '2 tbsp' },
                { item: 'Fresh parsley', amount: '2 tbsp' },
                { item: 'Parmesan', amount: '2 tbsp' },
              ],
              steps: ['Season and sear salmon until golden', 'Remove and set aside', 'In same pan: cream, garlic, lemon, parsley', 'Simmer sauce 3 min', 'Return salmon, spoon sauce over'],
              tips: ['Restaurant quality', 'Use heavy cream'] },
            
            { id: 'salmon_salad', name: 'Salmon Power Salad', proteins: ['salmon'], category: 'cold', requiresVeggies: true, saladOnly: true, time: 20, baseProtein: 77, servingSize: '350g salmon', flavors: ['any', 'mediterranean', 'asian'], netCarbs: 5,
              ingredients: [
                { item: 'Salmon fillet', amount: '350g' },
                { item: 'Mixed greens', amount: '100g' },
                { item: 'Cucumber', amount: '100g' },
                { item: 'Cherry tomatoes', amount: '80g' },
                { item: 'Avocado', amount: '¬Ω' },
                { item: 'Olive oil', amount: '2 tbsp' },
                { item: 'Lemon juice', amount: '1 tbsp' },
              ],
              steps: ['Season salmon with salt and pepper', 'Pan-sear or bake until just cooked', 'Let cool slightly, flake into chunks', 'Build salad with greens', 'Top with salmon and dressing'],
              tips: ['Warm salmon on cold greens is perfect'], suggestDressing: true },
            
            { id: 'salmon_avocado', name: 'Salmon Avocado Bowl', proteins: ['salmon'], category: 'cold', requiresVeggies: true, time: 20, baseProtein: 77, servingSize: '350g salmon', flavors: ['asian', 'latin'], netCarbs: 6,
              ingredients: [
                { item: 'Salmon fillet', amount: '350g' },
                { item: 'Avocado', amount: '1' },
                { item: 'Cucumber', amount: '100g' },
                { item: 'Pickled ginger', amount: '2 tbsp' },
                { item: 'Sesame seeds', amount: '1 tbsp' },
                { item: 'Coconut aminos', amount: '2 tbsp' },
                { item: 'Sesame oil', amount: '1 tsp' },
                { item: 'Green onions', amount: '2 stalks' },
              ],
              steps: ['Season salmon with sesame and ginger', 'Pan-sear until medium', 'Flake salmon into bowl', 'Add avocado, cucumber, pickled ginger', 'Drizzle with aminos and sesame oil'],
              tips: ['Poke bowl without rice', 'Excellent omega-3 + healthy fats'] },
            
            { id: 'salmon_eggs', name: 'Salmon & Eggs Plate', proteins: ['salmon', 'eggs'], category: 'breakfast', requiresVeggies: true, time: 20, baseProtein: 90, servingSize: '250g salmon + 3 eggs', flavors: ['any', 'classic', 'mediterranean'], netCarbs: 1,
              ingredients: [
                { item: 'Salmon fillet', amount: '250g' },
                { item: 'Eggs', amount: '3' },
                { item: 'Butter', amount: '2 tbsp' },
                { item: 'Fresh dill', amount: '1 tbsp' },
                { item: 'Capers (optional)', amount: '1 tsp' },
              ],
              steps: ['Cook salmon in pan until done', 'Set aside and keep warm', 'Scramble or fry eggs in same pan', 'Plate together with veggies'],
              tips: ['Salmon fat flavors the eggs', 'Great for brunch'] },
        ];

        // ==================== RECIPES: WHITE FISH ====================
        const whiteFishRecipes = [
            { id: 'fish_mediterranean', name: 'Mediterranean Baked Fish', proteins: ['fish'], category: 'main', requiresVeggies: true, time: 25, baseProtein: 70, servingSize: '350g white fish', flavors: ['any', 'mediterranean', 'classic'], netCarbs: 4,
              ingredients: [
                { item: 'White fish fillet (cod, bass)', amount: '350g' },
                { item: 'Cherry tomatoes', amount: '100g' },
                { item: 'Kalamata olives', amount: '30g' },
                { item: 'Capers', amount: '1 tbsp' },
                { item: 'Olive oil', amount: '3 tbsp' },
                { item: 'Dried oregano', amount: '1 tsp' },
                { item: 'Lemon', amount: '1' },
              ],
              steps: ['Preheat oven to 400¬∞F', 'Season fish with salt, pepper, oregano', 'Place on baking sheet with olive oil', 'Add tomatoes, olives, capers around fish', 'Bake 15-18 min until flaky'],
              tips: ['Don\'t overcook white fish', 'Lemon juice at end brightens everything'], doneness: 'Opaque, flakes easily' },
            
            { id: 'fish_panfried', name: 'Pan-Fried White Fish', proteins: ['fish'], category: 'main', requiresVeggies: true, time: 15, baseProtein: 70, servingSize: '350g white fish', flavors: ['any', 'classic', 'mediterranean', 'latin'], netCarbs: 0,
              ingredients: [
                { item: 'White fish fillet', amount: '350g' },
                { item: 'Butter', amount: '2 tbsp' },
                { item: 'Olive oil', amount: '1 tbsp' },
                { item: 'Salt', amount: '1 tsp' },
                { item: 'Lemon', amount: '1' },
                { item: 'Fresh parsley', amount: '2 tbsp' },
              ],
              steps: ['Pat fish completely dry', 'Season with salt and pepper', 'Hot pan with butter and oil', 'Cook 3-4 min per side', 'Finish with lemon and herbs'],
              tips: ['Don\'t move it ‚Äî let crust form', 'Done when flakes with fork'], doneness: 'Golden outside, opaque inside' },
            
            { id: 'fish_parmesan', name: 'Parmesan Crusted Fish', proteins: ['fish'], category: 'main', requiresVeggies: true, time: 20, baseProtein: 70, servingSize: '350g white fish', flavors: ['classic', 'mediterranean'], netCarbs: 2,
              ingredients: [
                { item: 'White fish fillet', amount: '350g' },
                { item: 'Parmesan, grated', amount: '50g' },
                { item: 'Almond flour', amount: '2 tbsp' },
                { item: 'Garlic powder', amount: '¬Ω tsp' },
                { item: 'Paprika', amount: '¬Ω tsp' },
                { item: 'Avocado oil mayo', amount: '2 tbsp' },
                { item: 'Lemon', amount: '1' },
              ],
              steps: ['Mix parmesan, almond flour, garlic, paprika', 'Pat fish dry, brush with avocado oil mayo', 'Press parmesan mixture onto fish', 'Bake at 400¬∞F for 15 min', 'Broil 2 min for golden crust'],
              tips: ['Air fryer: 8 min at 400¬∞F', 'Avocado oil mayo helps crust stick'] },
            
            { id: 'fish_coconut_curry', name: 'Thai Coconut Fish Curry', proteins: ['fish'], category: 'soup', requiresVeggies: true, time: 25, baseProtein: 70, servingSize: '350g white fish', flavors: ['asian', 'spicy'], netCarbs: 6,
              ingredients: [
                { item: 'White fish, cubed', amount: '350g' },
                { item: 'Coconut milk (full-fat)', amount: '400ml' },
                { item: 'Thai red curry paste', amount: '2 tbsp' },
                { item: 'Fish sauce', amount: '1 tbsp' },
                { item: 'Lime juice', amount: '2 tbsp' },
                { item: 'Garlic, minced', amount: '3 cloves' },
                { item: 'Ginger, minced', amount: '1 tbsp' },
                { item: 'Thai basil', amount: '¬º cup' },
              ],
              steps: ['Saut√© garlic, ginger, curry paste', 'Add coconut milk, fish sauce, lime', 'Simmer 5 min', 'Add fish chunks gently', 'Cook 8-10 min until fish flakes'],
              tips: ['Use full-fat coconut milk', 'Don\'t stir much ‚Äî fish breaks'] },
            
            { id: 'fish_tacos', name: 'Fish Taco Bowl', proteins: ['fish'], category: 'main', requiresVeggies: true, time: 20, baseProtein: 70, servingSize: '350g white fish', flavors: ['latin', 'spicy'], netCarbs: 5,
              ingredients: [
                { item: 'White fish fillet', amount: '350g' },
                { item: 'Cumin', amount: '1 tsp' },
                { item: 'Paprika', amount: '1 tsp' },
                { item: 'Garlic powder', amount: '¬Ω tsp' },
                { item: 'Shredded lettuce', amount: '2 cups' },
                { item: 'Avocado', amount: '1' },
                { item: 'Sour cream', amount: '2 tbsp' },
                { item: 'Lime', amount: '1' },
                { item: 'Fresh cilantro', amount: '2 tbsp' },
              ],
              steps: ['Season fish with cumin, paprika, garlic', 'Pan-fry until golden and cooked', 'Break into chunks', 'Serve over lettuce with avocado', 'Top with lime crema and cilantro'],
              tips: ['Taco filling without tortilla', 'Guasacaca dressing is perfect'], suggestDressing: true },
            
            { id: 'fish_lebanese', name: 'Lebanese Samke Harra', proteins: ['fish'], category: 'main', requiresVeggies: true, time: 30, baseProtein: 70, servingSize: '350g white fish', flavors: ['mediterranean', 'spicy'], netCarbs: 5,
              ingredients: [
                { item: 'White fish fillet', amount: '350g' },
                { item: 'Tahini', amount: '3 tbsp' },
                { item: 'Lemon juice', amount: '3 tbsp' },
                { item: 'Garlic, minced', amount: '4 cloves' },
                { item: 'Fresh cilantro', amount: '¬º cup' },
                { item: 'Cayenne pepper', amount: '¬Ω tsp' },
                { item: 'Cumin', amount: '1 tsp' },
                { item: 'Onion, caramelized', amount: '1 large' },
                { item: 'Pine nuts', amount: '2 tbsp' },
              ],
              steps: ['Season fish with salt, cumin', 'Pan-fry until golden', 'Make sauce: tahini, lemon, garlic, cilantro, chili', 'Top fish with caramelized onions', 'Drizzle spicy tahini sauce'],
              tips: ['Classic Lebanese spicy fish', 'The tahini sauce is incredible'] },
            
            { id: 'fish_eggs', name: 'Fish & Eggs Plate', proteins: ['fish', 'eggs'], category: 'breakfast', requiresVeggies: true, time: 18, baseProtein: 82, servingSize: '250g fish + 3 eggs', flavors: ['any', 'classic', 'mediterranean'], netCarbs: 1,
              ingredients: [
                { item: 'White fish fillet', amount: '250g' },
                { item: 'Eggs', amount: '3' },
                { item: 'Butter', amount: '2 tbsp' },
                { item: 'Lemon', amount: '1' },
                { item: 'Fresh herbs', amount: '2 tbsp' },
              ],
              steps: ['Pan-fry fish until cooked', 'Set aside, keep warm', 'Fry or scramble eggs in same pan', 'Plate together with veggies and lemon'],
              tips: ['Light but filling ‚Äî great for lunch', 'Add avocado for healthy fats'] },
        ];
        // ==================== RECIPES: SHRIMP ====================
        const shrimpRecipes = [
            { id: 'shrimp_garlic', name: 'Garlic Butter Shrimp', proteins: ['shrimp'], category: 'main', requiresVeggies: true, time: 12, baseProtein: 60, servingSize: '300g shrimp', flavors: ['any', 'classic', 'spicy', 'latin'], lowProteinWarning: true, netCarbs: 2,
              ingredients: [{ item: 'Shrimp, peeled', amount: '300g' }, { item: 'Butter', amount: '3 tbsp' }, { item: 'Garlic, minced', amount: '5 cloves' }, { item: 'Lemon juice', amount: '2 tbsp' }, { item: 'Fresh parsley', amount: '2 tbsp' }],
              steps: ['Pat shrimp dry, season with salt', 'Hot pan with butter and garlic', 'Add shrimp in single layer', 'Cook 2 min per side until pink', 'Finish with lemon and parsley'],
              tips: ['‚ö†Ô∏è Only ~60g protein ‚Äî add another protein', 'Remove when they turn pink'], doneness: 'Pink, slightly curled' },
            { id: 'shrimp_stirfry', name: 'Ginger Shrimp Stir-Fry', proteins: ['shrimp'], category: 'main', requiresVeggies: true, time: 15, baseProtein: 60, servingSize: '300g shrimp', flavors: ['asian', 'spicy'], lowProteinWarning: true, netCarbs: 5,
              ingredients: [{ item: 'Shrimp, peeled', amount: '300g' }, { item: 'Fresh ginger', amount: '2 tbsp' }, { item: 'Garlic', amount: '3 cloves' }, { item: 'Sesame oil', amount: '2 tbsp' }, { item: 'Coconut aminos', amount: '2 tbsp' }, { item: 'Mixed vegetables', amount: '200g' }],
              steps: ['Pat shrimp dry', 'Hot wok with sesame oil', 'Add ginger, garlic, chili ‚Äî 30 sec', 'Add shrimp, cook 2 min per side', 'Toss with aminos and veggies'],
              tips: ['‚ö†Ô∏è Low protein ‚Äî consider adding eggs', 'Everything cooks fast ‚Äî prep ahead'] },
            { id: 'shrimp_saganaki', name: 'Greek Shrimp Saganaki', proteins: ['shrimp'], category: 'main', requiresVeggies: true, time: 20, baseProtein: 60, servingSize: '300g shrimp', flavors: ['mediterranean'], lowProteinWarning: true, netCarbs: 6,
              ingredients: [{ item: 'Shrimp, peeled', amount: '300g' }, { item: 'Diced tomatoes', amount: '200g' }, { item: 'Feta cheese', amount: '80g' }, { item: 'Garlic', amount: '3 cloves' }, { item: 'Dried oregano', amount: '1 tsp' }, { item: 'Olive oil', amount: '2 tbsp' }],
              steps: ['Saut√© garlic in olive oil', 'Add tomatoes, oregano', 'Simmer 10 min', 'Add shrimp, cook until pink', 'Top with crumbled feta'],
              tips: ['‚ö†Ô∏è Low protein ‚Äî add feta generously', 'Classic Greek taverna dish'] },
            { id: 'shrimp_kungpao', name: 'Kung Pao Shrimp (Keto)', proteins: ['shrimp'], category: 'main', requiresVeggies: true, time: 15, baseProtein: 60, servingSize: '300g shrimp', flavors: ['asian', 'spicy'], lowProteinWarning: true, netCarbs: 6,
              ingredients: [{ item: 'Shrimp, peeled', amount: '300g' }, { item: 'Coconut aminos', amount: '3 tbsp' }, { item: 'Rice vinegar', amount: '1 tbsp' }, { item: 'Dried red chilies', amount: '6-8' }, { item: 'Peanuts', amount: '30g' }, { item: 'Bell pepper', amount: '1' }],
              steps: ['Mix sauce: aminos, vinegar', 'Hot wok, sear shrimp, set aside', 'Stir-fry chilies, garlic', 'Add peppers, return shrimp', 'Toss with sauce and peanuts'],
              tips: ['‚ö†Ô∏è Low protein ‚Äî add extra shrimp/eggs', 'Authentic Sichuan flavor'] },
            { id: 'shrimp_salad', name: 'Shrimp Power Salad', proteins: ['shrimp'], category: 'cold', requiresVeggies: true, saladOnly: true, time: 15, baseProtein: 60, servingSize: '300g shrimp', flavors: ['any', 'mediterranean', 'latin', 'asian'], lowProteinWarning: true, netCarbs: 5,
              ingredients: [{ item: 'Shrimp, peeled', amount: '300g' }, { item: 'Mixed greens', amount: '100g' }, { item: 'Avocado', amount: '¬Ω' }, { item: 'Cherry tomatoes', amount: '80g' }, { item: 'Olive oil', amount: '2 tbsp' }],
              steps: ['Season and cook shrimp quickly', 'Let cool slightly', 'Build salad with greens', 'Top with shrimp', 'Drizzle with dressing'],
              tips: ['‚ö†Ô∏è Add cheese/eggs for more protein'], suggestDressing: true },
            { id: 'shrimp_eggs', name: 'Shrimp & Eggs Scramble', proteins: ['shrimp', 'eggs'], category: 'breakfast', requiresVeggies: true, time: 15, baseProtein: 75, servingSize: '200g shrimp + 4 eggs', flavors: ['any', 'asian', 'classic'], netCarbs: 2,
              ingredients: [{ item: 'Shrimp, peeled', amount: '200g' }, { item: 'Eggs', amount: '4' }, { item: 'Butter', amount: '2 tbsp' }, { item: 'Green onions', amount: '2 stalks' }, { item: 'Sesame oil', amount: '1 tsp' }],
              steps: ['Cook shrimp until pink, set aside', 'Beat eggs with salt', 'Scramble eggs in butter over low', 'Fold in shrimp at the end', 'Top with green onions'],
              tips: ['Chinese-style shrimp with eggs', 'Eggs add needed protein'] },
        ];

        // ==================== RECIPES: LAMB ====================
        const lambRecipes = [
            { id: 'lamb_chops', name: 'Herb-Crusted Lamb Chops', proteins: ['lamb'], category: 'main', requiresVeggies: true, time: 20, baseProtein: 88, servingSize: '350g lamb chops', flavors: ['any', 'classic', 'mediterranean', 'spicy'], netCarbs: 0,
              ingredients: [{ item: 'Lamb chops', amount: '350g' }, { item: 'Fresh rosemary', amount: '2 tbsp' }, { item: 'Fresh thyme', amount: '1 tbsp' }, { item: 'Garlic', amount: '3 cloves' }, { item: 'Olive oil', amount: '2 tbsp' }],
              steps: ['Bring lamb to room temp', 'Season with herbs, salt, pepper', 'High heat pan or grill', 'Sear 3-4 min per side', 'Rest 5 minutes'],
              tips: ['Lamb loves high heat, quick cook', 'Medium-rare (130¬∞F) is ideal'], doneness: 'Browned outside, pink inside' },
            { id: 'lamb_shawarma', name: 'Lamb Shawarma Bowl', proteins: ['lamb'], category: 'main', requiresVeggies: true, time: 25, baseProtein: 88, servingSize: '350g lamb', flavors: ['mediterranean', 'spicy'], netCarbs: 4,
              ingredients: [{ item: 'Lamb leg, sliced', amount: '350g' }, { item: 'Cumin', amount: '1 tsp' }, { item: 'Coriander', amount: '1 tsp' }, { item: 'Turmeric', amount: '¬Ω tsp' }, { item: 'Garlic', amount: '4 cloves' }, { item: 'Tahini', amount: '3 tbsp' }],
              steps: ['Marinate lamb in spices', 'Pan-sear on high until caramelized', 'Serve over greens', 'Top with pickled turnips, tahini', 'Add parsley and sumac'],
              tips: ['Lebanese street food favorite', 'The spice mix is special'] },
            { id: 'lamb_mediterranean', name: 'Mediterranean Lamb Plate', proteins: ['lamb'], category: 'main', requiresVeggies: true, time: 25, baseProtein: 88, servingSize: '350g lamb', flavors: ['mediterranean'], netCarbs: 4,
              ingredients: [{ item: 'Lamb chops or leg', amount: '350g' }, { item: 'Dried oregano', amount: '1 tbsp' }, { item: 'Lemon zest', amount: '1 lemon' }, { item: 'Feta cheese', amount: '50g' }, { item: 'Cucumber', amount: '100g' }, { item: 'Olive oil', amount: '3 tbsp' }],
              steps: ['Season lamb with oregano, garlic, lemon', 'Sear until browned', 'Rest and slice', 'Serve with cucumber, tomato, feta', 'Drizzle with olive oil'],
              tips: ['Deconstructed Greek dish', 'Tzatziki goes perfectly'] },
            { id: 'lamb_kofta', name: 'Lamb Kofta Kebabs', proteins: ['lamb'], category: 'main', requiresVeggies: true, time: 25, baseProtein: 88, servingSize: '350g ground lamb', flavors: ['mediterranean', 'spicy'], netCarbs: 3,
              ingredients: [{ item: 'Ground lamb', amount: '350g' }, { item: 'Onion, minced', amount: '¬º cup' }, { item: 'Fresh parsley', amount: '¬º cup' }, { item: 'Cumin', amount: '1 tsp' }, { item: 'Cinnamon', amount: '¬º tsp' }, { item: 'Tahini', amount: '3 tbsp' }],
              steps: ['Mix lamb with onion, herbs, spices', 'Form into ovals around skewers', 'Grill 4-5 min per side', 'Serve with tahini and salad', 'Garnish with fresh mint'],
              tips: ['Classic Middle Eastern dish', 'Don\'t overwork the meat'] },
            { id: 'lamb_spicy', name: 'Spicy Cumin Lamb', proteins: ['lamb'], category: 'main', requiresVeggies: true, time: 15, baseProtein: 88, servingSize: '350g lamb', flavors: ['spicy', 'asian'], netCarbs: 3,
              ingredients: [{ item: 'Lamb leg, sliced', amount: '350g' }, { item: 'Cumin seeds', amount: '2 tbsp' }, { item: 'Chili flakes', amount: '1 tbsp' }, { item: 'Garlic', amount: '4 cloves' }, { item: 'Ginger', amount: '1 tbsp' }, { item: 'Sesame oil', amount: '2 tbsp' }],
              steps: ['Slice lamb thin', 'Season with cumin, chili, garlic, ginger', 'Hot wok, cook quickly 2-3 min', 'Add peppers and onions', 'Finish with sesame oil and cilantro'],
              tips: ['Famous Xi\'an Chinese dish', 'Don\'t overcrowd the wok'] },
            { id: 'lamb_eggs', name: 'Lamb & Eggs Mediterranean', proteins: ['lamb', 'eggs'], category: 'breakfast', requiresVeggies: true, time: 25, baseProtein: 95, servingSize: '250g lamb + 3 eggs', flavors: ['mediterranean', 'spicy'], netCarbs: 6,
              ingredients: [{ item: 'Lamb, diced', amount: '250g' }, { item: 'Eggs', amount: '3' }, { item: 'Diced tomatoes', amount: '200g' }, { item: 'Cumin', amount: '1 tsp' }, { item: 'Paprika', amount: '1 tsp' }, { item: 'Feta cheese', amount: '50g' }],
              steps: ['Sear lamb until browned', 'Add tomatoes, onions, spices', 'Make wells, crack in eggs', 'Cover until eggs set', 'Top with feta and herbs'],
              tips: ['Shakshuka with lamb', 'Great for weekend brunch'] },
        ];

        // ==================== RECIPES: PORK ====================
        const porkRecipes = [
            { id: 'pork_chops', name: 'Juicy Pork Chops', proteins: ['pork'], category: 'main', requiresVeggies: true, time: 25, baseProtein: 88, servingSize: '350g pork chops', flavors: ['any', 'classic', 'latin', 'spicy'], netCarbs: 0,
              ingredients: [{ item: 'Pork chops (bone-in)', amount: '350g' }, { item: 'Salt', amount: '1 tsp' }, { item: 'Garlic powder', amount: '¬Ω tsp' }, { item: 'Butter', amount: '3 tbsp' }, { item: 'Fresh thyme', amount: '3 sprigs' }],
              steps: ['Pat dry, season generously', 'Medium-high pan with butter', 'Sear 4-5 min per side', 'Baste with butter last 2 min', 'Rest 3 minutes'],
              tips: ['145¬∞F is safe AND juicy', 'Bone-in = more forgiving'], doneness: 'Golden, slightly pink inside' },
            { id: 'pork_tenderloin', name: 'Garlic Herb Pork Tenderloin', proteins: ['pork'], category: 'main', requiresVeggies: true, time: 30, baseProtein: 88, servingSize: '350g tenderloin', flavors: ['any', 'classic', 'mediterranean'], netCarbs: 1,
              ingredients: [{ item: 'Pork tenderloin', amount: '350g' }, { item: 'Garlic', amount: '5 cloves' }, { item: 'Fresh rosemary', amount: '2 tbsp' }, { item: 'Fresh thyme', amount: '1 tbsp' }, { item: 'Olive oil', amount: '3 tbsp' }, { item: 'Dijon mustard', amount: '1 tbsp' }],
              steps: ['Rub with garlic, herbs, olive oil', 'Sear all sides in hot pan', 'Finish in 400¬∞F oven 15-18 min', 'Rest 5 minutes', 'Slice into medallions'],
              tips: ['Tenderloin is lean ‚Äî don\'t overcook', '145¬∞F internal temp'], doneness: 'Slightly pink in center' },
            { id: 'pork_stirfry', name: 'Ginger Pork Stir-Fry', proteins: ['pork'], category: 'main', requiresVeggies: true, time: 15, baseProtein: 88, servingSize: '350g pork', flavors: ['asian', 'spicy'], netCarbs: 5,
              ingredients: [{ item: 'Pork loin, sliced', amount: '350g' }, { item: 'Coconut aminos', amount: '3 tbsp' }, { item: 'Ginger', amount: '2 tbsp' }, { item: 'Garlic', amount: '3 cloves' }, { item: 'Sesame oil', amount: '2 tbsp' }, { item: 'Mixed vegetables', amount: '200g' }],
              steps: ['Slice pork thin', 'Marinate in aminos, ginger, garlic', 'Hot wok with sesame oil', 'Cook pork 3-4 min', 'Add veggies, toss with sauce'],
              tips: ['Slice against the grain', 'Cook in batches if needed'] },
            { id: 'pork_carnitas', name: 'Carnitas Bowl üáªüá™', proteins: ['pork'], category: 'main', requiresVeggies: true, time: 60, baseProtein: 88, servingSize: '350g pork shoulder', flavors: ['latin', 'spicy'], isVenezuelan: true, netCarbs: 5,
              ingredients: [{ item: 'Pork shoulder', amount: '350g' }, { item: 'Cumin', amount: '1 tsp' }, { item: 'Oregano', amount: '1 tsp' }, { item: 'Garlic', amount: '5 cloves' }, { item: 'Orange juice', amount: '2 tbsp' }, { item: 'Guacamole', amount: '100g' }],
              steps: ['Season pork with spices, citrus', 'Slow cook until falling apart', 'Shred and crisp under broiler', 'Serve over lettuce with guac', 'Top with pickled onions'],
              tips: ['Mexican/Venezuelan favorite', 'The crispy edges are the best'] },
            { id: 'pork_souvlaki', name: 'Greek Pork Souvlaki', proteins: ['pork'], category: 'main', requiresVeggies: true, time: 25, baseProtein: 88, servingSize: '350g pork', flavors: ['mediterranean'], netCarbs: 3,
              ingredients: [{ item: 'Pork loin, cubed', amount: '350g' }, { item: 'Lemon juice', amount: '3 tbsp' }, { item: 'Dried oregano', amount: '1 tbsp' }, { item: 'Garlic', amount: '4 cloves' }, { item: 'Olive oil', amount: '3 tbsp' }, { item: 'Greek yogurt (tzatziki)', amount: '100g' }],
              steps: ['Marinate pork in lemon, oregano, garlic', 'Thread onto skewers', 'Grill 4-5 min per side', 'Serve with tzatziki and Greek salad', 'Top with fresh dill'],
              tips: ['Classic Greek street food', 'Marinate overnight for best flavor'] },
            { id: 'pork_eggs', name: 'Pork & Eggs Breakfast', proteins: ['pork', 'eggs'], category: 'breakfast', requiresVeggies: true, time: 20, baseProtein: 95, servingSize: '250g pork + 3 eggs', flavors: ['any', 'classic', 'latin'], netCarbs: 2,
              ingredients: [{ item: 'Pork chop or tenderloin', amount: '250g' }, { item: 'Eggs', amount: '3' }, { item: 'Butter', amount: '2 tbsp' }, { item: 'Avocado', amount: '¬Ω' }],
              steps: ['Cook pork to desired doneness', 'Set aside, keep warm', 'Fry eggs in same pan', 'Plate together with saut√©ed veggies'],
              tips: ['Perfect high-protein breakfast', 'Add avocado for healthy fats'] },
        ];

        // ==================== RECIPES: EGGS ====================
        const eggRecipes = [
            { id: 'egg_scramble', name: 'Ultimate Egg Scramble', proteins: ['eggs'], category: 'breakfast', requiresVeggies: false, time: 10, baseProtein: 36, servingSize: '6 eggs', flavors: ['any', 'classic', 'mediterranean', 'spicy'], lowProteinWarning: true, netCarbs: 1,
              ingredients: [{ item: 'Eggs', amount: '6' }, { item: 'Butter', amount: '2 tbsp' }, { item: 'Salt', amount: '¬Ω tsp' }, { item: 'Fresh herbs (optional)', amount: '1 tbsp' }],
              steps: ['Beat 6 eggs with salt', 'Melt butter over LOW heat', 'Add eggs, stir slowly with spatula', 'Remove while still slightly wet'],
              tips: ['‚ö†Ô∏è Only ~36g protein ‚Äî add meat side', 'Gordon Ramsay method: low heat = creamy'], doneness: 'Soft, creamy curds' },
            { id: 'egg_frittata', name: 'Loaded Veggie Frittata', proteins: ['eggs'], category: 'breakfast', requiresVeggies: true, time: 25, baseProtein: 42, servingSize: '7 eggs', flavors: ['any', 'mediterranean', 'classic'], lowProteinWarning: true, netCarbs: 4,
              ingredients: [{ item: 'Eggs', amount: '7' }, { item: 'Mixed vegetables', amount: '150g' }, { item: 'Cheese', amount: '50g' }, { item: 'Olive oil', amount: '2 tbsp' }, { item: 'Fresh herbs', amount: '2 tbsp' }],
              steps: ['Saut√© veggies in oven-safe pan', 'Beat eggs with cheese, herbs', 'Pour eggs over veggies', 'Cook on stovetop 5 min until edges set', 'Finish under broiler 3-4 min'],
              tips: ['‚ö†Ô∏è Only ~42g protein ‚Äî add meat or cheese', 'Great for meal prep ‚Äî lasts 4 days'] },
            { id: 'egg_shakshuka', name: 'Classic Shakshuka', proteins: ['eggs'], category: 'breakfast', requiresVeggies: true, time: 25, baseProtein: 36, servingSize: '6 eggs', flavors: ['mediterranean', 'spicy'], lowProteinWarning: true, netCarbs: 8,
              ingredients: [{ item: 'Eggs', amount: '6' }, { item: 'Crushed tomatoes', amount: '400g' }, { item: 'Onion', amount: '1' }, { item: 'Bell pepper', amount: '1' }, { item: 'Cumin', amount: '1 tsp' }, { item: 'Paprika', amount: '1 tsp' }, { item: 'Feta', amount: '50g' }],
              steps: ['Saut√© onion, peppers, garlic', 'Add tomatoes, cumin, paprika', 'Simmer 10 min until thick', 'Make wells, crack in eggs', 'Cover until eggs set'],
              tips: ['‚ö†Ô∏è Add feta or meat for more protein', 'Middle Eastern comfort food'] },
        ];
        // ==================== NEW: BREAKFAST RECIPES ====================
        const breakfastRecipes = [
            { id: 'bfast_egg_muffins', name: 'Egg Muffins (Meal Prep)', proteins: ['eggs'], category: 'breakfast', requiresVeggies: true, time: 30, baseProtein: 42, servingSize: '6 muffins (7 eggs)', flavors: ['any', 'classic', 'mediterranean'], lowProteinWarning: true, netCarbs: 3,
              ingredients: [{ item: 'Eggs', amount: '7' }, { item: 'Diced bell peppers', amount: '¬Ω cup' }, { item: 'Spinach, chopped', amount: '1 cup' }, { item: 'Cheese', amount: '50g' }, { item: 'Cooked bacon/sausage (optional)', amount: '100g' }],
              steps: ['Preheat oven to 350¬∞F', 'Grease muffin tin well', 'Whisk eggs with salt, pepper', 'Divide veggies and cheese into cups', 'Pour egg mixture, bake 20-25 min'],
              tips: ['‚ö†Ô∏è Add meat for more protein', 'Keeps 5 days in fridge, freezes great'] },
            { id: 'bfast_power_bowl', name: 'Keto Breakfast Bowl', proteins: ['eggs'], category: 'breakfast', requiresVeggies: true, time: 15, baseProtein: 40, servingSize: '4 eggs + veggies', flavors: ['any', 'latin', 'mediterranean'], lowProteinWarning: true, netCarbs: 6,
              ingredients: [{ item: 'Eggs', amount: '4' }, { item: 'Avocado', amount: '1' }, { item: 'Cherry tomatoes', amount: '80g' }, { item: 'Saut√©ed spinach', amount: '1 cup' }, { item: 'Feta or cheese', amount: '30g' }, { item: 'Olive oil', amount: '2 tbsp' }],
              steps: ['Fry or poach eggs to preference', 'Saut√© spinach with garlic', 'Slice avocado and tomatoes', 'Assemble bowl with all components', 'Drizzle with olive oil, season'],
              tips: ['‚ö†Ô∏è Add bacon/sausage for more protein', 'Perfect Dubai heat breakfast ‚Äî light but filling'] },
            { id: 'bfast_cloud_eggs', name: 'Cloud Eggs', proteins: ['eggs'], category: 'breakfast', requiresVeggies: false, time: 15, baseProtein: 24, servingSize: '4 eggs', flavors: ['classic'], lowProteinWarning: true, netCarbs: 1,
              ingredients: [{ item: 'Eggs', amount: '4' }, { item: 'Salt', amount: '¬º tsp' }, { item: 'Parmesan', amount: '2 tbsp' }, { item: 'Fresh chives', amount: '1 tbsp' }],
              steps: ['Separate egg whites and yolks', 'Whip whites to stiff peaks with salt', 'Fold in parmesan', 'Form nests on baking sheet', 'Add yolk to center, bake 8 min at 450¬∞F'],
              tips: ['‚ö†Ô∏è Very low protein ‚Äî serve with meat', 'Impressive presentation for brunch'] },
            { id: 'bfast_bacon_cheese_cups', name: 'Bacon & Cheese Egg Cups', proteins: ['eggs', 'pork'], category: 'breakfast', requiresVeggies: false, time: 25, baseProtein: 70, servingSize: '4 eggs + bacon', flavors: ['classic', 'spicy'], netCarbs: 1,
              ingredients: [{ item: 'Eggs', amount: '4' }, { item: 'Bacon strips', amount: '8' }, { item: 'Cheddar cheese', amount: '50g' }, { item: 'Green onions', amount: '2' }, { item: 'Salt & pepper', amount: 'to taste' }],
              steps: ['Line muffin cups with bacon strips', 'Par-bake bacon 10 min at 375¬∞F', 'Crack egg into each cup', 'Top with cheese', 'Bake 12-15 min until set'],
              tips: ['The bacon becomes the cup!', 'Great grab-and-go breakfast'] },
        ];

        // ==================== NEW: SOUP RECIPES ====================
        const soupRecipes = [
            { id: 'soup_sancocho', name: 'Sancocho Criollo üáªüá™', proteins: ['chicken'], category: 'soup', requiresVeggies: true, time: 60, baseProtein: 85, servingSize: '400g chicken + broth', flavors: ['latin'], isVenezuelan: true, netCarbs: 8,
              ingredients: [{ item: 'Chicken thighs (bone-in)', amount: '400g' }, { item: 'Beef broth', amount: '4 cups' }, { item: 'Zucchini (replaces yuca)', amount: '200g' }, { item: 'Chayote', amount: '1' }, { item: 'Corn on cob (small piece)', amount: '1' }, { item: 'Cilantro', amount: '¬Ω cup' }, { item: 'Garlic', amount: '4 cloves' }, { item: 'Cumin', amount: '1 tsp' }],
              steps: ['Brown chicken pieces in pot', 'Add broth, garlic, cumin, bring to boil', 'Simmer 30 min', 'Add zucchini, chayote, corn', 'Cook 20 min more, add cilantro'],
              tips: ['Traditional Venezuelan soup ‚Äî adapted for your protocol', 'Small corn piece is fine ‚Äî skip if you want fewer carbs'] },
            { id: 'soup_tom_yum', name: 'Tom Yum Shrimp Soup', proteins: ['shrimp'], category: 'soup', requiresVeggies: true, time: 25, baseProtein: 60, servingSize: '300g shrimp', flavors: ['asian', 'spicy'], lowProteinWarning: true, netCarbs: 5,
              ingredients: [{ item: 'Shrimp', amount: '300g' }, { item: 'Chicken broth', amount: '4 cups' }, { item: 'Lemongrass', amount: '2 stalks' }, { item: 'Galangal or ginger', amount: '2 tbsp' }, { item: 'Lime juice', amount: '3 tbsp' }, { item: 'Fish sauce', amount: '2 tbsp' }, { item: 'Thai chilies', amount: '3-4' }, { item: 'Mushrooms', amount: '100g' }],
              steps: ['Simmer broth with lemongrass, galangal', 'Add mushrooms, cook 5 min', 'Add shrimp, cook until pink', 'Season with fish sauce, lime, chilies', 'Serve with fresh cilantro'],
              tips: ['‚ö†Ô∏è Add eggs for more protein', 'Classic Thai soup ‚Äî naturally low carb'] },
            { id: 'soup_bone_broth', name: 'Healing Bone Broth Bowl', proteins: ['beef'], category: 'soup', requiresVeggies: true, time: 20, baseProtein: 75, servingSize: '250g beef + broth', flavors: ['asian', 'classic'], netCarbs: 3,
              ingredients: [{ item: 'Beef sirloin, sliced thin', amount: '250g' }, { item: 'Bone broth', amount: '3 cups' }, { item: 'Ginger', amount: '2 tbsp' }, { item: 'Garlic', amount: '3 cloves' }, { item: 'Bok choy', amount: '2 cups' }, { item: 'Green onions', amount: '3' }, { item: 'Sesame oil', amount: '1 tsp' }],
              steps: ['Heat bone broth with ginger, garlic', 'Add bok choy, simmer 5 min', 'Add thin beef slices', 'Cook 2-3 min (beef cooks in hot broth)', 'Top with green onions, sesame oil'],
              tips: ['Pho-inspired bowl', 'The hot broth cooks the beef perfectly'] },
            { id: 'soup_egg_drop', name: 'Egg Drop Soup', proteins: ['eggs'], category: 'soup', requiresVeggies: false, time: 15, baseProtein: 30, servingSize: '4 eggs', flavors: ['asian'], lowProteinWarning: true, netCarbs: 2,
              ingredients: [{ item: 'Eggs', amount: '4' }, { item: 'Chicken broth', amount: '4 cups' }, { item: 'Ginger', amount: '1 tbsp' }, { item: 'Sesame oil', amount: '1 tsp' }, { item: 'Green onions', amount: '2' }, { item: 'White pepper', amount: '¬º tsp' }],
              steps: ['Bring broth to simmer with ginger', 'Beat eggs in bowl', 'Slowly drizzle eggs into simmering broth', 'Stir gently to create ribbons', 'Season with sesame oil, pepper, onions'],
              tips: ['‚ö†Ô∏è Very low protein ‚Äî add chicken or tofu', 'Classic Chinese comfort soup'] },
            { id: 'soup_creamy_chicken', name: 'Creamy Chicken Soup', proteins: ['chicken'], category: 'soup', requiresVeggies: true, time: 35, baseProtein: 88, servingSize: '350g chicken', flavors: ['classic'], netCarbs: 6,
              ingredients: [{ item: 'Chicken breast', amount: '350g' }, { item: 'Chicken broth', amount: '3 cups' }, { item: 'Heavy cream', amount: '1 cup' }, { item: 'Celery', amount: '2 stalks' }, { item: 'Onion', amount: '1' }, { item: 'Garlic', amount: '3 cloves' }, { item: 'Fresh thyme', amount: '2 sprigs' }, { item: 'Butter', amount: '2 tbsp' }],
              steps: ['Poach chicken in broth 15 min', 'Remove, shred chicken', 'Saut√© celery, onion, garlic in butter', 'Add broth and cream, simmer 10 min', 'Return chicken, season and serve'],
              tips: ['Comfort food that fits your protocol', 'Great when under the weather'] },
        ];

        // ==================== NEW: COLD MEAL RECIPES ====================
        const coldRecipes = [
            { id: 'cold_ceviche', name: 'Shrimp Ceviche üáªüá™', proteins: ['shrimp'], category: 'cold', requiresVeggies: true, time: 30, baseProtein: 60, servingSize: '300g shrimp', flavors: ['latin'], isVenezuelan: true, lowProteinWarning: true, netCarbs: 6,
              ingredients: [{ item: 'Shrimp, cooked', amount: '300g' }, { item: 'Lime juice', amount: '¬Ω cup' }, { item: 'Red onion, diced', amount: '¬Ω cup' }, { item: 'Tomato, diced', amount: '1' }, { item: 'Cilantro', amount: '¬º cup' }, { item: 'Avocado', amount: '1' }, { item: 'Jalape√±o', amount: '1' }, { item: 'Salt', amount: '1 tsp' }],
              steps: ['Dice cooked shrimp', 'Mix with lime juice, let sit 15 min', 'Add onion, tomato, cilantro, jalape√±o', 'Season with salt', 'Serve with avocado slices'],
              tips: ['‚ö†Ô∏è Add more shrimp for more protein', 'Perfect for Dubai heat ‚Äî refreshing!'] },
            { id: 'cold_tuna_plate', name: 'Mediterranean Tuna Plate', proteins: ['fish'], category: 'cold', requiresVeggies: true, time: 10, baseProtein: 70, servingSize: '2 cans tuna', flavors: ['mediterranean'], netCarbs: 4,
              ingredients: [{ item: 'Tuna in olive oil', amount: '2 cans (280g)' }, { item: 'Cherry tomatoes', amount: '100g' }, { item: 'Cucumber', amount: '100g' }, { item: 'Kalamata olives', amount: '30g' }, { item: 'Feta cheese', amount: '50g' }, { item: 'Olive oil', amount: '2 tbsp' }, { item: 'Lemon', amount: '1' }],
              steps: ['Drain tuna, place on plate', 'Arrange tomatoes, cucumber, olives around', 'Crumble feta on top', 'Drizzle with olive oil', 'Squeeze lemon over everything'],
              tips: ['Zero cooking required', 'Keep tuna cans at work for easy lunch'] },
            { id: 'cold_chicken_salad', name: 'Avocado Chicken Salad', proteins: ['chicken'], category: 'cold', requiresVeggies: true, time: 15, baseProtein: 85, servingSize: '350g chicken', flavors: ['classic', 'latin'], netCarbs: 4,
              ingredients: [{ item: 'Cooked chicken, shredded', amount: '350g' }, { item: 'Avocado', amount: '1' }, { item: 'Greek yogurt', amount: '3 tbsp' }, { item: 'Celery, diced', amount: '2 stalks' }, { item: 'Lime juice', amount: '2 tbsp' }, { item: 'Salt & pepper', amount: 'to taste' }],
              steps: ['Shred or dice cooked chicken', 'Mash avocado with lime juice', 'Mix chicken, avocado, yogurt, celery', 'Season with salt and pepper', 'Serve in lettuce cups or alone'],
              tips: ['No mayo needed ‚Äî avocado makes it creamy', 'Great meal prep option'] },
            { id: 'cold_beef_rolls', name: 'Roast Beef Roll-Ups', proteins: ['beef'], category: 'cold', requiresVeggies: true, time: 10, baseProtein: 80, servingSize: '300g roast beef', flavors: ['classic'], netCarbs: 2,
              ingredients: [{ item: 'Deli roast beef', amount: '300g' }, { item: 'Cream cheese', amount: '100g' }, { item: 'Arugula', amount: '1 cup' }, { item: 'Pickles', amount: '4' }, { item: 'Dijon mustard', amount: '1 tbsp' }],
              steps: ['Lay roast beef slices flat', 'Spread cream cheese and mustard', 'Add arugula and pickle slice', 'Roll up tightly', 'Slice in half or eat whole'],
              tips: ['Perfect no-cook lunch', 'Pack for work ‚Äî no heating needed'] },
            { id: 'cold_caprese', name: 'Caprese with Prosciutto', proteins: ['pork'], category: 'cold', requiresVeggies: true, time: 10, baseProtein: 45, servingSize: '100g prosciutto', flavors: ['mediterranean'], lowProteinWarning: true, netCarbs: 4,
              ingredients: [{ item: 'Prosciutto', amount: '100g' }, { item: 'Fresh mozzarella', amount: '150g' }, { item: 'Tomatoes', amount: '2 large' }, { item: 'Fresh basil', amount: '10 leaves' }, { item: 'Olive oil', amount: '3 tbsp' }, { item: 'Balsamic vinegar', amount: '1 tbsp' }],
              steps: ['Slice tomatoes and mozzarella', 'Arrange alternating on plate', 'Drape prosciutto over top', 'Tuck basil leaves between', 'Drizzle with oil and balsamic'],
              tips: ['‚ö†Ô∏è Low protein ‚Äî add more prosciutto', 'Classic Italian ‚Äî no cooking needed'] },
        ];

        // ==================== NEW: SNACK RECIPES ====================
        const snackRecipes = [
            { id: 'snack_deviled_eggs', name: 'Deviled Eggs', proteins: ['eggs'], category: 'snack', requiresVeggies: false, time: 20, baseProtein: 36, servingSize: '6 eggs', flavors: ['classic', 'spicy'], lowProteinWarning: true, netCarbs: 1,
              ingredients: [{ item: 'Hard-boiled eggs', amount: '6' }, { item: 'Avocado oil mayo', amount: '3 tbsp' }, { item: 'Dijon mustard', amount: '1 tsp' }, { item: 'Paprika', amount: '¬Ω tsp' }, { item: 'Salt', amount: '¬º tsp' }],
              steps: ['Halve eggs, remove yolks', 'Mash yolks with avocado oil mayo, mustard, salt', 'Pipe or spoon filling back into whites', 'Sprinkle with paprika', 'Chill before serving'],
              tips: ['‚ö†Ô∏è Low protein ‚Äî eat as side/snack only', 'Classic party appetizer'] },
            { id: 'snack_meat_cheese', name: 'Meat & Cheese Roll-Ups', proteins: ['pork'], category: 'snack', requiresVeggies: false, time: 5, baseProtein: 50, servingSize: '150g meat + cheese', flavors: ['classic'], netCarbs: 1,
              ingredients: [{ item: 'Deli ham or salami', amount: '150g' }, { item: 'Cheese slices', amount: '100g' }, { item: 'Cream cheese (optional)', amount: '2 tbsp' }],
              steps: ['Lay meat slice flat', 'Add cheese slice on top', 'Spread cream cheese if using', 'Roll up tightly', 'Eat as is or slice into pinwheels'],
              tips: ['Simplest keto snack ever', 'Keep components in fridge for anytime'] },
            { id: 'snack_cucumber_bites', name: 'Cucumber Cream Cheese Bites', proteins: ['fish'], category: 'snack', requiresVeggies: true, time: 10, baseProtein: 30, servingSize: '100g smoked salmon', flavors: ['classic', 'mediterranean'], lowProteinWarning: true, netCarbs: 3,
              ingredients: [{ item: 'Cucumber', amount: '1 large' }, { item: 'Cream cheese', amount: '100g' }, { item: 'Smoked salmon', amount: '100g' }, { item: 'Fresh dill', amount: '2 tbsp' }, { item: 'Capers', amount: '1 tbsp' }],
              steps: ['Slice cucumber into thick rounds', 'Spread cream cheese on each', 'Top with smoked salmon piece', 'Garnish with dill and caper'],
              tips: ['‚ö†Ô∏è Low protein ‚Äî eat as appetizer', 'Elegant and easy'] },
            { id: 'snack_fat_bombs', name: 'Chocolate Fat Bombs', proteins: ['eggs'], category: 'snack', requiresVeggies: false, time: 15, baseProtein: 5, servingSize: '4 pieces', flavors: ['classic'], lowProteinWarning: true, netCarbs: 2,
              ingredients: [{ item: 'Coconut oil', amount: '¬Ω cup' }, { item: 'Cocoa powder', amount: '3 tbsp' }, { item: 'Almond butter', amount: '2 tbsp' }, { item: 'Erythritol', amount: '2 tbsp' }, { item: 'Vanilla extract', amount: '1 tsp' }],
              steps: ['Melt coconut oil gently', 'Whisk in cocoa, almond butter, sweetener', 'Add vanilla', 'Pour into silicone molds', 'Freeze 1 hour until solid'],
              tips: ['‚ö†Ô∏è This is for energy, NOT protein', 'Good for satisfying sweet cravings'] },
        ];

        // Combine all recipes
        const mealRecipes = [
            ...chickenRecipes,
            ...beefRecipes,
            ...groundBeefRecipes,
            ...salmonRecipes,
            ...whiteFishRecipes,
            ...shrimpRecipes,
            ...lambRecipes,
            ...porkRecipes,
            ...eggRecipes,
            ...breakfastRecipes,
            ...soupRecipes,
            ...coldRecipes,
            ...snackRecipes,
        ];

        // ==================== UTILITIES ====================
        const getRandom = (arr) => arr[Math.floor(Math.random() * arr.length)];
        const formatDate = (d) => new Date(d).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        const save = (k, v) => { try { localStorage.setItem('nk5_'+k, JSON.stringify(v)); } catch(e) {} };
        const load = (k, d) => { try { const v = localStorage.getItem('nk5_'+k); return v ? JSON.parse(v) : d; } catch(e) { return d; } };

        // ==================== SMART FEATURES ====================
        
        // Surprise Me - picks a random recipe based on available proteins
        const getSurpriseRecipe = (availableProteins, history) => {
            if (availableProteins.length === 0) return null;
            const matching = mealRecipes.filter(r => 
                r.proteins.some(p => availableProteins.includes(p)) && 
                r.category !== 'snack'
            );
            if (matching.length === 0) return null;
            
            // Prefer recipes not made recently
            const recentIds = history.slice(0, 10).map(h => h.recipeId);
            const notRecent = matching.filter(r => !recentIds.includes(r.id));
            const pool = notRecent.length > 0 ? notRecent : matching;
            
            return getRandom(pool);
        };

        // Haven't Made in a While - finds recipes not cooked in 2+ weeks
        const getNeglectedRecipes = (history, limit = 5) => {
            const twoWeeksAgo = Date.now() - (14 * 24 * 60 * 60 * 1000);
            const recentIds = history
                .filter(h => new Date(h.cookedAt).getTime() > twoWeeksAgo)
                .map(h => h.recipeId);
            
            return mealRecipes
                .filter(r => !recentIds.includes(r.id) && r.category !== 'snack')
                .slice(0, limit);
        };

        // Cuisine Variety Check
        const getCuisineBalance = (history) => {
            const last7 = history.slice(0, 14);
            const counts = { latin: 0, mediterranean: 0, asian: 0, spicy: 0, classic: 0 };
            last7.forEach(h => {
                if (h.flavor && counts[h.flavor] !== undefined) {
                    counts[h.flavor]++;
                }
            });
            const max = Math.max(...Object.values(counts));
            const dominant = Object.entries(counts).find(([k, v]) => v === max)?.[0];
            const suggestions = Object.entries(counts)
                .filter(([k, v]) => v < max - 2)
                .map(([k]) => k);
            return { counts, dominant, suggestions };
        };

        // ==================== COMPONENTS ====================
        
        function Timer({ minutes, label, onClose }) {
            const [timeLeft, setTimeLeft] = useState(minutes * 60);
            const [running, setRunning] = useState(true);
            useEffect(() => {
                if (!running || timeLeft <= 0) { if (timeLeft <= 0 && navigator.vibrate) navigator.vibrate([500, 200, 500]); return; }
                const i = setInterval(() => setTimeLeft(t => t - 1), 1000);
                return () => clearInterval(i);
            }, [running, timeLeft]);
            const progress = ((minutes * 60 - timeLeft) / (minutes * 60)) * 100;
            return (
                <div className="fixed bottom-24 left-4 right-4 card rounded-3xl p-5 shadow-soft-lg z-40 animate-slide-up border border-cream-300">
                    <div className="flex items-center justify-between mb-3">
                        <span className="text-warm-800 font-semibold">{label}</span>
                        <button onClick={onClose} className="text-warm-600 hover:text-warm-800 text-xl">√ó</button>
                    </div>
                    <div className="flex items-center gap-4">
                        <div className={`text-4xl font-bold font-mono ${timeLeft <= 60 ? 'text-coral-500' : 'text-warm-800'}`}>
                            {Math.floor(timeLeft/60)}:{(timeLeft%60).toString().padStart(2,'0')}
                        </div>
                        <div className="flex-1 h-2 bg-cream-200 rounded-full overflow-hidden">
                            <div className="h-full bg-gradient-to-r from-coral-500 to-sand-500 transition-all duration-1000" style={{width:`${progress}%`}} />
                        </div>
                        <button onClick={() => setRunning(!running)} className="w-12 h-12 rounded-2xl bg-cream-200 hover:bg-cream-300 flex items-center justify-center text-xl press">
                            {running ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}
                        </button>
                    </div>
                    {timeLeft <= 0 && <div className="mt-3 text-coral-500 font-semibold text-center">‚è∞ Done!</div>}
                </div>
            );
        }

        function BadgePopup({ badge, onClose }) {
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-6 modal-overlay" onClick={onClose}>
                    <div className="bg-gradient-to-br from-coral-500 to-sand-500 rounded-[2rem] p-8 text-center animate-bounce-in max-w-xs shadow-glow-coral" onClick={e => e.stopPropagation()}>
                        <div className="text-6xl mb-4">{badge.emoji}</div>
                        <h3 className="text-2xl font-bold text-white mb-2">{badge.name}</h3>
                        <p className="text-white/80 mb-6">{badge.desc}</p>
                        <button onClick={onClose} className="px-6 py-3 bg-white/20 hover:bg-white/30 rounded-2xl text-white font-medium press">¬°Gracias! üôå</button>
                    </div>
                </div>
            );
        }

        function RecipeModal({ meal, onClose, flavor }) {
            const profile = flavorProfiles[flavor] || flavorProfiles.classic;
            return (
                <div className="fixed inset-0 z-50 flex items-end justify-center modal-overlay" onClick={onClose}>
                    <div className="bg-cream-50 rounded-t-[2rem] w-full max-w-lg max-h-[90vh] overflow-hidden animate-slide-up shadow-soft-lg" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-center pt-3 pb-2"><div className="w-12 h-1 bg-cream-300 rounded-full" /></div>
                        <div className="px-5 pb-8 overflow-y-auto max-h-[calc(90vh-50px)]">
                            <div className="mb-5">
                                <h2 className="text-2xl font-bold text-warm-800 mb-1">{meal.name}</h2>
                                <div className="flex items-center gap-3 text-sm flex-wrap">
                                    <span className="text-warm-600">‚è±Ô∏è {meal.time} min</span>
                                    <span className="text-coral-500 font-semibold">~{meal.baseProtein}g protein</span>
                                    {meal.netCarbs !== undefined && <span className="text-sage-600">{meal.netCarbs}g carbs</span>}
                                    {meal.isVenezuelan && <span>üáªüá™</span>}
                                </div>
                            </div>
                            
                            {/* INGREDIENTS - NEW! */}
                            {meal.ingredients && meal.ingredients.length > 0 && (
                                <div className="mb-5">
                                    <h3 className="text-warm-800 font-semibold mb-3">üõí Ingredients</h3>
                                    <div className="bg-white rounded-xl border border-cream-200 divide-y divide-cream-100">
                                        {meal.ingredients.map((ing, i) => (
                                            <div key={i} className="flex justify-between px-4 py-2.5">
                                                <span className="text-warm-700 text-sm">{ing.item}</span>
                                                <span className="text-warm-500 text-sm font-medium">{ing.amount}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                            
                            {profile.seasonings && (
                                <div className="bg-gradient-to-br from-coral-50 to-sand-50 rounded-2xl p-4 border border-coral-100 mb-5">
                                    <h3 className="text-coral-600 font-semibold text-sm mb-2">{profile.emoji} {profile.name} Seasoning</h3>
                                    <p className="text-warm-700 text-sm">{profile.seasonings}</p>
                                    {profile.finisher && <p className="text-warm-600 text-xs mt-2">Finish: {profile.finisher}</p>}
                                </div>
                            )}
                            
                            {meal.steps && meal.steps.length > 0 && (
                                <div className="mb-5">
                                    <h3 className="text-warm-800 font-semibold mb-3">Steps</h3>
                                    <div className="space-y-3">
                                        {meal.steps.map((step, i) => (
                                            <div key={i} className="flex gap-3">
                                                <div className="w-7 h-7 rounded-full bg-coral-100 text-coral-600 flex items-center justify-center flex-shrink-0 text-sm font-semibold">{i + 1}</div>
                                                <p className="text-warm-700 text-sm pt-1">{step}</p>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                            
                            {meal.tips && meal.tips.length > 0 && (
                                <div className="bg-cream-100 rounded-2xl p-4 mb-5">
                                    <h3 className="text-warm-800 font-semibold text-sm mb-2">üí° Tips</h3>
                                    {meal.tips.map((tip, i) => <p key={i} className="text-warm-600 text-sm">‚Ä¢ {tip}</p>)}
                                </div>
                            )}
                            
                            {meal.doneness && (
                                <div className="bg-sage-50 border border-sage-100 rounded-2xl p-4">
                                    <h3 className="text-sage-600 font-semibold text-sm mb-1">‚úì Done when</h3>
                                    <p className="text-warm-700 text-sm">{meal.doneness}</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        function GuideModal({ onClose }) {
            const [tab, setTab] = useState('guide');
            
            // Diego's actual supplement protocol - split by timing
            const supplements = [
                { category: '‚òÄÔ∏è MORNING ‚Äî With First Meal (12pm)', items: [
                    { name: 'Omega-3 Fish Oil', dose: '2-3 softgels', timing: 'With food', purpose: 'Triglycerides, inflammation, liver', emoji: 'üêü' },
                    { name: 'Vitamin D3 + K2', dose: '1 softgel (5000 IU)', timing: 'With fatty food', purpose: 'Level 43‚Üí50+, bone health', emoji: '‚òÄÔ∏è' },
                    { name: 'Berberine (Thorne)', dose: '2 capsules', timing: 'Before meal', purpose: 'Blood sugar, insulin sensitivity', emoji: 'üíä' },
                    { name: 'Curcumin Phytosome', dose: '2 capsules', timing: 'With food', purpose: 'Inflammation (hs-CRP 2.54)', emoji: 'üåø' },
                    { name: 'ResveraCel', dose: '2 capsules', timing: 'With food', purpose: 'NAD+ support, cellular health', emoji: '‚ö°' },
                    { name: 'B Complex', dose: '1 capsule', timing: 'With food', purpose: 'Energy metabolism', emoji: 'üí™' },
                    { name: 'B12 Methylcobalamin', dose: '1000mcg sublingual', timing: 'Under tongue', purpose: 'Level 420‚Üí545+ (was low)', emoji: 'üî¥' },
                    { name: 'CoQ10 Ubiquinol', dose: '1 capsule', timing: 'With fat', purpose: 'Mitochondria, energy, heart', emoji: '‚ù§Ô∏è' },
                    { name: 'Zinc Picolinate', dose: '15mg', timing: 'With food', purpose: 'Testosterone, immune', emoji: 'üõ°Ô∏è' },
                    { name: 'Vitamin C', dose: '1 capsule', timing: 'With food', purpose: 'Antioxidant, immune', emoji: 'üçä' },
                    { name: 'Saw Palmetto/Pumpkin', dose: '2 pills', timing: 'With food', purpose: 'DHT blocker, prostate, hair', emoji: 'üéÉ' },
                    { name: 'NAC', dose: '600mg', timing: 'With food', purpose: 'Glutathione, liver protection', emoji: 'ü´Å' },
                ]},
                { category: 'üå§Ô∏è AFTERNOON ‚Äî Before Second Meal (5-6pm)', items: [
                    { name: 'Berberine (Thorne)', dose: '2 capsules', timing: 'Before meal', purpose: 'Second dose for blood sugar', emoji: 'üíä' },
                ]},
                { category: 'üåÜ EVENING ‚Äî With Dinner', items: [
                    { name: 'Copper Bisglycinate', dose: '2mg', timing: 'Away from zinc', purpose: 'Balances zinc (taken separately)', emoji: 'üü§' },
                ]},
                { category: 'üåô BEDTIME ‚Äî 30-45 Min Before Sleep', items: [
                    { name: 'Magnesium Glycinate', dose: '2-3 capsules', timing: '30-45 min before bed', purpose: 'Sleep, insulin sensitivity', emoji: 'üò¥' },
                    { name: 'L-Lysine', dose: '1 capsule', timing: 'Before bed', purpose: 'Collagen, immune support', emoji: 'üí§' },
                ]},
            ];

            return (
                <div className="fixed inset-0 z-50 flex items-end justify-center modal-overlay" onClick={onClose}>
                    <div className="bg-cream-50 rounded-t-[2rem] w-full max-w-lg max-h-[85vh] overflow-hidden animate-slide-up shadow-soft-lg" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-center pt-3 pb-2"><div className="w-12 h-1 bg-cream-300 rounded-full" /></div>
                        <div className="flex gap-2 px-5 pb-4">
                            {[{id:'guide',label:'üìã Guide'},{id:'supps',label:'üíä Supps'},{id:'dressings',label:'ü•ó Dressings'}].map(t => (
                                <button key={t.id} onClick={() => setTab(t.id)} className={`flex-1 py-2.5 rounded-2xl font-medium text-sm transition-all press ${tab === t.id ? 'bg-coral-500 text-white shadow-glow-coral' : 'bg-cream-200 text-warm-700'}`}>
                                    {t.label}
                                </button>
                            ))}
                        </div>
                        <div className="px-5 pb-8 overflow-y-auto max-h-[70vh] space-y-4">
                            {tab === 'guide' && (<>
                                <div className="card rounded-2xl p-5">
                                    <h3 className="text-sm font-semibold text-warm-600 uppercase tracking-wider mb-4">üéØ Daily Targets</h3>
                                    <div className="grid grid-cols-2 gap-3">
                                        <div className="bg-cream-100 rounded-xl p-3"><div className="text-warm-600 text-xs">Meals</div><div className="text-warm-800 font-bold text-lg">2/day</div></div>
                                        <div className="bg-cream-100 rounded-xl p-3"><div className="text-warm-600 text-xs">Protein</div><div className="text-coral-500 font-bold text-lg">80-100g</div></div>
                                        <div className="bg-cream-100 rounded-xl p-3"><div className="text-warm-600 text-xs">Meat/Fish</div><div className="text-warm-800 font-bold text-lg">300-400g</div></div>
                                        <div className="bg-cream-100 rounded-xl p-3"><div className="text-warm-600 text-xs">Veggies</div><div className="text-sage-500 font-bold text-lg">Unlimited!</div></div>
                                    </div>
                                    <p className="text-warm-500 text-xs mt-3 text-center">üìù All weights are RAW. Meat loses ~25% when cooked but keeps the same protein.</p>
                                </div>
                                <div className="card rounded-2xl p-5">
                                    <h3 className="text-sm font-semibold text-warm-600 uppercase tracking-wider mb-3">üç≥ Cooking Fats</h3>
                                    <div className="grid grid-cols-2 gap-3">
                                        <div className="bg-sage-50 border border-sage-100 rounded-xl p-3"><div className="text-sage-600 font-semibold text-xs mb-1">‚úì Use</div><div className="text-warm-700 text-xs">Butter, Olive Oil, Avocado Oil, Ghee</div></div>
                                        <div className="bg-coral-50 border border-coral-100 rounded-xl p-3"><div className="text-coral-600 font-semibold text-xs mb-1">‚úï Never</div><div className="text-warm-700 text-xs">Vegetable, Canola, Sunflower oil</div></div>
                                    </div>
                                </div>
                                <div className="card rounded-2xl p-5">
                                    <h3 className="text-sm font-semibold text-warm-600 uppercase tracking-wider mb-3">üßÄ Cheese (max 50g)</h3>
                                    <div className="flex gap-2 flex-wrap">{cheeses.map(c => <span key={c.id} className="px-3 py-1.5 bg-sand-100 text-sand-600 rounded-full text-sm font-medium">{c.name}</span>)}</div>
                                </div>
                                <div className="bg-coral-50 border border-coral-100 rounded-2xl p-5">
                                    <h3 className="text-sm font-semibold text-coral-600 uppercase tracking-wider mb-3">üö´ Never List</h3>
                                    <div className="grid grid-cols-2 gap-x-4 gap-y-1 text-sm text-warm-700">
                                        <div>‚úï Sugar, honey</div><div>‚úï Bread, pasta, rice</div>
                                        <div>‚úï Arepas (rare)</div><div>‚úï Seed/veg oils</div>
                                        <div>‚úï Juice, soda</div><div>‚úï Potatoes, yuca</div>
                                    </div>
                                </div>
                                <div className="bg-sage-50 border border-sage-100 rounded-2xl p-5">
                                    <h3 className="text-sm font-semibold text-sage-600 uppercase tracking-wider mb-3">üíô Why This Matters</h3>
                                    <p className="text-warm-700 text-sm">Diego has insulin resistance and fatty liver. This way of eating will help him lose 20kg and reverse the damage. It's temporary‚Äînot forever.</p>
                                </div>
                                <div className="bg-gradient-to-br from-coral-50 to-sand-50 border border-coral-100 rounded-2xl p-5 text-center">
                                    <span className="text-3xl">üíï</span>
                                    <p className="text-warm-700 text-sm mt-2">Diego owes Nene unlimited backrubs for this üíÜ‚Äç‚ôÄÔ∏è</p>
                                </div>
                            </>)}
                            {tab === 'supps' && (
                                <div className="space-y-4">
                                    <div className="bg-gradient-to-r from-coral-500 to-sand-500 rounded-2xl p-4 text-white">
                                        <h3 className="font-bold mb-1">üíä Diego's Supplement Protocol</h3>
                                        <p className="text-white/80 text-sm">Organized by time ‚Äî for insulin resistance & fatty liver</p>
                                    </div>
                                    {supplements.map((cat, i) => (
                                        <div key={i} className="card rounded-2xl border border-cream-200 overflow-hidden">
                                            <div className="px-4 py-2.5 bg-cream-100 border-b border-cream-200">
                                                <span className="text-warm-800 font-semibold text-sm">{cat.category}</span>
                                            </div>
                                            <div className="divide-y divide-cream-100">
                                                {cat.items.map((supp, j) => (
                                                    <div key={j} className="px-4 py-3">
                                                        <div className="flex items-start justify-between">
                                                            <div className="flex items-start gap-2">
                                                                <span className="text-lg">{supp.emoji}</span>
                                                                <div>
                                                                    <p className="text-warm-800 font-medium text-sm">{supp.name}</p>
                                                                    <p className="text-coral-500 text-xs font-semibold">{supp.dose}</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div className="mt-1.5 ml-7">
                                                            <p className="text-warm-500 text-xs">‚è∞ {supp.timing}</p>
                                                            <p className="text-sage-600 text-xs">‚úì {supp.purpose}</p>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                    <div className="bg-cream-100 rounded-xl p-4 text-center">
                                        <p className="text-warm-600 text-xs">üí° Always consult your doctor before changing supplements</p>
                                    </div>
                                </div>
                            )}
                            {tab === 'dressings' && (
                                <div className="space-y-3">
                                    <p className="text-warm-600 text-sm">All homemade, no sugar, no bad oils:</p>
                                    {dressings.map((d,i) => (
                                        <div key={i} className="card rounded-xl p-4">
                                            <div className="flex items-center gap-2 mb-1">
                                                <span className="text-warm-800 font-medium text-sm">{d.name}</span>
                                                <span className="text-xs px-2 py-0.5 bg-cream-200 rounded-full text-warm-600">{flavorProfiles[d.flavor]?.emoji}</span>
                                            </div>
                                            <p className="text-warm-600 text-xs">{d.recipe}</p>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        function BadgesModal({ onClose, earned }) {
            return (
                <div className="fixed inset-0 z-50 flex items-end justify-center modal-overlay" onClick={onClose}>
                    <div className="bg-cream-50 rounded-t-[2rem] w-full max-w-lg max-h-[85vh] overflow-hidden animate-slide-up shadow-soft-lg" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-center pt-3 pb-2"><div className="w-12 h-1 bg-cream-300 rounded-full" /></div>
                        <div className="px-5 pb-2"><h2 className="text-xl font-bold text-warm-800">üèÜ Achievements <span className="text-warm-600 font-normal text-base">({earned.length}/{achievements.length})</span></h2></div>
                        <div className="px-5 pb-8 overflow-y-auto max-h-[70vh]">
                            <div className="grid grid-cols-2 gap-3">
                                {achievements.map(b => {
                                    const e = earned.includes(b.id);
                                    return <div key={b.id} className={`rounded-2xl p-4 text-center ${e ? 'bg-gradient-to-br from-coral-50 to-sand-50 border border-coral-200' : 'bg-cream-100 opacity-50'}`}>
                                        <span className="text-3xl block mb-2">{e ? b.emoji : 'üîí'}</span>
                                        <h3 className={`font-semibold text-sm ${e ? 'text-warm-800' : 'text-warm-600'}`}>{b.name}</h3>
                                        <p className="text-warm-600 text-xs mt-1">{b.desc}</p>
                                    </div>;
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // ==================== MAIN APP ====================
        function App() {
            const [tab, setTab] = useState('create');
            const [selProteins, setSelProteins] = useState([]);
            const [selVeggies, setSelVeggies] = useState([]);
            const [selCheese, setSelCheese] = useState([]);
            const [selFlavor, setSelFlavor] = useState('any');
            const [selCategory, setSelCategory] = useState('any');
            const [portions, setPortions] = useState(1);
            const [meals, setMeals] = useState([]);
            const [showMeals, setShowMeals] = useState(false);

            const [favorites, setFavorites] = useState(() => load('favs', []));
            const [history, setHistory] = useState(() => load('hist', []));
            const [shopping, setShopping] = useState(() => load('shop', []));
            const [staples, setStaples] = useState(() => load('staples', []));
            const [newItem, setNewItem] = useState('');
            const [editingItem, setEditingItem] = useState(null);
            const [showStaplesModal, setShowStaplesModal] = useState(false);

            // Shopping categories
            const shopCategories = {
                protein: { id: 'protein', name: 'Proteins', emoji: 'ü•©' },
                produce: { id: 'produce', name: 'Produce', emoji: 'ü•¨' },
                dairy: { id: 'dairy', name: 'Dairy', emoji: 'üßÄ' },
                pantry: { id: 'pantry', name: 'Pantry', emoji: 'ü´ô' },
                other: { id: 'other', name: 'Other', emoji: 'üõí' },
            };

            // Quick add items - common things Nene buys
            const quickAddItems = [
                { name: 'Eggs (2 dozen)', cat: 'protein', emoji: 'ü•ö' },
                { name: 'Avocados (6)', cat: 'produce', emoji: 'ü•ë' },
                { name: 'Butter', cat: 'dairy', emoji: 'üßà' },
                { name: 'Olive oil', cat: 'pantry', emoji: 'ü´í' },
                { name: 'Lemons (6)', cat: 'produce', emoji: 'üçã' },
                { name: 'Garlic', cat: 'produce', emoji: 'üßÑ' },
                { name: 'Heavy cream', cat: 'dairy', emoji: 'ü•õ' },
                { name: 'Greek yogurt', cat: 'dairy', emoji: 'ü•õ' },
            ];

            // Kitchen Essentials - what your protocol needs stocked
            const kitchenEssentials = [
                { id: 'protein', name: 'Protein source', emoji: 'ü•©', description: 'Chicken, beef, fish, etc.', addText: 'Pick protein this week', cat: 'protein', hasPicker: 'protein' },
                { id: 'eggs', name: 'Eggs', emoji: 'ü•ö', description: 'Always need these', addText: 'Eggs (2 dozen)', cat: 'protein' },
                { id: 'avocado', name: 'Avocados', emoji: 'ü•ë', description: 'Healthy fats', addText: 'Avocados (6)', cat: 'produce' },
                { id: 'greens', name: 'Greens & Veggies', emoji: 'ü•¨', description: 'Unlimited on protocol', addText: 'Fresh vegetables', cat: 'produce', hasPicker: 'veggies' },
                { id: 'oliveoil', name: 'Olive Oil', emoji: 'ü´í', description: 'Cooking & dressing', addText: 'Olive oil', cat: 'pantry' },
                { id: 'butter', name: 'Butter', emoji: 'üßà', description: 'Cooking fat', addText: 'Butter', cat: 'dairy' },
                { id: 'lemons', name: 'Lemons/Limes', emoji: 'üçã', description: 'For flavor', addText: 'Lemons (6)', cat: 'produce' },
                { id: 'garlic', name: 'Garlic & Onions', emoji: 'üßÑ', description: 'Aromatics', addText: 'Garlic + Onions', cat: 'produce' },
            ];

            // Protein options for the picker
            const proteinOptions = [
                { 
                    name: 'Chicken', emoji: 'üçó', 
                    cuts: ['Chicken breast (1kg)', 'Chicken thighs (1kg)', 'Whole chicken', 'Chicken wings (1kg)']
                },
                { 
                    name: 'Beef', emoji: 'ü•©', 
                    cuts: ['Ribeye steaks (4)', 'Sirloin steak (1kg)', 'Flank steak (800g)', 'Ground beef (1kg)', 'Beef roast (1.5kg)']
                },
                { 
                    name: 'Pork', emoji: 'üê∑', 
                    cuts: ['Pork chops (6)', 'Pork tenderloin (800g)', 'Pork shoulder (1.5kg)', 'Pork ribs (1kg)', 'Bacon (500g)']
                },
                { 
                    name: 'Lamb', emoji: 'üçñ', 
                    cuts: ['Lamb chops (8)', 'Lamb leg (1.5kg)', 'Ground lamb (500g)', 'Lamb shoulder (1kg)']
                },
                { 
                    name: 'Salmon', emoji: 'üêü', 
                    cuts: ['Salmon fillets (4)', 'Whole salmon side (1kg)', 'Smoked salmon (200g)']
                },
                { 
                    name: 'White Fish', emoji: 'üê†', 
                    cuts: ['Cod fillets (4)', 'Sea bass (2)', 'Tilapia fillets (6)', 'Halibut (500g)']
                },
                { 
                    name: 'Shrimp', emoji: 'ü¶ê', 
                    cuts: ['Large shrimp (500g)', 'Jumbo shrimp (400g)', 'Shrimp (1kg bag)']
                },
            ];

            // Veggie options for the picker
            const veggieOptions = [
                {
                    name: 'Leafy Greens', emoji: 'ü•¨',
                    items: ['Spinach (200g)', 'Arugula (150g)', 'Mixed greens (200g)', 'Romaine lettuce (2)', 'Butter lettuce (2)', 'Kale (bunch)']
                },
                {
                    name: 'Cruciferous', emoji: 'ü•¶',
                    items: ['Broccoli (2 heads)', 'Cauliflower (1 head)', 'Cabbage (1 head)', 'Brussels sprouts (500g)']
                },
                {
                    name: 'Cooking Veggies', emoji: 'üç≥',
                    items: ['Zucchini (4)', 'Bell peppers (4)', 'Mushrooms (400g)', 'Asparagus (2 bunches)', 'Eggplant (2)', 'Green beans (400g)']
                },
                {
                    name: 'Salad Veggies', emoji: 'ü•ó',
                    items: ['Cucumber (3)', 'Cherry tomatoes (500g)', 'Tomatoes (6)', 'Radishes (bunch)', 'Celery (bunch)']
                },
                {
                    name: 'Aromatics', emoji: 'üßÖ',
                    items: ['Onions (bag)', 'Red onion (3)', 'Garlic (2 heads)', 'Ginger (piece)', 'Fresh cilantro', 'Fresh parsley', 'Fresh basil']
                },
                {
                    name: 'Other', emoji: 'üå∂Ô∏è',
                    items: ['Jalape√±os (6)', 'Chayote (2)', 'Bok choy (3)', 'Fennel (2)']
                },
            ];

            const [showProteinPicker, setShowProteinPicker] = useState(false);
            const [showVeggiePicker, setShowVeggiePicker] = useState(false);
            const [showRecipeBook, setShowRecipeBook] = useState(false);
            const [recipeBookFilter, setRecipeBookFilter] = useState('any');
            const [showWeeklySummary, setShowWeeklySummary] = useState(false);
            const [showCustomMeal, setShowCustomMeal] = useState(false);
            const [customMeal, setCustomMeal] = useState({
                name: '',
                eggs: 0,
                proteins: { beef: '', chicken: '', salmon: '', fish: '', shrimp: '', lamb: '', pork: '', ground: '' },
                veggies: { avocado: 0, broccoli: '', spinach: '', peppers: '', mushrooms: '', tomatoes: '', onions: '', cucumber: '', asparagus: '', zucchini: '' },
                cheese: '',
                usedOil: false,
                usedButter: false,
                carbsOverride: ''
            });

            // Protein data for calculations (per 100g raw)
            const proteinCalcData = {
                eggs: { perUnit: 6, carbsPerUnit: 0 },
                beef: { per100g: 26, carbs: 0 },
                chicken: { per100g: 25, carbs: 0 },
                salmon: { per100g: 22, carbs: 0 },
                fish: { per100g: 20, carbs: 0 },
                shrimp: { per100g: 20, carbs: 0 },
                lamb: { per100g: 25, carbs: 0 },
                pork: { per100g: 25, carbs: 0 },
                ground: { per100g: 26, carbs: 0 },
            };

            // Veggie data (per 100g or per unit)
            const veggieCalcData = {
                avocado: { perUnit: 2, carbsPerUnit: 2, isUnit: true, protein: 1 },
                broccoli: { per100g: 3, carbs: 4 },
                spinach: { per100g: 3, carbs: 1 },
                peppers: { per100g: 1, carbs: 4 },
                mushrooms: { per100g: 3, carbs: 2 },
                tomatoes: { per100g: 1, carbs: 3 },
                onions: { per100g: 1, carbs: 8 },
                cucumber: { per100g: 1, carbs: 2 },
                asparagus: { per100g: 2, carbs: 2 },
                zucchini: { per100g: 1, carbs: 2 },
            };

            const cheeseData = { per100g: 25, carbs: 1 };

            // Meal planner state
            const [mealPlan, setMealPlan] = useState(() => load('mealPlan', {}));
            const [savedPlans, setSavedPlans] = useState(() => load('savedPlans', []));
            const [showMealPicker, setShowMealPicker] = useState(null); // { day: 'mon', slot: 'lunch' }
            const [mealPickerSearch, setMealPickerSearch] = useState('');
            const [showCustomMealForPlan, setShowCustomMealForPlan] = useState(false);
            const [showSavedPlans, setShowSavedPlans] = useState(false);
            const [savePlanName, setSavePlanName] = useState('');

            // Days of the week
            const weekDays = [
                { id: 'mon', name: 'Monday', short: 'Mon' },
                { id: 'tue', name: 'Tuesday', short: 'Tue' },
                { id: 'wed', name: 'Wednesday', short: 'Wed' },
                { id: 'thu', name: 'Thursday', short: 'Thu' },
                { id: 'fri', name: 'Friday', short: 'Fri' },
                { id: 'sat', name: 'Saturday', short: 'Sat' },
                { id: 'sun', name: 'Sunday', short: 'Sun' },
            ];

            // Calculate weekly summary from history
            const getWeeklySummary = () => {
                const now = new Date();
                const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                const weekMeals = history.filter(m => new Date(m.cookedAt) >= weekAgo);
                
                const totalProtein = weekMeals.reduce((sum, m) => sum + (m.baseProtein || 0), 0);
                const totalCarbs = weekMeals.reduce((sum, m) => sum + (m.netCarbs || 0), 0);
                const avgProtein = weekMeals.length > 0 ? Math.round(totalProtein / weekMeals.length) : 0;
                const avgCarbs = weekMeals.length > 0 ? Math.round(totalCarbs / weekMeals.length) : 0;
                
                // Count proteins used
                const proteinCounts = {};
                weekMeals.forEach(m => {
                    if (m.proteins) {
                        m.proteins.forEach(p => {
                            proteinCounts[p] = (proteinCounts[p] || 0) + 1;
                        });
                    }
                });
                const topProteins = Object.entries(proteinCounts)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3)
                    .map(([id, count]) => ({ 
                        ...proteins.find(p => p.id === id), 
                        count 
                    }));
                
                // Count recipes
                const recipeCounts = {};
                weekMeals.forEach(m => {
                    recipeCounts[m.name] = (recipeCounts[m.name] || 0) + 1;
                });
                const topRecipes = Object.entries(recipeCounts)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3)
                    .map(([name, count]) => ({ name, count }));
                
                // Count cuisines/flavors
                const flavorCounts = {};
                weekMeals.forEach(m => {
                    if (m.flavor && m.flavor !== 'any') {
                        flavorCounts[m.flavor] = (flavorCounts[m.flavor] || 0) + 1;
                    }
                });
                const topFlavors = Object.entries(flavorCounts)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3)
                    .map(([id, count]) => ({ 
                        ...flavorProfiles[id], 
                        count 
                    }));

                // Daily breakdown
                const dailyProtein = {};
                weekMeals.forEach(m => {
                    const day = new Date(m.cookedAt).toLocaleDateString('en-US', { weekday: 'short' });
                    dailyProtein[day] = (dailyProtein[day] || 0) + (m.baseProtein || 0);
                });

                // Target comparison (14 meals per week, 180-200g protein per day)
                const targetMeals = 14;
                const targetProteinWeek = 1330; // ~190g x 7 days
                const proteinProgress = Math.min(100, Math.round((totalProtein / targetProteinWeek) * 100));
                const mealsProgress = Math.round((weekMeals.length / targetMeals) * 100);

                return {
                    totalProtein,
                    totalCarbs,
                    avgProtein,
                    avgCarbs,
                    mealCount: weekMeals.length,
                    topProteins,
                    topRecipes,
                    topFlavors,
                    dailyProtein,
                    proteinProgress,
                    mealsProgress,
                    targetMeals,
                    targetProteinWeek
                };
            };

            // Custom meal extras options
            const customExtras = [
                { id: 'avocado', name: 'Avocado', emoji: 'ü•ë', carbs: 2 },
                { id: 'veggies', name: 'Veggies', emoji: 'ü•¨', carbs: 3 },
                { id: 'cheese', name: 'Cheese', emoji: 'üßÄ', carbs: 1 },
                { id: 'eggs', name: 'Eggs', emoji: 'ü•ö', carbs: 0, proteinPer: 6 },
            ];

            // Calculate protein from custom meal
            const calcCustomProtein = () => {
                let total = 0;
                // Eggs
                total += customMeal.eggs * proteinCalcData.eggs.perUnit;
                // Proteins
                Object.entries(customMeal.proteins).forEach(([key, grams]) => {
                    const g = parseInt(grams) || 0;
                    if (g > 0 && proteinCalcData[key]) {
                        total += Math.round((g * proteinCalcData[key].per100g) / 100);
                    }
                });
                // Avocado
                total += customMeal.veggies.avocado * (veggieCalcData.avocado.protein || 0);
                // Cheese
                const cheeseG = parseInt(customMeal.cheese) || 0;
                total += Math.round((cheeseG * cheeseData.per100g) / 100);
                return total;
            };

            const calcCustomCarbs = () => {
                if (customMeal.carbsOverride) return parseInt(customMeal.carbsOverride) || 0;
                let total = 0;
                // Veggies
                Object.entries(customMeal.veggies).forEach(([key, value]) => {
                    const data = veggieCalcData[key];
                    if (data) {
                        if (data.isUnit) {
                            total += (parseInt(value) || 0) * data.carbsPerUnit;
                        } else {
                            const g = parseInt(value) || 0;
                            total += Math.round((g * data.carbs) / 100);
                        }
                    }
                });
                // Cheese
                const cheeseG = parseInt(customMeal.cheese) || 0;
                total += Math.round((cheeseG * cheeseData.carbs) / 100);
                return total;
            };

            const updateCustomProtein = (key, value) => {
                setCustomMeal(prev => ({
                    ...prev,
                    proteins: { ...prev.proteins, [key]: value }
                }));
            };

            const updateCustomVeggie = (key, value) => {
                setCustomMeal(prev => ({
                    ...prev,
                    veggies: { ...prev.veggies, [key]: value }
                }));
            };

            const buildCustomMealName = () => {
                // Use custom name if provided
                if (customMeal.name && customMeal.name.trim()) {
                    return customMeal.name.trim();
                }
                // Otherwise build from ingredients
                const parts = [];
                if (customMeal.eggs > 0) parts.push(`${customMeal.eggs} egg${customMeal.eggs > 1 ? 's' : ''}`);
                Object.entries(customMeal.proteins).forEach(([key, grams]) => {
                    if (parseInt(grams) > 0) {
                        const name = proteins.find(p => p.id === key)?.name || key;
                        parts.push(`${name} ${grams}g`);
                    }
                });
                const veggieList = [];
                Object.entries(customMeal.veggies).forEach(([key, value]) => {
                    if ((veggieCalcData[key]?.isUnit && parseInt(value) > 0) || (!veggieCalcData[key]?.isUnit && parseInt(value) > 0)) {
                        veggieList.push(key);
                    }
                });
                if (veggieList.length > 0) parts.push(`+ ${veggieList.slice(0, 2).join(', ')}${veggieList.length > 2 ? '...' : ''}`);
                if (parseInt(customMeal.cheese) > 0) parts.push(`cheese ${customMeal.cheese}g`);
                return parts.length > 0 ? parts.join(', ') : 'Custom meal';
            };

            const hasCustomMealContent = () => {
                if (customMeal.eggs > 0) return true;
                if (Object.values(customMeal.proteins).some(v => parseInt(v) > 0)) return true;
                return false;
            };

            const logCustomMeal = () => {
                if (!hasCustomMealContent()) return;
                
                const proteinIds = [];
                Object.entries(customMeal.proteins).forEach(([key, grams]) => {
                    if (parseInt(grams) > 0) proteinIds.push(key);
                });
                if (customMeal.eggs > 0) proteinIds.push('eggs');

                const meal = {
                    name: buildCustomMealName(),
                    baseProtein: calcCustomProtein(),
                    netCarbs: calcCustomCarbs(),
                    proteins: proteinIds,
                    isCustom: true,
                    cookedAt: new Date().toISOString()
                };
                
                setHistory([meal, ...history].slice(0, 50));
                
                // Update stats
                const today = new Date().toISOString().split('T')[0];
                const ns = { ...stats, total: stats.total + 1 };
                if (stats.lastDate !== today) {
                    const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                    ns.streak = stats.lastDate === yesterday ? stats.streak + 1 : 1;
                    ns.lastDate = today;
                }
                setStats(ns);
                checkBadges(ns, null);
                
                // Reset form
                resetCustomMeal();
                setShowCustomMeal(false);
            };

            const resetCustomMeal = () => {
                setCustomMeal({
                    name: '',
                    eggs: 0,
                    proteins: { beef: '', chicken: '', salmon: '', fish: '', shrimp: '', lamb: '', pork: '', ground: '' },
                    veggies: { avocado: 0, broccoli: '', spinach: '', peppers: '', mushrooms: '', tomatoes: '', onions: '', cucumber: '', asparagus: '', zucchini: '' },
                    cheese: '',
                    usedOil: false,
                    usedButter: false,
                    carbsOverride: ''
                });
            };

            // For meal planner - create custom meal object
            const createCustomMealForPlan = () => {
                if (!hasCustomMealContent()) return null;
                return {
                    id: `custom_${Date.now()}`,
                    name: buildCustomMealName(),
                    baseProtein: calcCustomProtein(),
                    netCarbs: calcCustomCarbs(),
                    proteins: Object.entries(customMeal.proteins).filter(([k, v]) => parseInt(v) > 0).map(([k]) => k),
                    isCustom: true,
                    ingredients: [] // Custom meals don't have recipe ingredients
                };
            };

            const toggleCustomExtra = (id) => {
                setCustomMeal(prev => ({
                    ...prev,
                    extras: prev.extras.includes(id) 
                        ? prev.extras.filter(e => e !== id)
                        : [...prev.extras, id]
                }));
            };

            // Meal planner functions
            const addMealToPlan = (recipe) => {
                if (!showMealPicker) return;
                const { day, slot } = showMealPicker;
                const key = `${day}_${slot}`;
                setMealPlan(prev => ({ ...prev, [key]: recipe }));
                setShowMealPicker(null);
                setMealPickerSearch('');
            };

            const removeMealFromPlan = (day, slot) => {
                const key = `${day}_${slot}`;
                setMealPlan(prev => {
                    const newPlan = { ...prev };
                    delete newPlan[key];
                    return newPlan;
                });
            };

            const getMealForSlot = (day, slot) => {
                return mealPlan[`${day}_${slot}`] || null;
            };

            const getPlanStats = () => {
                const meals = Object.values(mealPlan);
                return {
                    count: meals.length,
                    totalProtein: meals.reduce((sum, m) => sum + (m.baseProtein || 0), 0),
                    totalCarbs: meals.reduce((sum, m) => sum + (m.netCarbs || 0), 0),
                };
            };

            const generateShoppingListFromPlan = () => {
                // Ingredients that are "check stock" not "buy"
                const checkStockItems = [
                    'salt', 'pepper', 'black pepper', 'white pepper', 'olive oil', 'butter', 
                    'garlic powder', 'onion powder', 'paprika', 'cumin', 'coriander', 'turmeric',
                    'oregano', 'thyme', 'rosemary', 'bay leaf', 'chili flakes', 'cayenne',
                    'garam masala', 'curry powder', 'italian seasoning', 'soy sauce', 'fish sauce',
                    'coconut aminos', 'sesame oil', 'vinegar', 'mustard', 'mayonnaise'
                ];
                
                // Protein normalization - combine similar items
                const proteinKeywords = {
                    chicken: ['chicken breast', 'chicken thigh', 'chicken', 'pollo'],
                    beef: ['beef', 'steak', 'ribeye', 'sirloin', 'striploin', 'flank'],
                    ground: ['ground beef', 'ground meat', 'carne molida'],
                    salmon: ['salmon'],
                    fish: ['fish', 'cod', 'tilapia', 'sea bass', 'halibut', 'white fish'],
                    shrimp: ['shrimp', 'prawn', 'camarones'],
                    lamb: ['lamb'],
                    pork: ['pork', 'cerdo'],
                    eggs: ['egg']
                };

                const buyItems = {};
                const checkItems = {};
                const proteinTotals = {};

                Object.values(mealPlan).forEach(meal => {
                    if (meal.ingredients) {
                        meal.ingredients.forEach(ing => {
                            const itemLower = ing.item.toLowerCase();
                            
                            // Check if it's a "check stock" item
                            const isCheckStock = checkStockItems.some(cs => itemLower.includes(cs));
                            
                            // Check if it's a protein to combine
                            let proteinType = null;
                            for (const [type, keywords] of Object.entries(proteinKeywords)) {
                                if (keywords.some(kw => itemLower.includes(kw))) {
                                    proteinType = type;
                                    break;
                                }
                            }

                            if (proteinType) {
                                // Extract grams from amount
                                const gramsMatch = ing.amount.match(/(\d+)\s*g/i);
                                const grams = gramsMatch ? parseInt(gramsMatch[1]) : 0;
                                
                                if (!proteinTotals[proteinType]) {
                                    proteinTotals[proteinType] = { grams: 0, count: 0 };
                                }
                                proteinTotals[proteinType].grams += grams;
                                proteinTotals[proteinType].count += 1;
                            } else if (isCheckStock) {
                                // Add to check stock (just track that we need it)
                                const key = ing.item.split(',')[0].split('(')[0].trim();
                                checkItems[key.toLowerCase()] = { name: key, cat: categorizeItem(ing.item) };
                            } else {
                                // Regular buy item - combine amounts
                                const key = ing.item.toLowerCase().split(',')[0].split('(')[0].trim();
                                if (buyItems[key]) {
                                    buyItems[key].count += 1;
                                    buyItems[key].amounts.push(ing.amount);
                                } else {
                                    buyItems[key] = {
                                        name: ing.item.split(',')[0].split('(')[0].trim(),
                                        count: 1,
                                        amounts: [ing.amount],
                                        cat: categorizeItem(ing.item)
                                    };
                                }
                            }
                        });
                    }
                });

                // Build final shopping list
                const newItems = [];
                
                // Add proteins with totals
                const proteinEmojis = { chicken: 'üçó', beef: 'ü•©', ground: 'üçî', salmon: 'üêü', fish: 'üê†', shrimp: 'ü¶ê', lamb: 'üçñ', pork: 'üê∑', eggs: 'ü•ö' };
                const proteinNames = { chicken: 'Chicken', beef: 'Beef', ground: 'Ground Beef', salmon: 'Salmon', fish: 'White Fish', shrimp: 'Shrimp', lamb: 'Lamb', pork: 'Pork', eggs: 'Eggs' };
                
                Object.entries(proteinTotals).forEach(([type, data]) => {
                    let amount;
                    if (type === 'eggs') {
                        amount = `${data.count} meals`;
                    } else if (data.grams > 0) {
                        const kg = data.grams >= 1000 ? `${(data.grams / 1000).toFixed(1)}kg` : `${data.grams}g`;
                        amount = `~${kg} total`;
                    } else {
                        amount = `${data.count} meals`;
                    }
                    newItems.push({
                        id: Date.now() + Math.random(),
                        name: `${proteinEmojis[type]} ${proteinNames[type]} (${amount})`,
                        cat: 'protein',
                        checked: false,
                        isSmart: true
                    });
                });

                // Add regular buy items
                Object.values(buyItems).forEach(item => {
                    // Skip items already in shopping list
                    if (shopping.some(s => s.name.toLowerCase().includes(item.name.toLowerCase()))) return;
                    
                    let displayAmount;
                    if (item.count === 1) {
                        displayAmount = item.amounts[0];
                    } else {
                        // Try to sum amounts
                        const totalGrams = item.amounts.reduce((sum, amt) => {
                            const match = amt.match(/(\d+)\s*g/i);
                            return sum + (match ? parseInt(match[1]) : 0);
                        }, 0);
                        const totalMl = item.amounts.reduce((sum, amt) => {
                            const match = amt.match(/(\d+)\s*ml/i);
                            return sum + (match ? parseInt(match[1]) : 0);
                        }, 0);
                        
                        if (totalGrams > 0) {
                            displayAmount = totalGrams >= 1000 ? `${(totalGrams / 1000).toFixed(1)}kg` : `${totalGrams}g`;
                        } else if (totalMl > 0) {
                            displayAmount = totalMl >= 1000 ? `${(totalMl / 1000).toFixed(1)}L` : `${totalMl}ml`;
                        } else {
                            displayAmount = `${item.count}√ó needed`;
                        }
                    }
                    
                    newItems.push({
                        id: Date.now() + Math.random(),
                        name: `${item.name} (${displayAmount})`,
                        cat: item.cat,
                        checked: false
                    });
                });

                // Add check stock items as a separate category
                const checkStockList = Object.values(checkItems);
                if (checkStockList.length > 0) {
                    newItems.push({
                        id: Date.now() + Math.random(),
                        name: '‚îÄ‚îÄ CHECK YOU HAVE ‚îÄ‚îÄ',
                        cat: 'pantry',
                        checked: false,
                        isHeader: true
                    });
                    checkStockList.forEach(item => {
                        newItems.push({
                            id: Date.now() + Math.random(),
                            name: `‚úì ${item.name}`,
                            cat: 'pantry',
                            checked: false,
                            isCheckStock: true
                        });
                    });
                }

                // Filter out items already in list
                const filteredItems = newItems.filter(item => 
                    item.isHeader || 
                    item.isCheckStock ||
                    !shopping.some(s => s.name.toLowerCase().includes(item.name.toLowerCase().split('(')[0].trim()))
                );

                if (filteredItems.length > 0) {
                    setShopping([...shopping, ...filteredItems]);
                }
                return filteredItems.length;
            };

            const clearMealPlan = () => {
                setMealPlan({});
            };

            // Save current plan with a name
            const saveCurrentPlan = (name) => {
                if (!name.trim() || Object.keys(mealPlan).length === 0) return false;
                const newPlan = {
                    id: Date.now(),
                    name: name.trim(),
                    plan: { ...mealPlan },
                    savedAt: new Date().toISOString(),
                    mealCount: Object.keys(mealPlan).length
                };
                setSavedPlans([newPlan, ...savedPlans].slice(0, 10)); // Keep max 10 plans
                return true;
            };

            // Load a saved plan
            const loadSavedPlan = (savedPlan) => {
                setMealPlan({ ...savedPlan.plan });
                setShowSavedPlans(false);
            };

            // Delete a saved plan
            const deleteSavedPlan = (planId) => {
                setSavedPlans(savedPlans.filter(p => p.id !== planId));
            };

            const filteredRecipesForPicker = () => {
                const search = mealPickerSearch.toLowerCase();
                let recipes = mealRecipes;
                if (search) {
                    recipes = recipes.filter(r => 
                        r.name.toLowerCase().includes(search) ||
                        r.proteins.some(p => p.includes(search))
                    );
                }
                return recipes;
            };

            // Check if essential is covered in shopping list
            const isEssentialInList = (essential) => {
                const searchTerms = {
                    protein: /chicken|beef|steak|salmon|fish|shrimp|lamb|pork|ground/i,
                    eggs: /egg/i,
                    avocado: /avocado/i,
                    greens: /spinach|lettuce|broccoli|asparagus|zucchini|pepper|cabbage|arugula|vegetable|greens/i,
                    oliveoil: /olive oil/i,
                    butter: /butter/i,
                    lemons: /lemon|lime/i,
                    garlic: /garlic|onion/i,
                };
                const regex = searchTerms[essential.id];
                return regex ? shopping.some(item => regex.test(item.name)) : false;
            };

            const addEssential = (essential) => {
                if (isEssentialInList(essential)) return;
                if (essential.hasPicker === 'protein') {
                    setShowProteinPicker(true);
                    return;
                }
                if (essential.hasPicker === 'veggies') {
                    setShowVeggiePicker(true);
                    return;
                }
                setShopping([...shopping, {
                    id: Date.now(),
                    name: essential.addText,
                    cat: essential.cat,
                    checked: false
                }]);
            };

            const addProteinCut = (cut) => {
                if (shopping.some(s => s.name === cut)) return;
                setShopping([...shopping, {
                    id: Date.now(),
                    name: cut,
                    cat: 'protein',
                    checked: false
                }]);
            };

            const addVeggieItem = (item) => {
                if (shopping.some(s => s.name === item)) return;
                setShopping([...shopping, {
                    id: Date.now(),
                    name: item,
                    cat: 'produce',
                    checked: false
                }]);
            };

            const essentialsCount = kitchenEssentials.filter(e => isEssentialInList(e)).length;

            // Auto-categorize items
            const categorizeItem = (name) => {
                const lower = name.toLowerCase();
                if (/chicken|beef|steak|salmon|fish|shrimp|lamb|pork|bacon|prosciutto|egg/i.test(lower)) return 'protein';
                if (/cheese|feta|parmesan|halloumi|cream|milk|yogurt|butter/i.test(lower)) return 'dairy';
                if (/broccoli|spinach|pepper|zucchini|mushroom|asparagus|avocado|tomato|onion|cucumber|lettuce|arugula|cabbage|cauliflower|garlic|ginger|lemon|lime|cilantro|parsley|basil/i.test(lower)) return 'produce';
                if (/oil|vinegar|spice|cumin|paprika|salt|pepper|sauce|paste|coconut|tahini|almond/i.test(lower)) return 'pantry';
                return 'other';
            };
            const [badges, setBadges] = useState(() => load('badges', []));
            const [stats, setStats] = useState(() => load('stats', { total: 0, streak: 0, lastDate: null }));

            const [showGuide, setShowGuide] = useState(false);
            const [showBadges, setShowBadges] = useState(false);
            const [showLove, setShowLove] = useState(false);
            const [loveMsg, setLoveMsg] = useState('');
            const [newBadge, setNewBadge] = useState(null);
            const [timer, setTimer] = useState(null);
            const [showRecipe, setShowRecipe] = useState(null);
            const [copied, setCopied] = useState(false);

            const saveTimeoutRef = useRef(null);
            useEffect(() => {
                if (saveTimeoutRef.current) clearTimeout(saveTimeoutRef.current);
                saveTimeoutRef.current = setTimeout(() => {
                    save('favs', favorites); save('hist', history); save('shop', shopping);
                    save('badges', badges); save('stats', stats); save('staples', staples);
                    save('mealPlan', mealPlan); save('savedPlans', savedPlans);
                }, 300);
            }, [favorites, history, shopping, badges, stats, staples, mealPlan, savedPlans]);

            const checkBadges = (s, f) => {
                const cs = s || stats, cf = f || favorites;
                achievements.forEach(b => {
                    if (badges.includes(b.id)) return;
                    let earned = false;
                    if (b.type === 'favorites') earned = cf.length >= b.threshold;
                    else if (b.type === 'streak') earned = cs.streak >= b.threshold;
                    else earned = cs.total >= b.threshold;
                    if (earned) { setBadges(p => [...p, b.id]); setNewBadge(b); }
                });
            };

            const toggle = (id, sel, setSel) => { setSel(sel.includes(id) ? sel.filter(i => i !== id) : [...sel, id]); setShowMeals(false); };
            const isFav = m => favorites.some(f => f.name === m.name);
            const toggleFav = m => { const nf = isFav(m) ? favorites.filter(f => f.name !== m.name) : [...favorites, { ...m, savedAt: new Date().toISOString() }]; setFavorites(nf); checkBadges(null, nf); };

            const addHistory = m => {
                const today = new Date().toISOString().split('T')[0];
                setHistory([{ ...m, cookedAt: new Date().toISOString() }, ...history].slice(0, 50));
                const ns = { ...stats, total: stats.total + 1 };
                if (stats.lastDate !== today) {
                    const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                    ns.streak = stats.lastDate === yesterday ? stats.streak + 1 : 1;
                    ns.lastDate = today;
                }
                setStats(ns); checkBadges(ns, null);
            };

            const addShopping = m => {
                const items = [];
                if (m.ingredients) {
                    m.ingredients.forEach(ing => {
                        const itemName = `${ing.item} (${ing.amount})`;
                        if (!shopping.some(s => s.name === itemName)) {
                            items.push({ 
                                id: Date.now() + Math.random(),
                                name: itemName, 
                                cat: categorizeItem(ing.item),
                                checked: false 
                            });
                        }
                    });
                }
                if (items.length) setShopping([...shopping, ...items]);
            };

            const addManualItem = () => {
                if (!newItem.trim()) return;
                const item = {
                    id: Date.now(),
                    name: newItem.trim(),
                    cat: categorizeItem(newItem),
                    checked: false
                };
                setShopping([...shopping, item]);
                setNewItem('');
            };

            const addQuickItem = (item) => {
                if (shopping.some(s => s.name === item.name)) return;
                setShopping([...shopping, { 
                    id: Date.now(), 
                    name: item.name, 
                    cat: item.cat, 
                    checked: false 
                }]);
            };

            const toggleChecked = (id) => {
                setShopping(shopping.map(item => 
                    item.id === id ? { ...item, checked: !item.checked } : item
                ));
            };

            const updateItemName = (id, newName) => {
                setShopping(shopping.map(item => 
                    item.id === id ? { ...item, name: newName } : item
                ));
                setEditingItem(null);
            };

            const deleteItem = (id) => {
                setShopping(shopping.filter(item => item.id !== id));
            };

            const clearChecked = () => {
                setShopping(shopping.filter(item => !item.checked));
            };

            const addStaplestoList = () => {
                const newItems = staples
                    .filter(s => !shopping.some(sh => sh.name === s.name))
                    .map(s => ({ ...s, id: Date.now() + Math.random(), checked: false }));
                if (newItems.length) setShopping([...shopping, ...newItems]);
            };

            const addToStaples = (item) => {
                if (staples.some(s => s.name === item.name)) return;
                setStaples([...staples, { name: item.name, cat: item.cat }]);
            };

            const removeFromStaples = (name) => {
                setStaples(staples.filter(s => s.name !== name));
            };

            const getItemsByCategory = () => {
                const grouped = { protein: [], produce: [], dairy: [], pantry: [], other: [] };
                shopping.forEach(item => {
                    const cat = item.cat || 'other';
                    if (grouped[cat]) grouped[cat].push(item);
                    else grouped.other.push(item);
                });
                return grouped;
            };

            const share = () => {
                const grouped = getItemsByCategory();
                let text = 'üõí *Shopping List*\n';
                Object.entries(grouped).forEach(([cat, items]) => {
                    if (items.length === 0) return;
                    const unchecked = items.filter(i => !i.checked);
                    if (unchecked.length === 0) return;
                    text += `\n${shopCategories[cat]?.emoji || 'üì¶'} *${shopCategories[cat]?.name || cat}*\n`;
                    unchecked.forEach(item => {
                        text += `‚Ä¢ ${item.name}\n`;
                    });
                });
                if (navigator.share) navigator.share({ title: 'Shopping List', text });
                else { navigator.clipboard.writeText(text); setCopied(true); setTimeout(() => setCopied(false), 2000); }
            };

            const applyPortions = m => portions === 1 ? m : { ...m, displayProtein: Math.round(m.baseProtein * portions), displayServing: m.servingSize ? m.servingSize.replace(/(\d+)g/g, (_, n) => Math.round(parseInt(n) * portions) + 'g') : m.description };

            const handleSurpriseMe = () => {
                if (selProteins.length === 0) { alert('Select at least one protein first!'); return; }
                const recipe = getSurpriseRecipe(selProteins, history);
                if (recipe) {
                    const flavor = selFlavor !== 'any' ? selFlavor : getRandom(recipe.flavors.filter(f => f !== 'any')) || 'classic';
                    const meal = { id: `${recipe.id}_${Date.now()}`, recipeId: recipe.id, ...recipe, flavor, veggies: selVeggies };
                    setMeals([meal]); setShowMeals(true);
                    setTimeout(() => { setLoveMsg(getRandom(loveMessages)); setShowLove(true); }, 1500);
                }
            };

            const genMeals = () => {
                const matching = mealRecipes.filter(r => {
                    if (!r.proteins.every(p => selProteins.includes(p))) return false;
                    if (r.requiresVeggies && selVeggies.length === 0) return false;
                    if (selFlavor !== 'any' && !r.flavors.includes(selFlavor) && !r.flavors.includes('any')) return false;
                    if (selCategory !== 'any' && r.category !== selCategory) return false;
                    return true;
                });

                const results = matching.map(r => {
                    const flavor = selFlavor !== 'any' ? selFlavor : getRandom(r.flavors.filter(f => f !== 'any')) || 'classic';
                    return { id: `${r.id}_${Date.now()}`, recipeId: r.id, ...r, flavor, veggies: selVeggies };
                });

                const shuffled = results.sort(() => 0.5 - Math.random()).slice(0, 4);
                setMeals(shuffled); setShowMeals(true);
                setTimeout(() => { setLoveMsg(getRandom(loveMessages)); setShowLove(true); }, 2500);
            };

            const getDressing = flavor => dressings.find(d => d.flavor === flavor) || dressings[0];

            const MealCard = ({ meal, actions = true }) => {
                const dm = applyPortions(meal);
                const dressing = meal.suggestDressing ? getDressing(meal.flavor) : null;
                return (
                    <div className="card rounded-[1.5rem] overflow-hidden border border-cream-200 mb-4">
                        <div className="h-1.5 bg-gradient-to-r from-coral-500 to-sand-500" />
                        <div className="p-5">
                            <div className="flex items-start justify-between mb-3">
                                <h3 className="text-lg font-bold text-warm-800">{meal.name}</h3>
                                <div className="flex items-center gap-2">
                                    {meal.isVenezuelan && <span className="text-xs bg-coral-100 text-coral-600 px-2 py-1 rounded-full">üáªüá™</span>}
                                    <button onClick={() => toggleFav(meal)} className="text-xl press">{isFav(meal) ? '‚ù§Ô∏è' : 'ü§ç'}</button>
                                </div>
                            </div>
                            <p className="text-warm-600 text-sm mb-3">{dm.displayServing || meal.servingSize}</p>
                            <div className="flex gap-2 flex-wrap mb-4">
                                <span className={`px-3 py-1.5 rounded-full text-xs font-semibold ${meal.lowProteinWarning ? 'bg-sand-100 text-sand-600' : 'bg-coral-100 text-coral-600'}`}>~{dm.displayProtein || meal.baseProtein}g protein</span>
                                <span className="px-3 py-1.5 rounded-full text-xs bg-cream-200 text-warm-600">‚è±Ô∏è {meal.time} min</span>
                                {meal.netCarbs !== undefined && <span className="px-3 py-1.5 rounded-full text-xs bg-sage-100 text-sage-600">{meal.netCarbs}g carbs</span>}
                            </div>
                            <button onClick={() => setShowRecipe(meal)} className="w-full py-2.5 mb-4 bg-cream-100 hover:bg-cream-200 rounded-xl text-warm-700 text-sm font-medium press">üìñ View Recipe & Ingredients</button>
                            {dressing && <div className="p-3 bg-sage-50 border border-sage-100 rounded-xl mb-4"><p className="text-sage-600 text-xs font-semibold">ü•ó {dressing.name}</p><p className="text-warm-600 text-xs">{dressing.recipe}</p></div>}
                            {actions && (
                                <div className="flex gap-2">
                                    <button onClick={() => { addHistory(meal); addShopping(meal); }} className="flex-1 py-3 bg-gradient-to-r from-coral-500 to-coral-600 rounded-xl text-white text-sm font-semibold press shadow-glow-coral">‚úì I made this</button>
                                    <button onClick={() => addShopping(meal)} className="py-3 px-4 bg-cream-200 rounded-xl text-warm-700 press">üõí</button>
                                    <button onClick={() => setTimer({ min: meal.time, label: meal.name })} className="py-3 px-4 bg-cream-200 rounded-xl text-warm-700 press">‚è±Ô∏è</button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-cream-100 pb-28">
                    <div className="fixed inset-0 overflow-hidden pointer-events-none">
                        <div className="absolute -top-40 -right-40 w-96 h-96 bg-coral-50 rounded-full opacity-60" />
                        <div className="absolute top-1/2 -left-40 w-80 h-80 bg-sage-50 rounded-full opacity-60" />
                    </div>

                    {showGuide && <GuideModal onClose={() => setShowGuide(false)} />}
                    {showBadges && <BadgesModal onClose={() => setShowBadges(false)} earned={badges} />}
                    {newBadge && <BadgePopup badge={newBadge} onClose={() => setNewBadge(null)} />}
                    {timer && <Timer minutes={timer.min} label={timer.label} onClose={() => setTimer(null)} />}
                    {showRecipe && <RecipeModal meal={showRecipe} onClose={() => setShowRecipe(null)} flavor={showRecipe.flavor} />}

                    {/* Recipe Book Modal */}
                    {showRecipeBook && (
                        <div className="fixed inset-0 z-50 flex items-end justify-center modal-overlay" onClick={() => setShowRecipeBook(false)}>
                            <div className="bg-cream-50 rounded-t-[2rem] w-full max-w-lg h-[90vh] overflow-hidden animate-slide-up shadow-soft-lg" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-center pt-3 pb-2"><div className="w-12 h-1 bg-cream-300 rounded-full" /></div>
                                <div className="px-5 pb-4">
                                    <h2 className="text-warm-800 font-bold text-xl mb-1">üìñ Recipe Book</h2>
                                    <p className="text-warm-500 text-sm mb-4">{mealRecipes.length} recipes to explore</p>
                                    
                                    {/* Category Filter */}
                                    <div className="flex gap-2 overflow-x-auto pb-2 -mx-1 px-1">
                                        {Object.values(mealCategories).map(c => (
                                            <button 
                                                key={c.id} 
                                                onClick={() => setRecipeBookFilter(c.id)}
                                                className={`px-3 py-1.5 rounded-lg text-sm font-medium whitespace-nowrap press transition-all ${
                                                    recipeBookFilter === c.id ? 'bg-coral-500 text-white' : 'bg-cream-200 text-warm-600'
                                                }`}
                                            >
                                                {c.emoji} {c.name}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                
                                <div className="px-5 pb-8 overflow-y-auto" style={{ height: 'calc(90vh - 160px)' }}>
                                    {/* Group recipes by protein */}
                                    {proteins.map(protein => {
                                        const proteinRecipes = mealRecipes.filter(r => 
                                            r.proteins.includes(protein.id) &&
                                            (recipeBookFilter === 'any' || r.category === recipeBookFilter)
                                        );
                                        if (proteinRecipes.length === 0) return null;
                                        
                                        return (
                                            <div key={protein.id} className="mb-5">
                                                <div className="flex items-center gap-2 mb-2 sticky top-0 bg-cream-50 py-2">
                                                    <span className="text-xl">{protein.emoji}</span>
                                                    <h3 className="text-warm-800 font-semibold">{protein.name}</h3>
                                                    <span className="text-warm-400 text-sm">({proteinRecipes.length})</span>
                                                </div>
                                                <div className="space-y-2">
                                                    {proteinRecipes.map(recipe => (
                                                        <button
                                                            key={recipe.id}
                                                            onClick={() => {
                                                                const meal = { ...recipe, flavor: recipe.flavors.find(f => f !== 'any') || 'classic' };
                                                                setShowRecipeBook(false);
                                                                setTimeout(() => setShowRecipe(meal), 100);
                                                            }}
                                                            className="w-full text-left card rounded-xl p-3 border border-cream-200 press hover:border-coral-200 transition-colors"
                                                        >
                                                            <div className="flex items-start justify-between">
                                                                <div className="flex-1">
                                                                    <div className="flex items-center gap-2 flex-wrap">
                                                                        <span className="text-warm-800 font-medium text-sm">{recipe.name}</span>
                                                                        {recipe.isVenezuelan && <span className="text-xs">üáªüá™</span>}
                                                                    </div>
                                                                    <div className="flex items-center gap-2 mt-1 flex-wrap">
                                                                        <span className="text-coral-500 text-xs font-medium">~{recipe.baseProtein}g</span>
                                                                        <span className="text-warm-400 text-xs">‚è±Ô∏è {recipe.time}min</span>
                                                                        {recipe.netCarbs !== undefined && <span className="text-sage-500 text-xs">{recipe.netCarbs}g carbs</span>}
                                                                        <span className="text-warm-400 text-xs">{mealCategories[recipe.category]?.emoji}</span>
                                                                    </div>
                                                                </div>
                                                                <span className="text-warm-300 ml-2">‚Üí</span>
                                                            </div>
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>
                                        );
                                    })}
                                    
                                    {/* Show message if no recipes match filter */}
                                    {mealRecipes.filter(r => recipeBookFilter === 'any' || r.category === recipeBookFilter).length === 0 && (
                                        <div className="text-center py-8">
                                            <span className="text-4xl mb-3 block">üîç</span>
                                            <p className="text-warm-600">No recipes in this category</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    {showLove && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-6" onClick={() => setShowLove(false)}>
                            <div className="absolute inset-0 bg-warm-900/20 backdrop-blur-md">
                                {[...Array(12)].map((_, i) => <div key={i} className="absolute text-2xl animate-float-up" style={{ left: `${Math.random()*100}%`, animationDelay: `${Math.random()*2}s` }}>{['üíï','üíñ','‚ù§Ô∏è','‚ú®'][i % 4]}</div>)}
                            </div>
                            <div className="relative animate-bounce-in" onClick={e => e.stopPropagation()}>
                                <div className="absolute -inset-6 bg-gradient-to-r from-coral-300 to-sand-300 rounded-[3rem] blur-2xl opacity-50 animate-pulse-soft" />
                                <div className="relative bg-white rounded-[2rem] p-8 max-w-sm w-full border border-coral-100 shadow-soft-lg">
                                    <div className="absolute -top-4 left-1/2 -translate-x-1/2 bg-gradient-to-r from-coral-500 to-sand-500 text-white text-xs font-semibold px-4 py-2 rounded-full">üíå From Diego</div>
                                    <div className="flex justify-center mb-6 mt-2">
                                        <div className="w-20 h-20 bg-gradient-to-br from-coral-400 to-sand-400 rounded-full flex items-center justify-center">
                                            <span className="text-4xl animate-heartbeat">üíï</span>
                                        </div>
                                    </div>
                                    <p className="text-warm-800 text-xl font-medium text-center mb-6">{loveMsg}</p>
                                    <button onClick={() => setShowLove(false)} className="w-full py-3.5 bg-gradient-to-r from-coral-500 to-sand-500 rounded-2xl text-white font-semibold press">Ay Diego üòÖ</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="relative max-w-lg mx-auto px-5 pt-6 pb-8">
                        {/* Header */}
                        <div className="flex items-center justify-between mb-5">
                            <button onClick={() => setShowGuide(true)} className="w-12 h-12 rounded-2xl card border border-cream-200 flex items-center justify-center text-xl press">üìã</button>
                            <div className="text-center">
                                <h1 className="text-2xl font-bold text-warm-800">Nene's Kitchen</h1>
                                <p className="text-warm-600 text-sm">{stats.total} meals ‚Ä¢ {stats.streak} day streak üî•</p>
                            </div>
                            <button onClick={() => setShowBadges(true)} className="w-12 h-12 rounded-2xl card border border-cream-200 flex items-center justify-center text-xl press relative">üèÜ{badges.length > 0 && <span className="absolute -top-1 -right-1 w-5 h-5 bg-coral-500 rounded-full text-[10px] text-white flex items-center justify-center">{badges.length}</span>}</button>
                        </div>

                        {tab === 'create' && (<>
                            {/* Hero Stats Card - RESTORED */}
                            <div className="card rounded-2xl px-5 py-3 mb-4 border border-cream-200">
                                <div className="flex items-center justify-center gap-4 text-sm">
                                    <span className="text-warm-600">Target:</span>
                                    <span className="text-coral-500 font-bold">80-100g protein</span>
                                    <span className="text-cream-300">‚Ä¢</span>
                                    <span className="text-warm-600">~1,800 cal</span>
                                </div>
                            </div>

                            {/* Browse All Recipes Button */}
                            <button 
                                onClick={() => setShowRecipeBook(true)}
                                className="w-full mb-5 py-3 px-4 card rounded-2xl border border-cream-200 flex items-center justify-between press hover:border-coral-300 transition-colors"
                            >
                                <div className="flex items-center gap-3">
                                    <span className="text-2xl">üìñ</span>
                                    <div className="text-left">
                                        <p className="text-warm-800 font-semibold text-sm">Browse All Recipes</p>
                                        <p className="text-warm-500 text-xs">{mealRecipes.length} recipes for inspiration</p>
                                    </div>
                                </div>
                                <span className="text-warm-400">‚Üí</span>
                            </button>

                            {/* Meal Type - Now prominent */}
                            <div className="mb-4">
                                <h2 className="text-warm-600 text-xs font-semibold uppercase tracking-wider mb-3">What meal?</h2>
                                <div className="flex gap-2 flex-wrap">
                                    {Object.values(mealCategories).map(c => (
                                        <button key={c.id} onClick={() => { setSelCategory(c.id); setShowMeals(false); }}
                                            className={`px-4 py-2.5 rounded-xl text-sm font-medium transition-all press ${selCategory === c.id ? 'chip-selected' : 'chip-unselected'}`}>
                                            {c.emoji} {c.name}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Flavor - What's the vibe */}
                            <div className="mb-4">
                                <h2 className="text-warm-600 text-xs font-semibold uppercase tracking-wider mb-3">What's the vibe?</h2>
                                <div className="flex gap-2 flex-wrap">
                                    {Object.values(flavorProfiles).map(f => (
                                        <button key={f.id} onClick={() => { setSelFlavor(f.id); setShowMeals(false); }}
                                            className={`px-4 py-2.5 rounded-xl text-sm font-medium transition-all press ${selFlavor === f.id ? 'chip-selected' : 'chip-unselected'}`}>
                                            {f.emoji} {f.name}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Portions */}
                            <div className="card rounded-2xl px-5 py-4 mb-5 border border-cream-200 flex items-center justify-between">
                                <span className="text-warm-600 text-sm">Cooking for</span>
                                <div className="flex gap-2">
                                    {[1, 2].map(n => (
                                        <button key={n} onClick={() => setPortions(n)}
                                            className={`px-4 py-2 rounded-xl text-sm font-medium transition-all press ${portions === n ? 'bg-sand-500 text-white' : 'bg-cream-200 text-warm-600'}`}>
                                            {n} {n === 1 ? 'person' : 'people'}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Protein */}
                            <div className="mb-5">
                                <h2 className="text-warm-600 text-xs font-semibold uppercase tracking-wider mb-3 flex items-center gap-2">
                                    <span className="w-6 h-6 rounded-lg bg-gradient-to-br from-coral-400 to-coral-500 flex items-center justify-center text-xs text-white">ü•©</span>
                                    What protein?
                                </h2>
                                <div className="grid grid-cols-3 gap-2">
                                    {proteins.map(p => (
                                        <button key={p.id} onClick={() => toggle(p.id, selProteins, setSelProteins)}
                                            className={`p-3 rounded-2xl text-center transition-all press ${selProteins.includes(p.id) ? 'chip-selected scale-105' : 'chip-unselected'}`}>
                                            <span className="text-2xl block mb-1">{p.emoji}</span>
                                            <span className="text-xs font-medium">{p.name}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Veggies */}
                            <div className="mb-5">
                                <h2 className="text-warm-600 text-xs font-semibold uppercase tracking-wider mb-3 flex items-center gap-2">
                                    <span className="w-6 h-6 rounded-lg bg-gradient-to-br from-sage-400 to-sage-500 flex items-center justify-center text-xs text-white">ü•¨</span>
                                    What veggies?
                                </h2>
                                <div className="grid grid-cols-4 gap-2">
                                    {vegetables.map(v => (
                                        <button key={v.id} onClick={() => toggle(v.id, selVeggies, setSelVeggies)}
                                            className={`p-2.5 rounded-xl text-center transition-all press relative ${selVeggies.includes(v.id) ? 'bg-sage-500 text-white scale-105 shadow-glow-sage' : 'chip-unselected'}`}>
                                            <span className="text-xl block">{v.emoji}</span>
                                            <span className="text-[10px] font-medium">{v.name}</span>
                                            {v.warning && <span className="absolute -top-1 -right-1 w-4 h-4 bg-sand-500 rounded-full text-[8px] flex items-center justify-center text-white">!</span>}
                                        </button>
                                    ))}
                                </div>
                                {selVeggies.includes('spinach') && <div className="mt-3 p-3 bg-sand-50 border border-sand-200 rounded-xl"><p className="text-sand-600 text-xs font-medium">‚ö†Ô∏è Spinach: Max 2-3x per week</p></div>}
                            </div>

                            {/* Cheese */}
                            <div className="mb-6">
                                <h2 className="text-warm-600 text-xs font-semibold uppercase tracking-wider mb-3 flex items-center gap-2">
                                    <span className="w-6 h-6 rounded-lg bg-gradient-to-br from-sand-400 to-sand-500 flex items-center justify-center text-xs text-white">üßÄ</span>
                                    Cheese? <span className="font-normal text-warm-500">(max 50g)</span>
                                </h2>
                                <div className="grid grid-cols-3 gap-2">
                                    {cheeses.map(c => (
                                        <button key={c.id} onClick={() => toggle(c.id, selCheese, setSelCheese)}
                                            className={`p-3 rounded-2xl text-center transition-all press ${selCheese.includes(c.id) ? 'bg-sand-500 text-white scale-105' : 'chip-unselected'}`}>
                                            <span className="text-2xl block mb-1">{c.emoji}</span>
                                            <span className="text-xs font-medium">{c.name}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Action buttons - Show Recipes + Surprise Me side by side */}
                            <div className="flex gap-3 mb-6">
                                <button onClick={genMeals} disabled={!selProteins.length}
                                    className={`flex-1 py-4 rounded-2xl font-bold text-base press ${selProteins.length > 0 ? 'bg-warm-800 text-white' : 'bg-cream-200 text-warm-500'}`}>
                                    Show Recipes
                                </button>
                                <button onClick={handleSurpriseMe} disabled={!selProteins.length}
                                    className={`py-4 px-5 rounded-2xl font-bold text-base press ${selProteins.length > 0 ? 'bg-gradient-to-r from-coral-500 to-sand-500 text-white shadow-glow-coral' : 'bg-cream-200 text-warm-500'}`}>
                                    üé≤
                                </button>
                            </div>

                            {showMeals && meals.length > 0 && (
                                <div className="animate-fade-in">
                                    {meals.map(m => <MealCard key={m.id} meal={m} />)}
                                    <button onClick={() => { 
                                        setMeals([]); 
                                        setShowMeals(false); 
                                        setSelProteins([]);
                                        setSelVeggies([]);
                                        setSelCheese([]);
                                        setSelFlavor('any');
                                        setSelCategory('any');
                                        setPortions(1);
                                    }} className="w-full py-3 text-warm-600 text-sm">Clear & Start Over</button>
                                </div>
                            )}
                        </>)}

                        {/* PLAN TAB */}
                        {tab === 'plan' && (
                            <div className="animate-fade-in">
                                <div className="flex justify-between items-center mb-4">
                                    <div>
                                        <h2 className="text-warm-800 font-bold text-lg">üóìÔ∏è Weekly Plan</h2>
                                        <p className="text-warm-500 text-xs">Plan meals, auto-generate shopping list</p>
                                    </div>
                                    <div className="flex gap-2">
                                        <button 
                                            onClick={() => setShowSavedPlans(true)} 
                                            className="px-3 py-1.5 bg-cream-200 text-warm-700 rounded-lg text-xs font-medium press"
                                        >
                                            üìÇ {savedPlans.length > 0 ? `(${savedPlans.length})` : ''}
                                        </button>
                                        {Object.keys(mealPlan).length > 0 && (
                                            <button onClick={clearMealPlan} className="text-warm-400 text-xs underline">Clear</button>
                                        )}
                                    </div>
                                </div>

                                {/* Save Plan Input - show when plan has meals */}
                                {Object.keys(mealPlan).length > 0 && (
                                    <div className="card rounded-2xl p-3 mb-4 border border-cream-200">
                                        <div className="flex gap-2">
                                            <input
                                                type="text"
                                                value={savePlanName}
                                                onChange={(e) => setSavePlanName(e.target.value)}
                                                placeholder="Name this plan (e.g., Week 1, Meal Prep)"
                                                className="flex-1 px-3 py-2 bg-cream-100 rounded-xl text-sm text-warm-800 placeholder:text-warm-400 focus:outline-none focus:ring-2 focus:ring-coral-300"
                                            />
                                            <button
                                                onClick={() => {
                                                    if (saveCurrentPlan(savePlanName)) {
                                                        setSavePlanName('');
                                                        alert('Plan saved! ‚úì');
                                                    }
                                                }}
                                                disabled={!savePlanName.trim()}
                                                className={`px-4 py-2 rounded-xl text-sm font-medium press ${savePlanName.trim() ? 'bg-sage-500 text-white' : 'bg-cream-200 text-warm-400'}`}
                                            >
                                                üíæ Save
                                            </button>
                                        </div>
                                    </div>
                                )}
                                </div>

                                {/* Week Stats */}
                                {Object.keys(mealPlan).length > 0 && (() => {
                                    const stats = getPlanStats();
                                    return (
                                        <div className="card rounded-2xl p-4 mb-5 border border-cream-200">
                                            <div className="flex justify-between items-center">
                                                <div className="flex gap-4">
                                                    <div>
                                                        <p className="text-warm-500 text-xs">Meals</p>
                                                        <p className="text-warm-800 font-bold">{stats.count}</p>
                                                    </div>
                                                    <div>
                                                        <p className="text-warm-500 text-xs">Protein</p>
                                                        <p className="text-coral-500 font-bold">{stats.totalProtein}g</p>
                                                    </div>
                                                    <div>
                                                        <p className="text-warm-500 text-xs">Carbs</p>
                                                        <p className="text-sage-500 font-bold">{stats.totalCarbs}g</p>
                                                    </div>
                                                </div>
                                                <button 
                                                    onClick={() => {
                                                        const added = generateShoppingListFromPlan();
                                                        alert(`Added ${added} items to shopping list!`);
                                                        if (added > 0) setTab('shop');
                                                    }}
                                                    className="px-4 py-2 bg-gradient-to-r from-coral-500 to-sand-500 text-white rounded-xl text-sm font-semibold press shadow-glow-coral"
                                                >
                                                    üõí Generate List
                                                </button>
                                            </div>
                                        </div>
                                    );
                                })()}

                                {/* Week Grid */}
                                <div className="space-y-3">
                                    {weekDays.map(day => (
                                        <div key={day.id} className="card rounded-2xl border border-cream-200 overflow-hidden">
                                            <div className="px-4 py-2 bg-cream-100 border-b border-cream-200">
                                                <span className="text-warm-800 font-semibold text-sm">{day.name}</span>
                                            </div>
                                            <div className="divide-y divide-cream-100">
                                                {['lunch', 'dinner'].map(slot => {
                                                    const meal = getMealForSlot(day.id, slot);
                                                    return (
                                                        <div key={slot} className="px-4 py-3 flex items-center justify-between">
                                                            <div className="flex items-center gap-3">
                                                                <span className="text-warm-400 text-xs uppercase w-12">{slot}</span>
                                                                {meal ? (
                                                                    <div>
                                                                        <p className="text-warm-800 text-sm font-medium">{meal.name}</p>
                                                                        <p className="text-coral-500 text-xs">~{meal.baseProtein}g protein</p>
                                                                    </div>
                                                                ) : (
                                                                    <span className="text-warm-400 text-sm">No meal planned</span>
                                                                )}
                                                            </div>
                                                            {meal ? (
                                                                <button 
                                                                    onClick={() => removeMealFromPlan(day.id, slot)}
                                                                    className="text-warm-400 hover:text-coral-500 text-lg press"
                                                                >√ó</button>
                                                            ) : (
                                                                <button 
                                                                    onClick={() => setShowMealPicker({ day: day.id, slot })}
                                                                    className="px-3 py-1.5 bg-coral-500 text-white rounded-lg text-xs font-medium press"
                                                                >+ Add</button>
                                                            )}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                {/* Empty State */}
                                {Object.keys(mealPlan).length === 0 && (
                                    <div className="text-center py-8 mt-4">
                                        <span className="text-4xl mb-3 block">üìù</span>
                                        <p className="text-warm-600 mb-1">No meals planned yet</p>
                                        <p className="text-warm-500 text-sm">Tap "+ Add" to plan your week</p>
                                    </div>
                                )}

                                {/* Meal Picker Modal */}
                                {showMealPicker && !showCustomMealForPlan && (
                                    <div className="fixed inset-0 z-50 flex items-end justify-center modal-overlay" onClick={() => { setShowMealPicker(null); setMealPickerSearch(''); }}>
                                        <div className="bg-cream-50 rounded-t-[2rem] w-full max-w-lg h-[85vh] overflow-hidden animate-slide-up shadow-soft-lg" onClick={e => e.stopPropagation()}>
                                            <div className="flex justify-center pt-3 pb-2"><div className="w-12 h-1 bg-cream-300 rounded-full" /></div>
                                            <div className="px-5 pb-4">
                                                <h2 className="text-warm-800 font-bold text-lg mb-1">
                                                    Add {showMealPicker.slot} for {weekDays.find(d => d.id === showMealPicker.day)?.name}
                                                </h2>
                                                
                                                {/* Custom Meal Button */}
                                                <button 
                                                    onClick={() => setShowCustomMealForPlan(true)}
                                                    className="w-full mt-3 py-3 bg-gradient-to-r from-warm-700 to-warm-800 text-white rounded-xl font-medium press flex items-center justify-center gap-2"
                                                >
                                                    <span>üìù</span> Add Custom Meal (not a recipe)
                                                </button>

                                                {/* Search */}
                                                <input
                                                    type="text"
                                                    value={mealPickerSearch}
                                                    onChange={(e) => setMealPickerSearch(e.target.value)}
                                                    placeholder="Search recipes..."
                                                    className="w-full mt-3 px-4 py-3 rounded-xl border border-cream-300 bg-white text-warm-800 text-sm focus:outline-none focus:border-coral-400"
                                                />

                                                {/* Quick access to favorites */}
                                                {favorites.length > 0 && !mealPickerSearch && (
                                                    <div className="mt-4">
                                                        <p className="text-warm-500 text-xs mb-2">‚ù§Ô∏è Favorites</p>
                                                        <div className="flex gap-2 overflow-x-auto pb-2">
                                                            {favorites.slice(0, 5).map((meal, i) => (
                                                                <button
                                                                    key={i}
                                                                    onClick={() => addMealToPlan(meal)}
                                                                    className="flex-shrink-0 px-3 py-2 bg-coral-50 border border-coral-200 rounded-xl text-sm text-warm-700 press"
                                                                >
                                                                    {meal.name.length > 20 ? meal.name.slice(0, 20) + '...' : meal.name}
                                                                </button>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                            
                                            <div className="px-5 pb-8 overflow-y-auto" style={{ height: 'calc(85vh - 220px)' }}>
                                                <p className="text-warm-500 text-xs mb-2">üìñ All Recipes</p>
                                                {/* Recipe List */}
                                                <div className="space-y-2">
                                                    {filteredRecipesForPicker().map(recipe => (
                                                        <button
                                                            key={recipe.id}
                                                            onClick={() => addMealToPlan(recipe)}
                                                            className="w-full text-left card rounded-xl p-3 border border-cream-200 press hover:border-coral-200 transition-colors"
                                                        >
                                                            <div className="flex justify-between items-center">
                                                                <div>
                                                                    <div className="flex items-center gap-2">
                                                                        <span className="text-warm-800 font-medium text-sm">{recipe.name}</span>
                                                                        {recipe.isVenezuelan && <span className="text-xs">üáªüá™</span>}
                                                                    </div>
                                                                    <div className="flex items-center gap-2 mt-1">
                                                                        <span className="text-coral-500 text-xs">~{recipe.baseProtein}g</span>
                                                                        <span className="text-warm-400 text-xs">‚è±Ô∏è{recipe.time}min</span>
                                                                        {recipe.netCarbs !== undefined && <span className="text-sage-500 text-xs">{recipe.netCarbs}g carbs</span>}
                                                                    </div>
                                                                </div>
                                                                <span className="text-coral-500 text-xl">+</span>
                                                            </div>
                                                        </button>
                                                    ))}
                                                </div>

                                                {filteredRecipesForPicker().length === 0 && (
                                                    <div className="text-center py-8">
                                                        <p className="text-warm-500">No recipes found</p>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Custom Meal for Plan Modal */}
                                {showMealPicker && showCustomMealForPlan && (
                                    <div className="fixed inset-0 z-50 flex items-end justify-center modal-overlay" onClick={() => { setShowCustomMealForPlan(false); resetCustomMeal(); }}>
                                        <div className="bg-cream-50 rounded-t-[2rem] w-full max-w-lg max-h-[92vh] overflow-hidden animate-slide-up shadow-soft-lg" onClick={e => e.stopPropagation()}>
                                            <div className="flex justify-center pt-3 pb-2"><div className="w-12 h-1 bg-cream-300 rounded-full" /></div>
                                            <div className="px-5 pb-8 overflow-y-auto max-h-[82vh]">
                                                <div className="flex items-center gap-2 mb-1">
                                                    <button onClick={() => setShowCustomMealForPlan(false)} className="text-warm-500 text-sm">‚Üê Back</button>
                                                </div>
                                                <h2 className="text-warm-800 font-bold text-xl mb-1">üìù Custom Meal</h2>
                                                <p className="text-warm-500 text-sm mb-3">For {weekDays.find(d => d.id === showMealPicker.day)?.name} {showMealPicker.slot}</p>

                                                {/* Optional meal name */}
                                                <input
                                                    type="text"
                                                    value={customMeal.name}
                                                    onChange={(e) => setCustomMeal(prev => ({ ...prev, name: e.target.value }))}
                                                    placeholder="Name this meal (optional)"
                                                    className="w-full mb-4 px-4 py-2.5 rounded-xl border border-cream-300 bg-white text-warm-800 text-sm focus:outline-none focus:border-coral-400"
                                                />

                                                {/* Live Total - Sticky */}
                                                <div className="sticky top-0 z-10 bg-gradient-to-r from-coral-500 to-sand-500 rounded-xl p-3 mb-4 shadow-glow-coral">
                                                    <div className="flex justify-between items-center text-white">
                                                        <span className="font-semibold">Total:</span>
                                                        <div className="flex gap-4">
                                                            <span className="font-bold">~{calcCustomProtein()}g protein</span>
                                                            <span>|</span>
                                                            <span>{calcCustomCarbs()}g carbs</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Compact Protein Inputs */}
                                                <div className="mb-4">
                                                    <h3 className="text-warm-700 font-semibold text-sm mb-2">ü•© Proteins</h3>
                                                    
                                                    {/* Eggs */}
                                                    <div className="flex items-center justify-between py-2 border-b border-cream-200">
                                                        <span className="text-warm-700 text-sm">ü•ö Eggs</span>
                                                        <div className="flex items-center gap-2">
                                                            <button onClick={() => setCustomMeal(prev => ({ ...prev, eggs: Math.max(0, prev.eggs - 0.5) }))} className="w-7 h-7 rounded-lg bg-cream-200 text-warm-600 font-bold text-sm press">‚àí</button>
                                                            <span className="w-6 text-center font-semibold text-warm-800">{customMeal.eggs}</span>
                                                            <button onClick={() => setCustomMeal(prev => ({ ...prev, eggs: prev.eggs + 0.5 }))} className="w-7 h-7 rounded-lg bg-coral-500 text-white font-bold text-sm press">+</button>
                                                            <span className="w-12 text-right text-coral-500 text-xs">{customMeal.eggs > 0 ? `${Math.round(customMeal.eggs * 6)}g` : ''}</span>
                                                        </div>
                                                    </div>

                                                    {/* Main proteins */}
                                                    {[
                                                        { id: 'beef', name: 'Beef', emoji: 'ü•©' },
                                                        { id: 'chicken', name: 'Chicken', emoji: 'üçó' },
                                                        { id: 'ground', name: 'Ground', emoji: 'üçî' },
                                                        { id: 'salmon', name: 'Salmon', emoji: 'üêü' },
                                                        { id: 'fish', name: 'Fish', emoji: 'üê†' },
                                                        { id: 'pork', name: 'Pork', emoji: 'üê∑' },
                                                    ].map(p => (
                                                        <div key={p.id} className="flex items-center justify-between py-1.5 border-b border-cream-100">
                                                            <span className="text-warm-700 text-sm">{p.emoji} {p.name}</span>
                                                            <div className="flex items-center gap-1">
                                                                <input type="number" value={customMeal.proteins[p.id]} onChange={(e) => updateCustomProtein(p.id, e.target.value)} placeholder="0" className="w-16 px-2 py-1 rounded border border-cream-300 text-sm text-right" />
                                                                <span className="text-warm-400 text-xs">g</span>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>

                                                {/* Compact Veggies */}
                                                <div className="mb-4">
                                                    <h3 className="text-warm-700 font-semibold text-sm mb-2">ü•¨ Veggies (carbs)</h3>
                                                    <div className="flex items-center justify-between py-2 border-b border-cream-200">
                                                        <span className="text-warm-700 text-sm">ü•ë Avocado</span>
                                                        <div className="flex items-center gap-2">
                                                            <button onClick={() => updateCustomVeggie('avocado', Math.max(0, (customMeal.veggies.avocado || 0) - 0.5))} className="w-7 h-7 rounded-lg bg-cream-200 text-warm-600 font-bold text-sm press">‚àí</button>
                                                            <span className="w-6 text-center font-semibold text-warm-800">{customMeal.veggies.avocado || 0}</span>
                                                            <button onClick={() => updateCustomVeggie('avocado', (customMeal.veggies.avocado || 0) + 0.5)} className="w-7 h-7 rounded-lg bg-sage-500 text-white font-bold text-sm press">+</button>
                                                        </div>
                                                    </div>
                                                    <div className="grid grid-cols-2 gap-2 mt-2">
                                                        {['broccoli', 'spinach', 'peppers', 'tomatoes', 'onions', 'zucchini'].map(v => (
                                                            <div key={v} className="flex items-center justify-between">
                                                                <span className="text-warm-600 text-xs capitalize">{v}</span>
                                                                <div className="flex items-center gap-1">
                                                                    <input type="number" value={customMeal.veggies[v]} onChange={(e) => updateCustomVeggie(v, e.target.value)} placeholder="0" className="w-12 px-1 py-0.5 rounded border border-cream-300 text-xs text-right" />
                                                                    <span className="text-warm-400 text-xs">g</span>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>

                                                {/* Cheese */}
                                                <div className="flex items-center justify-between py-2 mb-4">
                                                    <span className="text-warm-700 text-sm">üßÄ Cheese</span>
                                                    <div className="flex items-center gap-1">
                                                        <input type="number" value={customMeal.cheese} onChange={(e) => setCustomMeal(prev => ({ ...prev, cheese: e.target.value }))} placeholder="0" className="w-16 px-2 py-1 rounded border border-cream-300 text-sm text-right" />
                                                        <span className="text-warm-400 text-xs">g</span>
                                                    </div>
                                                </div>

                                                {/* Preview */}
                                                {hasCustomMealContent() && (
                                                    <div className="bg-cream-100 rounded-xl p-3 mb-4">
                                                        <p className="text-warm-600 text-xs">Will add:</p>
                                                        <p className="text-warm-800 font-medium text-sm">{buildCustomMealName()}</p>
                                                    </div>
                                                )}

                                                {/* Add Button */}
                                                <button 
                                                    onClick={() => {
                                                        const meal = createCustomMealForPlan();
                                                        if (meal) {
                                                            addMealToPlan(meal);
                                                            setShowCustomMealForPlan(false);
                                                            resetCustomMeal();
                                                        }
                                                    }}
                                                    disabled={!hasCustomMealContent()}
                                                    className={`w-full py-4 rounded-xl font-bold text-lg press ${
                                                        hasCustomMealContent()
                                                            ? 'bg-coral-500 text-white shadow-glow-coral'
                                                            : 'bg-cream-200 text-warm-400'
                                                    }`}
                                                >
                                                    ‚úì Add to Plan
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Saved Plans Modal */}
                                {showSavedPlans && (
                                    <div className="fixed inset-0 z-50 flex items-end justify-center modal-overlay" onClick={() => setShowSavedPlans(false)}>
                                        <div className="bg-cream-50 rounded-t-[2rem] w-full max-w-lg max-h-[80vh] overflow-hidden animate-slide-up shadow-soft-lg" onClick={e => e.stopPropagation()}>
                                            <div className="flex justify-center pt-3 pb-2"><div className="w-12 h-1 bg-cream-300 rounded-full" /></div>
                                            <div className="px-5 pb-8 overflow-y-auto max-h-[70vh]">
                                                <h3 className="text-warm-800 font-bold text-lg mb-1">üìÇ Saved Plans</h3>
                                                <p className="text-warm-500 text-sm mb-4">Tap to load a saved weekly plan</p>
                                                
                                                {savedPlans.length === 0 ? (
                                                    <div className="text-center py-10">
                                                        <span className="text-4xl mb-3 block">üìã</span>
                                                        <p className="text-warm-600 mb-1">No saved plans yet</p>
                                                        <p className="text-warm-500 text-sm">Create a meal plan and save it with a name</p>
                                                    </div>
                                                ) : (
                                                    <div className="space-y-3">
                                                        {savedPlans.map(plan => (
                                                            <div key={plan.id} className="card rounded-2xl border border-cream-200 overflow-hidden">
                                                                <button
                                                                    onClick={() => loadSavedPlan(plan)}
                                                                    className="w-full px-4 py-3 text-left hover:bg-cream-50 press"
                                                                >
                                                                    <div className="flex items-center justify-between">
                                                                        <div>
                                                                            <p className="text-warm-800 font-semibold">{plan.name}</p>
                                                                            <p className="text-warm-500 text-xs">
                                                                                {plan.mealCount} meals ‚Ä¢ Saved {new Date(plan.savedAt).toLocaleDateString()}
                                                                            </p>
                                                                        </div>
                                                                        <span className="text-coral-500 text-sm">Load ‚Üí</span>
                                                                    </div>
                                                                </button>
                                                                <div className="px-4 py-2 bg-cream-50 border-t border-cream-200 flex justify-end">
                                                                    <button
                                                                        onClick={(e) => {
                                                                            e.stopPropagation();
                                                                            if (confirm(`Delete "${plan.name}"?`)) {
                                                                                deleteSavedPlan(plan.id);
                                                                            }
                                                                        }}
                                                                        className="text-warm-400 hover:text-coral-500 text-xs"
                                                                    >
                                                                        üóëÔ∏è Delete
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                                
                                                <button 
                                                    onClick={() => setShowSavedPlans(false)} 
                                                    className="w-full mt-4 py-3 bg-warm-800 text-white rounded-xl font-medium press"
                                                >
                                                    Close
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {tab === 'shop' && (
                            <div className="animate-fade-in">
                                {/* Header */}
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-warm-800 font-bold text-lg">üõí Shopping List</h2>
                                    <div className="flex gap-2">
                                        {shopping.length > 0 && <button onClick={share} className="px-3 py-2 bg-sage-500 text-white rounded-xl text-sm font-medium press">üì§</button>}
                                        {shopping.some(i => i.checked) && <button onClick={clearChecked} className="px-3 py-2 bg-cream-200 text-warm-600 rounded-xl text-sm press">Clear ‚úì</button>}
                                    </div>
                                </div>

                                {copied && <div className="bg-sage-100 rounded-xl p-3 text-sage-600 text-sm text-center mb-4 animate-fade-in">‚úì Copied to clipboard!</div>}

                                {/* Kitchen Essentials */}
                                <div className="card rounded-2xl border border-cream-200 overflow-hidden mb-5">
                                    <div className="px-4 py-3 bg-gradient-to-r from-coral-50 to-sand-50 border-b border-cream-200">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <h3 className="text-warm-800 font-semibold text-sm">üè† Kitchen Essentials</h3>
                                                <p className="text-warm-500 text-xs">Your protocol needs these stocked</p>
                                            </div>
                                            <div className="text-right">
                                                <span className={`text-sm font-bold ${essentialsCount === kitchenEssentials.length ? 'text-sage-500' : 'text-coral-500'}`}>
                                                    {essentialsCount}/{kitchenEssentials.length}
                                                </span>
                                                <p className="text-warm-400 text-xs">in list</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-px bg-cream-200">
                                        {kitchenEssentials.map((essential) => {
                                            const inList = isEssentialInList(essential);
                                            return (
                                                <button
                                                    key={essential.id}
                                                    onClick={() => addEssential(essential)}
                                                    disabled={inList}
                                                    className={`flex items-center gap-3 px-3 py-3 text-left transition-all press ${
                                                        inList ? 'bg-sage-50' : 'bg-white hover:bg-cream-50'
                                                    }`}
                                                >
                                                    <span className={`w-8 h-8 rounded-full flex items-center justify-center text-lg ${
                                                        inList ? 'bg-sage-100' : 'bg-cream-100'
                                                    }`}>
                                                        {inList ? '‚úì' : essential.emoji}
                                                    </span>
                                                    <div className="flex-1 min-w-0">
                                                        <p className={`text-sm font-medium truncate ${inList ? 'text-sage-600' : 'text-warm-700'}`}>
                                                            {essential.name}
                                                        </p>
                                                        <p className="text-warm-400 text-xs truncate">{essential.description}</p>
                                                    </div>
                                                </button>
                                            );
                                        })}
                                    </div>
                                    {essentialsCount < kitchenEssentials.length && (
                                        <div className="px-4 py-2 bg-coral-50 border-t border-coral-100">
                                            <p className="text-coral-600 text-xs text-center">
                                                ‚òùÔ∏è Tap items above to add to your list
                                            </p>
                                        </div>
                                    )}
                                </div>

                                {/* Manual Add Input */}
                                <div className="flex gap-2 mb-4">
                                    <input
                                        type="text"
                                        value={newItem}
                                        onChange={(e) => setNewItem(e.target.value)}
                                        onKeyDown={(e) => e.key === 'Enter' && addManualItem()}
                                        placeholder="Add item..."
                                        className="flex-1 px-4 py-3 rounded-xl border border-cream-300 bg-white text-warm-800 text-sm focus:outline-none focus:border-coral-400"
                                    />
                                    <button onClick={addManualItem} className="px-4 py-3 bg-coral-500 text-white rounded-xl font-medium press">+</button>
                                </div>

                                {/* Quick Add Buttons */}
                                <div className="mb-5">
                                    <p className="text-warm-500 text-xs mb-2">Quick add:</p>
                                    <div className="flex gap-2 flex-wrap">
                                        {quickAddItems.map((item, i) => (
                                            <button
                                                key={i}
                                                onClick={() => addQuickItem(item)}
                                                disabled={shopping.some(s => s.name === item.name)}
                                                className={`px-3 py-1.5 rounded-lg text-xs font-medium press transition-all ${
                                                    shopping.some(s => s.name === item.name)
                                                        ? 'bg-cream-200 text-warm-400'
                                                        : 'bg-cream-100 text-warm-600 border border-cream-200 hover:border-coral-300'
                                                }`}
                                            >
                                                {item.emoji} {item.name.split(' (')[0]}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Staples Section */}
                                {staples.length > 0 && (
                                    <div className="mb-5">
                                        <div className="flex justify-between items-center mb-2">
                                            <p className="text-warm-500 text-xs">‚≠ê Your staples:</p>
                                            <button onClick={addStaplestoList} className="text-coral-500 text-xs font-medium press">+ Add all to list</button>
                                        </div>
                                        <div className="flex gap-2 flex-wrap">
                                            {staples.map((item, i) => (
                                                <span key={i} className="px-3 py-1.5 bg-sand-50 border border-sand-200 rounded-lg text-xs text-warm-600">
                                                    {item.name.split(' (')[0]}
                                                </span>
                                            ))}
                                        </div>
                                        <button onClick={() => setShowStaplesModal(true)} className="text-warm-500 text-xs mt-2 underline">Manage staples</button>
                                    </div>
                                )}

                                {/* Empty State */}
                                {shopping.length === 0 ? (
                                    <div className="card rounded-2xl p-8 text-center border border-cream-200">
                                        <span className="text-5xl mb-4 block">üõí</span>
                                        <p className="text-warm-700 font-medium mb-1">List is empty</p>
                                        <p className="text-warm-500 text-sm">Add items above or from recipes</p>
                                        {staples.length === 0 && (
                                            <button onClick={() => setShowStaplesModal(true)} className="mt-4 text-coral-500 text-sm font-medium">+ Set up your staples</button>
                                        )}
                                    </div>
                                ) : (
                                    /* Shopping List by Category */
                                    <div className="space-y-4">
                                        {Object.entries(getItemsByCategory()).map(([cat, items]) => {
                                            if (items.length === 0) return null;
                                            const catInfo = shopCategories[cat] || { name: cat, emoji: 'üì¶' };
                                            return (
                                                <div key={cat} className="card rounded-2xl border border-cream-200 overflow-hidden">
                                                    <div className="px-4 py-2.5 bg-cream-100 border-b border-cream-200">
                                                        <span className="text-warm-700 font-semibold text-sm">{catInfo.emoji} {catInfo.name}</span>
                                                        <span className="text-warm-500 text-xs ml-2">({items.filter(i => !i.checked).length})</span>
                                                    </div>
                                                    <div>
                                                        {items.map((item) => (
                                                            <div 
                                                                key={item.id} 
                                                                className={`flex items-center gap-3 px-4 py-3 border-b border-cream-100 last:border-0 transition-all ${item.checked ? 'bg-cream-50' : ''}`}
                                                            >
                                                                <button 
                                                                    onClick={() => toggleChecked(item.id)}
                                                                    className={`w-6 h-6 rounded-full border-2 flex items-center justify-center press transition-all ${
                                                                        item.checked 
                                                                            ? 'bg-sage-500 border-sage-500 text-white' 
                                                                            : 'border-cream-300 hover:border-sage-400'
                                                                    }`}
                                                                >
                                                                    {item.checked && <span className="text-sm">‚úì</span>}
                                                                </button>
                                                                
                                                                {editingItem === item.id ? (
                                                                    <input
                                                                        type="text"
                                                                        defaultValue={item.name}
                                                                        autoFocus
                                                                        onBlur={(e) => updateItemName(item.id, e.target.value)}
                                                                        onKeyDown={(e) => e.key === 'Enter' && updateItemName(item.id, e.target.value)}
                                                                        className="flex-1 px-2 py-1 rounded border border-coral-300 text-sm text-warm-800 focus:outline-none"
                                                                    />
                                                                ) : (
                                                                    <span 
                                                                        onClick={() => setEditingItem(item.id)}
                                                                        className={`flex-1 text-sm cursor-pointer ${item.checked ? 'line-through text-warm-400' : 'text-warm-700'}`}
                                                                    >
                                                                        {item.name}
                                                                    </span>
                                                                )}
                                                                
                                                                <div className="flex items-center gap-1">
                                                                    {!staples.some(s => s.name === item.name) && (
                                                                        <button 
                                                                            onClick={() => addToStaples(item)}
                                                                            className="p-1.5 text-warm-400 hover:text-sand-500 text-sm"
                                                                            title="Add to staples"
                                                                        >
                                                                            ‚≠ê
                                                                        </button>
                                                                    )}
                                                                    <button 
                                                                        onClick={() => deleteItem(item.id)}
                                                                        className="p-1.5 text-warm-400 hover:text-coral-500 text-lg"
                                                                    >
                                                                        √ó
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            );
                                        })}

                                        {/* Summary */}
                                        <div className="text-center py-4">
                                            <p className="text-warm-500 text-sm">
                                                {shopping.filter(i => i.checked).length} of {shopping.length} items checked
                                            </p>
                                            {shopping.length > 0 && (
                                                <button onClick={() => setShopping([])} className="text-warm-400 text-xs mt-2 underline">Clear entire list</button>
                                            )}
                                        </div>
                                    </div>
                                )}

                                {/* Staples Modal */}
                                {showStaplesModal && (
                                    <div className="fixed inset-0 z-50 flex items-end justify-center modal-overlay" onClick={() => setShowStaplesModal(false)}>
                                        <div className="bg-cream-50 rounded-t-[2rem] w-full max-w-lg max-h-[80vh] overflow-hidden animate-slide-up shadow-soft-lg" onClick={e => e.stopPropagation()}>
                                            <div className="flex justify-center pt-3 pb-2"><div className="w-12 h-1 bg-cream-300 rounded-full" /></div>
                                            <div className="px-5 pb-8">
                                                <h3 className="text-warm-800 font-bold text-lg mb-2">‚≠ê Manage Staples</h3>
                                                <p className="text-warm-500 text-sm mb-4">Items you buy every week. One tap to add them all.</p>
                                                
                                                {staples.length === 0 ? (
                                                    <div className="text-center py-8">
                                                        <p className="text-warm-500 text-sm mb-4">No staples yet. Add items to your shopping list, then tap ‚≠ê to save them as staples.</p>
                                                    </div>
                                                ) : (
                                                    <div className="space-y-2 mb-4">
                                                        {staples.map((item, i) => (
                                                            <div key={i} className="flex items-center justify-between px-4 py-3 bg-white rounded-xl border border-cream-200">
                                                                <span className="text-warm-700 text-sm">{item.name}</span>
                                                                <button onClick={() => removeFromStaples(item.name)} className="text-warm-400 hover:text-coral-500">√ó</button>
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                                
                                                <button onClick={() => setShowStaplesModal(false)} className="w-full py-3 bg-warm-800 text-white rounded-xl font-medium press">Done</button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Protein Picker Modal */}
                                {showProteinPicker && (
                                    <div className="fixed inset-0 z-50 flex items-end justify-center modal-overlay" onClick={() => setShowProteinPicker(false)}>
                                        <div className="bg-cream-50 rounded-t-[2rem] w-full max-w-lg max-h-[85vh] overflow-hidden animate-slide-up shadow-soft-lg" onClick={e => e.stopPropagation()}>
                                            <div className="flex justify-center pt-3 pb-2"><div className="w-12 h-1 bg-cream-300 rounded-full" /></div>
                                            <div className="px-5 pb-8 overflow-y-auto max-h-[75vh]">
                                                <h3 className="text-warm-800 font-bold text-lg mb-1">ü•© Pick Your Proteins</h3>
                                                <p className="text-warm-500 text-sm mb-4">Tap to add to shopping list</p>
                                                
                                                <div className="space-y-4">
                                                    {proteinOptions.map((protein, i) => (
                                                        <div key={i} className="card rounded-2xl border border-cream-200 overflow-hidden">
                                                            <div className="px-4 py-2.5 bg-cream-100 border-b border-cream-200 flex items-center gap-2">
                                                                <span className="text-xl">{protein.emoji}</span>
                                                                <span className="text-warm-800 font-semibold text-sm">{protein.name}</span>
                                                            </div>
                                                            <div className="p-2 flex flex-wrap gap-2">
                                                                {protein.cuts.map((cut, j) => {
                                                                    const inList = shopping.some(s => s.name === cut);
                                                                    return (
                                                                        <button
                                                                            key={j}
                                                                            onClick={() => addProteinCut(cut)}
                                                                            disabled={inList}
                                                                            className={`px-3 py-2 rounded-xl text-sm transition-all press ${
                                                                                inList 
                                                                                    ? 'bg-sage-100 text-sage-600' 
                                                                                    : 'bg-white border border-cream-200 text-warm-700 hover:border-coral-300 hover:bg-coral-50'
                                                                            }`}
                                                                        >
                                                                            {inList && <span className="mr-1">‚úì</span>}
                                                                            {cut}
                                                                        </button>
                                                                    );
                                                                })}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                                
                                                <button onClick={() => setShowProteinPicker(false)} className="w-full py-3 mt-5 bg-warm-800 text-white rounded-xl font-medium press">Done</button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Veggie Picker Modal */}
                                {showVeggiePicker && (
                                    <div className="fixed inset-0 z-50 flex items-end justify-center modal-overlay" onClick={() => setShowVeggiePicker(false)}>
                                        <div className="bg-cream-50 rounded-t-[2rem] w-full max-w-lg max-h-[85vh] overflow-hidden animate-slide-up shadow-soft-lg" onClick={e => e.stopPropagation()}>
                                            <div className="flex justify-center pt-3 pb-2"><div className="w-12 h-1 bg-cream-300 rounded-full" /></div>
                                            <div className="px-5 pb-8 overflow-y-auto max-h-[75vh]">
                                                <h3 className="text-warm-800 font-bold text-lg mb-1">ü•¨ Pick Your Veggies</h3>
                                                <p className="text-warm-500 text-sm mb-4">Unlimited on your protocol ‚Äî go wild! ü•≥</p>
                                                
                                                <div className="space-y-4">
                                                    {veggieOptions.map((category, i) => (
                                                        <div key={i} className="card rounded-2xl border border-cream-200 overflow-hidden">
                                                            <div className="px-4 py-2.5 bg-sage-50 border-b border-cream-200 flex items-center gap-2">
                                                                <span className="text-xl">{category.emoji}</span>
                                                                <span className="text-warm-800 font-semibold text-sm">{category.name}</span>
                                                            </div>
                                                            <div className="p-2 flex flex-wrap gap-2">
                                                                {category.items.map((item, j) => {
                                                                    const inList = shopping.some(s => s.name === item);
                                                                    return (
                                                                        <button
                                                                            key={j}
                                                                            onClick={() => addVeggieItem(item)}
                                                                            disabled={inList}
                                                                            className={`px-3 py-2 rounded-xl text-sm transition-all press ${
                                                                                inList 
                                                                                    ? 'bg-sage-100 text-sage-600' 
                                                                                    : 'bg-white border border-cream-200 text-warm-700 hover:border-sage-300 hover:bg-sage-50'
                                                                            }`}
                                                                        >
                                                                            {inList && <span className="mr-1">‚úì</span>}
                                                                            {item}
                                                                        </button>
                                                                    );
                                                                })}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                                
                                                <button onClick={() => setShowVeggiePicker(false)} className="w-full py-3 mt-5 bg-warm-800 text-white rounded-xl font-medium press">Done</button>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {tab === 'saved' && (
                            <div>
                                <h2 className="text-warm-800 font-bold text-lg mb-4">‚ù§Ô∏è Favorites ({favorites.length})</h2>
                                {favorites.length === 0 ? (
                                    <div className="card rounded-2xl p-8 text-center border border-cream-200">
                                        <span className="text-4xl mb-3 block">üíî</span>
                                        <p className="text-warm-600">No favorites yet</p>
                                        <p className="text-warm-500 text-sm mt-1">Tap ‚ù§Ô∏è on any meal</p>
                                    </div>
                                ) : (
                                    favorites.map(m => <MealCard key={m.name} meal={m} />)
                                )}
                            </div>
                        )}

                        {tab === 'history' && (
                            <div>
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-warm-800 font-bold text-lg">üìú History ({history.length})</h2>
                                    <div className="flex gap-2">
                                        <button 
                                            onClick={() => setShowCustomMeal(true)}
                                            className="px-3 py-2 bg-warm-800 text-white rounded-xl text-sm font-medium press"
                                        >
                                            + Log
                                        </button>
                                        {history.length > 0 && (
                                            <button 
                                                onClick={() => setShowWeeklySummary(true)}
                                                className="px-3 py-2 bg-gradient-to-r from-coral-500 to-sand-500 text-white rounded-xl text-sm font-medium press shadow-glow-coral"
                                            >
                                                üìä Week
                                            </button>
                                        )}
                                    </div>
                                </div>
                                {history.length === 0 ? (
                                    <div className="card rounded-2xl p-8 text-center border border-cream-200">
                                        <span className="text-4xl mb-3 block">üìú</span>
                                        <p className="text-warm-600">No meals logged yet</p>
                                        <p className="text-warm-500 text-sm mt-1">Tap "I made this" on recipes to track</p>
                                        <button 
                                            onClick={() => setShowCustomMeal(true)}
                                            className="mt-4 px-4 py-2 bg-coral-500 text-white rounded-xl text-sm font-medium press"
                                        >
                                            + Log a custom meal
                                        </button>
                                    </div>
                                ) : (
                                    <div>
                                        {history.slice(0, 20).map((m, i) => (
                                            <div key={i} className="card rounded-xl p-4 mb-3 border border-cream-200">
                                                <div className="flex justify-between items-start">
                                                    <div>
                                                        <div className="flex items-center gap-2">
                                                            <span className="text-warm-800 font-medium">{m.name}</span>
                                                            {m.isCustom && <span className="text-xs bg-cream-200 text-warm-500 px-1.5 py-0.5 rounded">custom</span>}
                                                        </div>
                                                        <div className="flex gap-2 mt-1">
                                                            <span className="text-coral-500 text-xs">~{m.baseProtein}g protein</span>
                                                            {m.netCarbs !== undefined && <span className="text-sage-500 text-xs">{m.netCarbs}g carbs</span>}
                                                        </div>
                                                    </div>
                                                    <span className="text-warm-500 text-xs">{formatDate(m.cookedAt)}</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}

                                {/* Custom Meal Logger Modal */}
                                {showCustomMeal && (
                                    <div className="fixed inset-0 z-50 flex items-end justify-center modal-overlay" onClick={() => { setShowCustomMeal(false); resetCustomMeal(); }}>
                                        <div className="bg-cream-50 rounded-t-[2rem] w-full max-w-lg max-h-[92vh] overflow-hidden animate-slide-up shadow-soft-lg" onClick={e => e.stopPropagation()}>
                                            <div className="flex justify-center pt-3 pb-2"><div className="w-12 h-1 bg-cream-300 rounded-full" /></div>
                                            <div className="px-5 pb-8 overflow-y-auto max-h-[82vh]">
                                                <h2 className="text-warm-800 font-bold text-xl mb-1">üìù Log Custom Meal</h2>
                                                <p className="text-warm-500 text-sm mb-4">Fill in what Diego ate</p>

                                                {/* Optional meal name */}
                                                <div className="mb-4">
                                                    <input
                                                        type="text"
                                                        value={customMeal.name}
                                                        onChange={(e) => setCustomMeal(prev => ({ ...prev, name: e.target.value }))}
                                                        placeholder="Name this meal (optional)"
                                                        className="w-full px-4 py-3 rounded-xl border border-cream-300 bg-white text-warm-800 text-sm focus:outline-none focus:border-coral-400"
                                                    />
                                                    <p className="text-warm-400 text-xs mt-1">e.g., "Nene's Special Breakfast" or leave blank</p>
                                                </div>

                                                {/* Live Total - Sticky */}
                                                <div className="sticky top-0 z-10 bg-gradient-to-r from-coral-500 to-sand-500 rounded-xl p-3 mb-4 shadow-glow-coral">
                                                    <div className="flex justify-between items-center text-white">
                                                        <span className="font-semibold">Total:</span>
                                                        <div className="flex gap-4">
                                                            <span className="font-bold">~{calcCustomProtein()}g protein</span>
                                                            <span>|</span>
                                                            <span>{calcCustomCarbs()}g carbs</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* PROTEINS SECTION */}
                                                <div className="mb-5">
                                                    <h3 className="text-warm-700 font-semibold text-sm mb-3 flex items-center gap-2">
                                                        <span className="w-6 h-6 rounded-lg bg-coral-500 text-white flex items-center justify-center text-xs">ü•©</span>
                                                        Proteins
                                                        <span className="text-warm-400 font-normal text-xs">(raw grams, cooked +30%)</span>
                                                    </h3>
                                                    
                                                    {/* Eggs - Units with halves */}
                                                    <div className="flex items-center justify-between py-3 border-b border-cream-200">
                                                        <div className="flex items-center gap-3">
                                                            <span className="text-xl">ü•ö</span>
                                                            <span className="text-warm-700">Eggs</span>
                                                        </div>
                                                        <div className="flex items-center gap-3">
                                                            <button onClick={() => setCustomMeal(prev => ({ ...prev, eggs: Math.max(0, prev.eggs - 0.5) }))} className="w-8 h-8 rounded-lg bg-cream-200 text-warm-600 font-bold press">‚àí</button>
                                                            <span className="w-8 text-center font-semibold text-warm-800">{customMeal.eggs}</span>
                                                            <button onClick={() => setCustomMeal(prev => ({ ...prev, eggs: prev.eggs + 0.5 }))} className="w-8 h-8 rounded-lg bg-coral-500 text-white font-bold press">+</button>
                                                            <span className="w-16 text-right text-coral-500 font-medium text-sm">{customMeal.eggs > 0 ? `${Math.round(customMeal.eggs * 6)}g` : '-'}</span>
                                                        </div>
                                                    </div>

                                                    {/* Other Proteins - Grams */}
                                                    {[
                                                        { id: 'beef', name: 'Beef', emoji: 'ü•©' },
                                                        { id: 'chicken', name: 'Chicken', emoji: 'üçó' },
                                                        { id: 'ground', name: 'Ground Beef', emoji: 'üçî' },
                                                        { id: 'salmon', name: 'Salmon', emoji: 'üêü' },
                                                        { id: 'fish', name: 'White Fish', emoji: 'üê†' },
                                                        { id: 'shrimp', name: 'Shrimp', emoji: 'ü¶ê' },
                                                        { id: 'lamb', name: 'Lamb', emoji: 'üçñ' },
                                                        { id: 'pork', name: 'Pork', emoji: 'üê∑' },
                                                    ].map(protein => {
                                                        const grams = parseInt(customMeal.proteins[protein.id]) || 0;
                                                        const proteinG = grams > 0 ? Math.round((grams * proteinCalcData[protein.id].per100g) / 100) : 0;
                                                        return (
                                                            <div key={protein.id} className="flex items-center justify-between py-2 border-b border-cream-100">
                                                                <div className="flex items-center gap-3">
                                                                    <span className="text-lg">{protein.emoji}</span>
                                                                    <span className="text-warm-700 text-sm">{protein.name}</span>
                                                                </div>
                                                                <div className="flex items-center gap-2">
                                                                    <input
                                                                        type="number"
                                                                        value={customMeal.proteins[protein.id]}
                                                                        onChange={(e) => updateCustomProtein(protein.id, e.target.value)}
                                                                        placeholder="0"
                                                                        className="w-20 px-2 py-1.5 rounded-lg border border-cream-300 bg-white text-warm-800 text-sm text-right focus:outline-none focus:border-coral-400"
                                                                    />
                                                                    <span className="text-warm-500 text-xs w-4">g</span>
                                                                    <span className="w-14 text-right text-coral-500 font-medium text-sm">{proteinG > 0 ? `${proteinG}g` : '-'}</span>
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>

                                                {/* VEGGIES SECTION */}
                                                <div className="mb-5">
                                                    <h3 className="text-warm-700 font-semibold text-sm mb-3 flex items-center gap-2">
                                                        <span className="w-6 h-6 rounded-lg bg-sage-500 text-white flex items-center justify-center text-xs">ü•¨</span>
                                                        Veggies
                                                        <span className="text-warm-400 font-normal text-xs">(for carb counting)</span>
                                                    </h3>

                                                    {/* Avocado - Units with halves */}
                                                    <div className="flex items-center justify-between py-3 border-b border-cream-200">
                                                        <div className="flex items-center gap-3">
                                                            <span className="text-xl">ü•ë</span>
                                                            <span className="text-warm-700">Avocado</span>
                                                        </div>
                                                        <div className="flex items-center gap-3">
                                                            <button onClick={() => updateCustomVeggie('avocado', Math.max(0, (customMeal.veggies.avocado || 0) - 0.5))} className="w-8 h-8 rounded-lg bg-cream-200 text-warm-600 font-bold press">‚àí</button>
                                                            <span className="w-8 text-center font-semibold text-warm-800">{customMeal.veggies.avocado || 0}</span>
                                                            <button onClick={() => updateCustomVeggie('avocado', (customMeal.veggies.avocado || 0) + 0.5)} className="w-8 h-8 rounded-lg bg-sage-500 text-white font-bold press">+</button>
                                                            <span className="w-14 text-right text-sage-600 font-medium text-sm">{customMeal.veggies.avocado > 0 ? `${Math.round(customMeal.veggies.avocado * 2)}g carb` : '-'}</span>
                                                        </div>
                                                    </div>

                                                    {/* Other Veggies - Grams */}
                                                    {[
                                                        { id: 'broccoli', name: 'Broccoli', emoji: 'ü•¶', carbsPer100: 4 },
                                                        { id: 'spinach', name: 'Spinach', emoji: 'ü•¨', carbsPer100: 1 },
                                                        { id: 'peppers', name: 'Peppers', emoji: 'ü´ë', carbsPer100: 4 },
                                                        { id: 'mushrooms', name: 'Mushrooms', emoji: 'üçÑ', carbsPer100: 2 },
                                                        { id: 'zucchini', name: 'Zucchini', emoji: 'ü•í', carbsPer100: 2 },
                                                        { id: 'tomatoes', name: 'Tomatoes', emoji: 'üçÖ', carbsPer100: 3 },
                                                        { id: 'onions', name: 'Onions', emoji: 'üßÖ', carbsPer100: 8 },
                                                        { id: 'asparagus', name: 'Asparagus', emoji: 'üåø', carbsPer100: 2 },
                                                        { id: 'cucumber', name: 'Cucumber', emoji: 'ü•í', carbsPer100: 2 },
                                                    ].map(veg => {
                                                        const grams = parseInt(customMeal.veggies[veg.id]) || 0;
                                                        const carbs = grams > 0 ? Math.round((grams * veg.carbsPer100) / 100) : 0;
                                                        return (
                                                            <div key={veg.id} className="flex items-center justify-between py-2 border-b border-cream-100">
                                                                <div className="flex items-center gap-3">
                                                                    <span className="text-lg">{veg.emoji}</span>
                                                                    <span className="text-warm-700 text-sm">{veg.name}</span>
                                                                    <span className="text-warm-400 text-xs">({veg.carbsPer100}g/100g)</span>
                                                                </div>
                                                                <div className="flex items-center gap-2">
                                                                    <input
                                                                        type="number"
                                                                        value={customMeal.veggies[veg.id]}
                                                                        onChange={(e) => updateCustomVeggie(veg.id, e.target.value)}
                                                                        placeholder="0"
                                                                        className="w-16 px-2 py-1.5 rounded-lg border border-cream-300 bg-white text-warm-800 text-sm text-right focus:outline-none focus:border-sage-400"
                                                                    />
                                                                    <span className="text-warm-500 text-xs w-4">g</span>
                                                                    <span className="w-14 text-right text-sage-600 font-medium text-sm">{carbs > 0 ? `${carbs}g` : '-'}</span>
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>

                                                {/* EXTRAS SECTION */}
                                                <div className="mb-5">
                                                    <h3 className="text-warm-700 font-semibold text-sm mb-3 flex items-center gap-2">
                                                        <span className="w-6 h-6 rounded-lg bg-sand-500 text-white flex items-center justify-center text-xs">üßÄ</span>
                                                        Extras
                                                    </h3>

                                                    {/* Cheese - Grams */}
                                                    <div className="flex items-center justify-between py-2 border-b border-cream-100">
                                                        <div className="flex items-center gap-3">
                                                            <span className="text-lg">üßÄ</span>
                                                            <span className="text-warm-700 text-sm">Cheese</span>
                                                            <span className="text-warm-400 text-xs">(max 50g)</span>
                                                        </div>
                                                        <div className="flex items-center gap-2">
                                                            <input
                                                                type="number"
                                                                value={customMeal.cheese}
                                                                onChange={(e) => setCustomMeal(prev => ({ ...prev, cheese: e.target.value }))}
                                                                placeholder="0"
                                                                className="w-16 px-2 py-1.5 rounded-lg border border-cream-300 bg-white text-warm-800 text-sm text-right focus:outline-none focus:border-sand-400"
                                                            />
                                                            <span className="text-warm-500 text-xs w-4">g</span>
                                                            <span className="w-14 text-right text-sand-600 font-medium text-sm">{parseInt(customMeal.cheese) > 0 ? `+${Math.round((parseInt(customMeal.cheese) * 25) / 100)}g` : '-'}</span>
                                                        </div>
                                                    </div>

                                                    {/* Cooking fats - Checkboxes */}
                                                    <div className="flex gap-3 mt-3">
                                                        <button 
                                                            onClick={() => setCustomMeal(prev => ({ ...prev, usedOil: !prev.usedOil }))}
                                                            className={`flex-1 py-2 px-3 rounded-xl text-sm font-medium press ${customMeal.usedOil ? 'bg-sage-500 text-white' : 'bg-cream-100 text-warm-600 border border-cream-200'}`}
                                                        >
                                                            ü´í Olive Oil {customMeal.usedOil && '‚úì'}
                                                        </button>
                                                        <button 
                                                            onClick={() => setCustomMeal(prev => ({ ...prev, usedButter: !prev.usedButter }))}
                                                            className={`flex-1 py-2 px-3 rounded-xl text-sm font-medium press ${customMeal.usedButter ? 'bg-sage-500 text-white' : 'bg-cream-100 text-warm-600 border border-cream-200'}`}
                                                        >
                                                            üßà Butter {customMeal.usedButter && '‚úì'}
                                                        </button>
                                                    </div>
                                                </div>

                                                {/* Carbs Override */}
                                                <div className="mb-5 p-3 bg-cream-100 rounded-xl">
                                                    <div className="flex items-center justify-between">
                                                        <span className="text-warm-600 text-sm">Override carbs?</span>
                                                        <div className="flex items-center gap-2">
                                                            <input
                                                                type="number"
                                                                value={customMeal.carbsOverride}
                                                                onChange={(e) => setCustomMeal(prev => ({ ...prev, carbsOverride: e.target.value }))}
                                                                placeholder={calcCustomCarbs().toString()}
                                                                className="w-16 px-2 py-1.5 rounded-lg border border-cream-300 bg-white text-warm-800 text-sm text-right focus:outline-none"
                                                            />
                                                            <span className="text-warm-500 text-xs">g</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Summary Preview */}
                                                {hasCustomMealContent() && (
                                                    <div className="bg-cream-100 rounded-xl p-4 mb-5">
                                                        <p className="text-warm-600 text-xs mb-1">Will log as:</p>
                                                        <p className="text-warm-800 font-medium">{buildCustomMealName()}</p>
                                                    </div>
                                                )}

                                                {/* Log Button */}
                                                <button 
                                                    onClick={logCustomMeal}
                                                    disabled={!hasCustomMealContent()}
                                                    className={`w-full py-4 rounded-xl font-bold text-lg press ${
                                                        hasCustomMealContent()
                                                            ? 'bg-coral-500 text-white shadow-glow-coral'
                                                            : 'bg-cream-200 text-warm-400'
                                                    }`}
                                                >
                                                    ‚úì Log This Meal
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                {showWeeklySummary && (() => {
                                    const summary = getWeeklySummary();
                                    return (
                                        <div className="fixed inset-0 z-50 flex items-end justify-center modal-overlay" onClick={() => setShowWeeklySummary(false)}>
                                            <div className="bg-cream-50 rounded-t-[2rem] w-full max-w-lg max-h-[90vh] overflow-hidden animate-slide-up shadow-soft-lg" onClick={e => e.stopPropagation()}>
                                                <div className="flex justify-center pt-3 pb-2"><div className="w-12 h-1 bg-cream-300 rounded-full" /></div>
                                                <div className="px-5 pb-8 overflow-y-auto max-h-[80vh]">
                                                    <h2 className="text-warm-800 font-bold text-xl mb-1">üìä Weekly Summary</h2>
                                                    <p className="text-warm-500 text-sm mb-5">Last 7 days of Diego's meals</p>

                                                    {summary.mealCount === 0 ? (
                                                        <div className="text-center py-8">
                                                            <span className="text-4xl mb-3 block">üì≠</span>
                                                            <p className="text-warm-600">No meals logged this week</p>
                                                            <p className="text-warm-500 text-sm mt-1">Start tracking to see your progress!</p>
                                                        </div>
                                                    ) : (<>
                                                        {/* Main Stats */}
                                                        <div className="grid grid-cols-2 gap-3 mb-5">
                                                            <div className="card rounded-2xl p-4 border border-cream-200 text-center">
                                                                <p className="text-warm-500 text-xs mb-1">Total Protein</p>
                                                                <p className="text-coral-500 font-bold text-2xl">{summary.totalProtein}g</p>
                                                                <div className="w-full bg-cream-200 rounded-full h-1.5 mt-2">
                                                                    <div className="bg-coral-500 h-1.5 rounded-full" style={{ width: `${summary.proteinProgress}%` }} />
                                                                </div>
                                                                <p className="text-warm-400 text-xs mt-1">{summary.proteinProgress}% of weekly goal</p>
                                                            </div>
                                                            <div className="card rounded-2xl p-4 border border-cream-200 text-center">
                                                                <p className="text-warm-500 text-xs mb-1">Total Carbs</p>
                                                                <p className="text-sage-500 font-bold text-2xl">{summary.totalCarbs}g</p>
                                                                <p className="text-warm-400 text-xs mt-3">~{summary.avgCarbs}g per meal</p>
                                                                <p className="text-sage-500 text-xs mt-1">Keeping it low! ‚úì</p>
                                                            </div>
                                                        </div>

                                                        {/* Meals & Averages */}
                                                        <div className="card rounded-2xl p-4 border border-cream-200 mb-5">
                                                            <div className="flex justify-between items-center mb-3">
                                                                <span className="text-warm-600 text-sm">Meals Logged</span>
                                                                <span className="text-warm-800 font-bold">{summary.mealCount} of {summary.targetMeals}</span>
                                                            </div>
                                                            <div className="w-full bg-cream-200 rounded-full h-2">
                                                                <div className="bg-warm-600 h-2 rounded-full" style={{ width: `${summary.mealsProgress}%` }} />
                                                            </div>
                                                            <div className="flex justify-between mt-3 text-sm">
                                                                <div>
                                                                    <span className="text-warm-500">Avg protein/meal:</span>
                                                                    <span className={`ml-2 font-bold ${summary.avgProtein >= 80 ? 'text-sage-500' : 'text-sand-500'}`}>{summary.avgProtein}g</span>
                                                                </div>
                                                                <span className="text-warm-400">{summary.avgProtein >= 80 ? '‚úì On target!' : '‚Üë Aim for 80-100g'}</span>
                                                            </div>
                                                        </div>

                                                        {/* Top Proteins */}
                                                        {summary.topProteins.length > 0 && (
                                                            <div className="card rounded-2xl p-4 border border-cream-200 mb-5">
                                                                <h3 className="text-warm-600 text-sm font-semibold mb-3">ü•© Top Proteins</h3>
                                                                <div className="flex gap-2 flex-wrap">
                                                                    {summary.topProteins.map((p, i) => (
                                                                        <div key={i} className="flex items-center gap-2 bg-cream-100 rounded-xl px-3 py-2">
                                                                            <span className="text-lg">{p?.emoji}</span>
                                                                            <span className="text-warm-700 text-sm">{p?.name}</span>
                                                                            <span className="text-coral-500 text-xs font-bold">√ó{p?.count}</span>
                                                                        </div>
                                                                    ))}
                                                                </div>
                                                            </div>
                                                        )}

                                                        {/* Top Recipes */}
                                                        {summary.topRecipes.length > 0 && (
                                                            <div className="card rounded-2xl p-4 border border-cream-200 mb-5">
                                                                <h3 className="text-warm-600 text-sm font-semibold mb-3">‚≠ê Most Made</h3>
                                                                <div className="space-y-2">
                                                                    {summary.topRecipes.map((r, i) => (
                                                                        <div key={i} className="flex justify-between items-center">
                                                                            <span className="text-warm-700 text-sm">{r.name}</span>
                                                                            <span className="text-coral-500 text-xs font-bold">√ó{r.count}</span>
                                                                        </div>
                                                                    ))}
                                                                </div>
                                                            </div>
                                                        )}

                                                        {/* Cuisine Variety */}
                                                        {summary.topFlavors.length > 0 && (
                                                            <div className="card rounded-2xl p-4 border border-cream-200 mb-5">
                                                                <h3 className="text-warm-600 text-sm font-semibold mb-3">üåç Cuisine Variety</h3>
                                                                <div className="flex gap-2 flex-wrap">
                                                                    {summary.topFlavors.map((f, i) => (
                                                                        <div key={i} className="flex items-center gap-2 bg-cream-100 rounded-xl px-3 py-2">
                                                                            <span>{f?.emoji}</span>
                                                                            <span className="text-warm-700 text-sm">{f?.name}</span>
                                                                            <span className="text-warm-500 text-xs">√ó{f?.count}</span>
                                                                        </div>
                                                                    ))}
                                                                </div>
                                                            </div>
                                                        )}

                                                        {/* Encouragement */}
                                                        <div className="bg-gradient-to-br from-coral-50 to-sand-50 border border-coral-100 rounded-2xl p-5 text-center">
                                                            <span className="text-3xl">üí™</span>
                                                            <p className="text-warm-700 text-sm mt-2">
                                                                {summary.avgProtein >= 80 
                                                                    ? "Amazing week! Diego is crushing his protein goals! üéâ" 
                                                                    : "Good progress! Let's aim for 80-100g protein per meal üí™"}
                                                            </p>
                                                        </div>
                                                    </>)}

                                                    <button onClick={() => setShowWeeklySummary(false)} className="w-full py-3 mt-5 bg-warm-800 text-white rounded-xl font-medium press">Done</button>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })()}
                            </div>
                        )}

                        <div className="text-center mt-10 text-warm-500 text-xs">Made with üíï for Nene ‚Ä¢ V5 with {mealRecipes.length} recipes</div>
                    </div>

                    {/* Bottom Nav */}
                    <div className="fixed bottom-0 left-0 right-0 bg-cream-100/95 border-t border-cream-200 px-2 py-2 z-30">
                        <div className="max-w-lg mx-auto flex justify-around">
                            {[{ id: 'create', icon: '‚ú®', label: 'Create' }, { id: 'plan', icon: 'üóìÔ∏è', label: 'Plan' }, { id: 'shop', icon: 'üõí', label: 'Shop' }, { id: 'saved', icon: '‚ù§Ô∏è', label: 'Saved' }, { id: 'history', icon: 'üìú', label: 'History' }].map(t => (
                                <button key={t.id} onClick={() => setTab(t.id)} className={`flex flex-col items-center py-2 px-3 rounded-2xl press ${tab === t.id ? 'text-coral-500' : 'text-warm-500'}`}>
                                    <span className={`text-xl mb-0.5 ${tab === t.id ? 'scale-110' : ''}`}>{t.icon}</span>
                                    <span className="text-[9px] font-semibold">{t.label}</span>
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
